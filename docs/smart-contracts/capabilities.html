<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-smart-contracts/capabilities" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Capabilities | Kadena Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kda-chain.org/docs/img/kadena-opengraph.png"><meta data-rh="true" name="twitter:image" content="https://kda-chain.org/docs/img/kadena-opengraph.png"><meta data-rh="true" property="og:url" content="https://kda-chain.org/docs/smart-contracts/capabilities"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Capabilities | Kadena Docs"><meta data-rh="true" name="description" content="Capabilities are the primary means by which you can grant granular permissions to perform tasks for which you wan to control access."><meta data-rh="true" property="og:description" content="Capabilities are the primary means by which you can grant granular permissions to perform tasks for which you wan to control access."><link data-rh="true" rel="icon" href="/docs/img/kadena-favicon.png"><link data-rh="true" rel="canonical" href="https://kda-chain.org/docs/smart-contracts/capabilities"><link data-rh="true" rel="alternate" href="https://kda-chain.org/docs/smart-contracts/capabilities" hreflang="en"><link data-rh="true" rel="alternate" href="https://kda-chain.org/docs/smart-contracts/capabilities" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://6UVWQF4IS8-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Kadena Docs" href="/docs/opensearch.xml"><link rel="stylesheet" href="/docs/assets/css/styles.01d78354.css">
<script src="/docs/assets/js/runtime~main.2ef1040c.js" defer="defer"></script>
<script src="/docs/assets/js/main.9cf849d4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/kadena-docs-light.png" alt="Kadena Documentation" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="196"><img src="/docs/img/kadena-docs-dark.png" alt="Kadena Documentation" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="196"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/quickstart">Get Started</a><a href="https://discord.com/invite/kadena" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Support<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kda-community/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link github-link-icon"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quickstart">Quick start</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/smart-contract-dev">Smart contracts</a><button aria-label="Collapse sidebar category &#x27;Smart contracts&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/get-started-intro">Get started: Introduction to Pact</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/smart-contracts/install">Installation and setup</a><button aria-label="Expand sidebar category &#x27;Installation and setup&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/basic-concepts">Basic concepts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/accounts">Accounts, keys, and principals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/lang-features">Pact features and conventions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/functions-variables">Functions, variables, and types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/modules">Modules and interfaces</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/smart-contracts/capabilities">Capabilities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/guards">Guards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/databases">Database model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/transactions">Transaction format and flow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/best-practices">Pact best practices</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/guides">How-to guides</a><button aria-label="Expand sidebar category &#x27;How-to guides&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/api">API</a><button aria-label="Expand sidebar category &#x27;API&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference">Reference</a><button aria-label="Expand sidebar category &#x27;Reference&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/coding-projects/coding-projects">Coding projects</a><button aria-label="Expand sidebar category &#x27;Coding projects&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/resources">Resources</a><button aria-label="Expand sidebar category &#x27;Resources&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/smart-contract-dev"><span itemprop="name">Smart contracts</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Capabilities</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Capabilities</h1></header>
<p>At a high level, Pact <strong>capabilities</strong> are a straightforward <strong>access control model</strong> for smart contracts.
With capabilities, you can define specific conditions to authorize specific actions for specific users.
Capabilities provide an explicit and transparent way to protect privileged operations, enforce rules before allowing transactions to execute, and ensure smart contract users authorize actions that are performed on their behalf.</p>
<p>Because capabilities are a core feature in the Pact smart contract programming language and powerful in how they enable you to manage permissions and resources, it&#x27;s important to understand what they are, how they work, and how to define them correctly to achieve intended results.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="permissions-resources-and-events">Permissions, resources, and events<a href="#permissions-resources-and-events" class="hash-link" aria-label="Direct link to Permissions, resources, and events" title="Direct link to Permissions, resources, and events">​</a></h2>
<p>Before getting into the details of how capabilities are defined, you should consider that there are three distinct—but related—use cases for capabilities.
You can define capabilities to do the following:</p>
<ul>
<li>Authorize access to a specific privileged operation.</li>
<li>Manage updates for a specific protected resource.</li>
<li>Report events from operations executed in a transaction.</li>
</ul>
<p>In the most common use case, you define capabilities to manage permissions by enforcing one or more conditions.
In combination with guards, these permission-driven capabilities act as gatekeepers to grant access to smart contract functions if the user or contract that controls the guard allows the operation to continue.
In general, capabilities protect privileged operations—such as coin.transfer operations—that users must authorize by signing the transaction with their keys or verify in some other way.
However, as a contract author, you can define capabilities verify other conditions—such as the account balance or how long it&#x27;s been since the last transfer operation—before granting the permission requested.
If the permission isn&#x27;t granted, the code where the capability is called won&#x27;t be executed.</p>
<p>You can think of the capabilities that are used to manage permissions as <strong>basic capabilities</strong>.
For more information about defining, acquiring, and scoping basic capabilities, see <a href="#expressing-basic-capabilities">Expressing basic capabilities</a></p>
<p>In addition to permissions, you can use capabilities to manage values for specified resources.
Capabilities that manage resources are called <strong>managed capabilities</strong>.
Managed capabilities have slightly different properties enable users or other contracts to set and update the value for a specified parameter.
As a contract author, you can define managed capabilities to allow <strong>contract users</strong> to manage a resource value, for example, to set a limit on the amount that can be transferred in a given transaction or to define the maximum supply of a resource.
For more information about defining and using managed capabilities, see <a href="#managed-capabilities">Managed capabilities</a>.</p>
<p>Capabilities can also emit events in transaction results.
For more information about using capabilities to emit events, see <a href="#events">Events</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="expressing-basic-capabilities">Expressing basic capabilities<a href="#expressing-basic-capabilities" class="hash-link" aria-label="Direct link to Expressing basic capabilities" title="Direct link to Expressing basic capabilities">​</a></h2>
<p>Basic capabilities enable you to manage permissions by specifying the conditions that allow access to a particular resource or contract function.
Therefore, in most cases, you define capabilities inside of the same module declaration as the functions that should use them.
Within the module declaration, you define capabilities by specifying the <code>defcap</code> reserved keyword and providing the following information:</p>
<ul>
<li>A capability <em>name</em> that describes the permission to be acquired or the operation to be protected.</li>
<li>Optional <em>parameters</em> that specify input arguments, properties, or conditions for the capability.</li>
<li>A <em>capability body</em> with the predicate function that determines whether the capability is granted or rejected.<br>
<!-- -->This predicate function is evaluated during capability acquisition.</li>
</ul>
<p>The following example defines a basic <code>ALLOW_ENTRY</code> capability in a <code>registration</code> module:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(module registration GOVERNANCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defcap GOVERNANCE () true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defcap ALLOW_ENTRY (user-id:string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Govern entry operation.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (with-read users-table user-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      { &quot;guard&quot; := guard, &quot;active&quot; := active }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (enforce-guard guard)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (enforce active &quot;Only active users allowed entry&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, the <code>defcap</code> declaration for the <code>ALLOW_ENTRY</code> capability consists of the following:</p>
<ul>
<li>
<p><code>ALLOW_ENTRY</code> is the <em>name</em> of the capability.</p>
</li>
<li>
<p><code>user-id</code> is a <em>parameter</em> that is passed to the capability body to be evaluated.</p>
</li>
<li>
<p><code>with-read</code> is the <em>capability body</em> that implements the predicate function.
The capability body is evaluated when the <code>with-capability</code> function is called with a specific <code>user-id</code> parameter.
For example, if the <code>user-id</code> is <code>bob</code>, the capability body is evaluated when <code>(with-capability (ALLOW_ENTRY &quot;bob&quot;) ...)</code> is called.</p>
</li>
</ul>
<p>In its simplest form, the capability body evaluates one or more conditions to determine whether the permission is granted.
If the conditions are met—without exiting or throwing an error—the capability is granted and operations continue.
In general, you should test all of the conditions you want to define in the <code>defcap</code> declaration using <code>enforce</code> statements, so that the permission won&#x27;t be granted if any condition fails.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="evaluating-and-granting-permissions">Evaluating and granting permissions<a href="#evaluating-and-granting-permissions" class="hash-link" aria-label="Direct link to Evaluating and granting permissions" title="Direct link to Evaluating and granting permissions">​</a></h3>
<p>The <code>defcap</code> declaration defines the conditions to evaluate to determine whether a permission should be granted (true) or rejected (false).
You use the <code>with-capability</code> built-in function whenever you want to check these conditions before allowing a user to perform a privileged operation.</p>
<p>For example, the following <code>entry</code> function calls the <code>with-capability</code> function to evaluate the <code>ALLOW_ENTRY</code> capability before executing two protected operations:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(defun entry (user-id:string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (with-capability (ALLOW_ENTRY user-id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (add-entry user-id)            ;; call a protected operation within the with-capability block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (update-entry-status user-id)  ;; update a database within the with-capability block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (record-audit &quot;ENTRY&quot; user-id)   ;; call an unprotected operation outside of the with-capability block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As illustrated in this example, the capability applies to the protected operations inside of the  <code>with-capability</code> code block.
If the capability is granted, it remains in scope for all operations contained within the scope of the <code>with-capability</code> function.
In this example, the <code>ALLOW_ENTRY</code> capability remains in scope for the <code>add-entry</code> and <code>update-entry-status</code> functions.
After the code block containing the call to the <code>with-capability</code> function exits, the capability is no longer in scope.
In this example, the <code>ALLOW_ENTRY</code> capability is removed from scope before executing the <code>record-audit</code> function that&#x27;s outside of the <code>with-capability</code> block.
Restricting the capability to the code contained within the <code>with-capability</code> block prevents duplicate testing of the predicate.
Capabilities that have already been acquired and that are currently in scope are not re-evaluated.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="requiring-a-capability">Requiring a capability<a href="#requiring-a-capability" class="hash-link" aria-label="Direct link to Requiring a capability" title="Direct link to Requiring a capability">​</a></h3>
<p>The <code>with-capability</code> function enables smart contract users to attempt to acquire a specified capability that allows them to perform an operation within a limited scope.
The <code>require-capability</code> function requires smart contract users to have already been granted the specified capability before they can execute an operation.
The <code>require-capability</code> function doesn&#x27;t evaluate the conditions to grant a capability.
If the required capability wasn&#x27;t acquired in the context of another function, the function calling the <code>require-capability</code> function fails.</p>
<p>For example, you can require the <code>ALLOW_ENTRY</code> capability to have been acquired and currently in scope before executing the <code>add-entry</code> function like this:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(defun entry (user-id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (with-capability (ALLOW_ENTRY user-id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (add-entry user-id)            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (update-entry-status user-id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (record-audit &quot;ENTRY&quot; user-id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(defun add-entry (user-id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (require-capability (ALLOW_ENTRY user-id)) ;; require a previously acquired capability</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>By requiring a capability, you can define private or restricted functions than cannot be called directly.
In this example, the <code>add-entry</code> function can only be called by code inside the module that grants the <code>ALLOW_ENTRY</code> capability and can only be called for this <code>user-id</code> in particular, restricting the function to that user.</p>
<p>However, it&#x27;s important to note that the <code>require-capability</code> function doesn&#x27;t scope to a body of code.
The position at which you insert it affects the semantics of the function call and the operations that happen first, before the capability requirement is applied.
If you insert the <code>require-capability</code> call at an inappropriate position, you might see unexpected behavior or error messages.
In general, you should insert the <code>require-capability</code> call at the beginning of a function call.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="composing-capabilities">Composing capabilities<a href="#composing-capabilities" class="hash-link" aria-label="Direct link to Composing capabilities" title="Direct link to Composing capabilities">​</a></h3>
<p>A <code>defcap</code> declaration can also include other capabilities, for modular factoring of guard code or to compose an outer capability from smaller, inner capabilities.
For example, the following <code>ALLOW_ENTRY</code> capability declaration includes an inner capability—the DB_LOG capability—that&#x27;s defined its own separate <code>defcap</code> declaration:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(defcap ALLOW_ENTRY (user-id:string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Govern entry operation.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (with-read users-table user-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    { &quot;guard&quot; := guard, &quot;active&quot; := active }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (enforce-guard guard)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (enforce active &quot;Only active users allowed entry&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (compose-capability DB_LOG) ;; allow db logging while ALLOW_ENTRY is in scope</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(defcap DB_LOG () true)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Composed capabilities must be defined using <code>defcap</code> declarations in the same module as the parent capability and are only in scope when their parent capability is granted.</p>
<p>In many cases, you can use the <code>compose-capability</code> function to improve code logic with clear separation of concerns.
The following example illustrates separating the <code>transfer</code>, <code>debit</code>, and <code>credit</code> functions—and corresponding capabilities—so that <code>debit</code> is always called with a corresponding <code>credit</code> operation with the <code>TRANSFER</code> capability being a &quot;no-guard&quot; capability that simply encloses the <code>debit</code> and <code>credit</code> calls:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(defcap TRANSFER:bool (from:string to:string amount:decimal)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (compose-capability (DEBIT from))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (compose-capability (CREDIT to)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(defcap DEBIT (from:string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (enforce-guard (at &#x27;guard (read table from))))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(defcap CREDIT (to:string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (check-account-exists to))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(defun transfer (from:string to:string amount:decimal)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (with-capability (TRANSFER from to amount)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (debit from amount)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (credit to amount)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(defun debit (user amount)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (require-capability (DEBIT user))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (update accounts user ...))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(defun credit (user amount)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (require-capability (CREDIT user)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (update accounts user ...)))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example:</p>
<ul>
<li>The <code>TRANSFER</code> capability protects the <code>debit</code> and <code>credit</code> calls from being used independently.</li>
<li>The <code>DEBIT</code> capability governs the ability to debit, enforcing the guard.</li>
<li>The <code>CREDIT</code> simply creates a restricted capability for the <code>credit</code> function.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="calling-basic-capabilities">Calling basic capabilities<a href="#calling-basic-capabilities" class="hash-link" aria-label="Direct link to Calling basic capabilities" title="Direct link to Calling basic capabilities">​</a></h2>
<p>To give you better insight into how to call capabilities, it&#x27;s important to consider the concept of scope in Pact modules.
Potentially, there are several layers of scope that can you might need to navigate, including:</p>
<ul>
<li>Top-level scope</li>
<li>Module scope</li>
<li>Outer capability scope for composing capabilities</li>
<li>Inner capability scope for composed capabilities</li>
<li>Signature-based scope</li>
</ul>
<p>You&#x27;ve seen an example of outer and inner capability scope in <a href="#composing-capabilities">Composing capabilities</a>.
However, it&#x27;s equally important to know the difference between top-level scope and module scope for capabilities.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="top-level-scope">Top-level scope<a href="#top-level-scope" class="hash-link" aria-label="Direct link to Top-level scope" title="Direct link to Top-level scope">​</a></h3>
<p>In Pact, the functions and expressions that you execute outside of a module declaration are often referred to as top-level expressions.
Functions and expressions that are defined within a module declaration are within the scope of that module.
For example, top-level expressions can include direct calls to built-in functions like the following:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(+ 1 2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(map (- 1) [10 20 30])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In addition, there are several top-level expressions that set context for a module that must be defined outside of the module declaration.
For example, you use top-level expressions to define and enter a namespace, define keysets, create tables, and read messages from transaction data.</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">;; Before module declaration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-namespace dev-namespace (read-keyset &quot;user-account&quot; ) (read-keyset &quot;dev-ks-account&quot; ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-keyset &quot;dev-namespace.dev-ks-account&quot; (read-keyset &quot;dev-ks-account&quot; ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;; Module declaration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;; After module declaration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(if (read-msg &#x27;upgrade)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;upgrade&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (create-table order-table)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="module-scope">Module scope<a href="#module-scope" class="hash-link" aria-label="Direct link to Module scope" title="Direct link to Module scope">​</a></h3>
<p>The functions and expressions that are defined in a module declaration are included in the scope of that module.
For example, if you define the <code>awards</code> function in the <code>league</code> module declaration, the function is within the scope of the <code>league</code> module.</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(module league GOVERNANCE </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defcap GOVERNANCE () true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   (defun awards (tier:integer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     (+ tier 2) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="acquire-a-capability-inside-of-a-module">Acquire a capability inside of a module<a href="#acquire-a-capability-inside-of-a-module" class="hash-link" aria-label="Direct link to Acquire a capability inside of a module" title="Direct link to Acquire a capability inside of a module">​</a></h3>
<p>In most cases, capabilities are defined within the scope of a module and you can acquire the access token from within the body of any function defined in the module if you meet the conditions specified in the body of the <code>defcap</code> declaration.</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(module league GOVERNANCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defcap GOVERNANCE ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (enforce-keyset league_admin))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defcap LEAGUE_OPS ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;; one or more conditions that must pass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defun awards (tier:integer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     (with-capability (LEAGUE_OPS) (+ tier 2)) ; operation succeeds if the conditions for LEAGUE_OPS are met     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For example, you can acquire the <code>league.LEAGUE_OPS</code> capability by using the <code>with-capability</code> call in any function declaration or <code>defpact</code> step in the <code>league</code> module where the <code>LEAGUE_OPS</code> capability is declared.</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(module league GOVERNANCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defcap GOVERNANCE ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (enforce-keyset league_admin))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defcap LEAGUE_OPS ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;; one or more conditions that must pass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defun awards (tier:integer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     (with-capability (LEAGUE_OPS) (+ tier 2)) ; operation succeeds if the conditions for LEAGUE_OPS are met     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defpact transfer-portal ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (step (with-capability (LEAGUE_OPS) ... )) ; operation succeeds if the conditions for LEAGUE_OPS are met</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (step ...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>These examples demonstrate the most common way you acquire the privileges associated with a capability is by calling the <code>with-capability</code> built-in function within a <code>defun</code> or <code>defpact</code> declaration inside of a module declaration.
If the conditions specified in the body of the capability declaration are met, permissions are granted and the operation proceeds.
The conditions you specify in the body of the capability declaration can vary, but typically enforce some type of guard or key signature.</p>
<p>You should also note that you can&#x27;t acquire a capability inside of a capability declaration.
For example, if you try to acquire a capability in the body of a capability declaration, you&#x27;ll see an error similar to the following:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;Loading league.pact...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">league.pact:13:7: with-capability form not allowed within defcap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 13 |       ((with-capability (LEAGUE_OPS) (* tier 2)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="acquire-a-capability-outside-of-a-module">Acquire a capability outside of a module<a href="#acquire-a-capability-outside-of-a-module" class="hash-link" aria-label="Direct link to Acquire a capability outside of a module" title="Direct link to Acquire a capability outside of a module">​</a></h3>
<p>You can acquire a capability in the top-level—that is, outside of the scope of a module—or within the scope of another module if, and only if, you have the administrative privileges to control the module and satisfy the conditions to acquire the capability.</p>
<p>The following example illustrates a module declaration for the <code>west-conf</code> module that defines a GOVERNANCE capability and an UMPIRE capability with conditions set to true to always succeed:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(module west-conf GOVERNANCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defcap GOVERNANCE () true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defcap UMPIRE () true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you deploy this module or load it into the Pact REPL, the GOVERNANCE capability grants you the administrative privileges for the transactions immediately following the deployment of the module.
For example, after you load the <code>west-conf</code> module in the Pact REPL, you can acquire the <code>UMPIRE</code> capability to perform an operation:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(with-capability (west-conf.UMPIRE) (* 3 8))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">24</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Because deploying a module grants you administrative privileges for the module, you can perform other privileged operations—like upgrading modules and creating tables—in the same deployment transaction.
In this example, there are no conditions that must be met to acquire the <code>UMPIRE</code> capability.
If there were conditions to enforce in the body of the <code>defcap</code> declaration for the <code>UMPIRE</code> capability, those conditions would need to be satisfied to perform the requested operation.</p>
<p>The previous example demonstrates the principle of using module administrator privileges to bring a capability into scope.
However, this example doesn&#x27;t represent a typical use-case.
In most cases, you want to carefully control and restrict access to capabilities to prevent unintended privilege elevation.
If access to the module administrator privileges is managed in any way—for example, owned by a specific keyset or guard or if a module is not upgradable—you must be able to acquire the module administrator rights to bring a capability into scope.</p>
<p>To acquire module administrator rights for testing purposes in the Pact REPL, you can use the <a href="/docs/pact-5/repl/env-module-admin"><code>env-module-admin</code></a> and <a href="/docs/pact-5/general/acquire-module-admin"><code>acquire-module-admin</code></a> built-in functions.</p>
<p>The following example demonstrates using the <code>acquire-module-admin</code> function to access module administrator rights for <code>module-test</code> to upgrade a module:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pact&gt; (module west-conf GOVERNANCE (defcap GOVERNANCE () (enforce false &quot;non-upgradable&quot;)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Loaded module west-conf, hash v4XXlmt7RI-HVZvPb69lQhFbh8k-luKCtWtm4OVJVU8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pact&gt; (begin-tx &quot;Begin a new transaction after deployment&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;Begin Tx 0 Begin a new transaction after deployment&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pact&gt; (use west-conf)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Loaded imports from west-conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pact&gt; (with-capability (GOVERNANCE) (* 3 8))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(interactive):1:51: non-upgradable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 1 |  (with-capability (GOVERNANCE) (* 3 8))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |                                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  at(west-conf.GOVERNANCE.{v4XXlmt7RI-HVZvPb69lQhFbh8k-luKCtWtm4OVJVU8}):(interactive):0:1-0:39</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pact&gt; (acquire-module-admin west-conf)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;Module admin for module west-conf acquired&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pact&gt; (with-capability (GOVERNANCE) (* 3 8))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">24</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To limit module administrator privileges for a capability to a specific transaction block, you can use the <code>env-module-admin</code> built-in function.</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pact&gt; (begin-tx &quot;Get module admin privileges for a transaction&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;Begin Tx 1 Get module admin privileges for a transaction&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pact&gt; (use west-conf)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Loaded imports from west-conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pact&gt; (with-capability (GOVERNANCE) (* 6 9))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(interactive):1:51: non-upgradable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 1 | (with-capability (GOVERNANCE) (* 6 9))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |                                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pact&gt; (env-module-admin west-conf)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;Acquired module admin for: west-conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pact&gt; (with-capability (GOVERNANCE) (* 6 9))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">54</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="managed-capabilities">Managed capabilities<a href="#managed-capabilities" class="hash-link" aria-label="Direct link to Managed capabilities" title="Direct link to Managed capabilities">​</a></h2>
<p>Most capabilities control permissions to access protected operations.
However, Pact also supports managed capabilities.
Managed capabilities provide an additional layer of security that requires all parties involved in a transaction to specify the actions they are authorizing with their signature or a guard.
By requiring a signature or guard to authorize an action, managed capabilities enable smart contract users to safely interact with otherwise untrusted code.</p>
<p>As a smart contract author, you specify that a capability is a managed capability by adding the <code>@managed</code> metadata tag in the <code>defcap</code> declaration body.
You can define managed capabilities to manage resources in two different ways:</p>
<ul>
<li>To update a specific resource dynamically through a <strong>management function</strong>.</li>
<li>To automatically update a resource <strong>once</strong> without using a management function.</li>
</ul>
<p>Managed capabilities that use a management function can be called multiple times.
Managed capabilities that don&#x27;t specify a management function can only be called once.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-management-functions">Using management functions<a href="#using-management-functions" class="hash-link" aria-label="Direct link to Using management functions" title="Direct link to Using management functions">​</a></h3>
<p>One of the most common use cases for managed capabilities with management functions is for transfer operations.
The following example illustrates this use case with the <code>TRANSFER</code> managed capability and the <code>TRANSFER_mgr</code> management function:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  (defcap TRANSFER:bool (sender:string receiver:string amount:decimal)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @managed amount TRANSFER-mgr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (enforce (!= sender receiver) &quot;same sender and receiver&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (enforce (&gt; amount 0.0) &quot;Positive amount&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (compose-capability (DEBIT sender))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (compose-capability (CREDIT receiver))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defun TRANSFER-mgr:decimal (managed:decimal requested:decimal)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (let ((newbal (- managed requested))) ;; update managed quantity for next time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (enforce (&gt;= newbal 0.0)            ;; check that the new balance doesn&#x27;t exceed the managed quantity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (format &quot;TRANSFER exceeded for balance {}&quot; [managed]))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      newbal)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, the <code>TRANSFER</code> capability allows the <code>sender</code> to approve any number of transfer operations to the <code>receiver</code> up to the <em>managed resource</em> specified by the <code>@managed</code> keyword.
In this case, the resource is the <code>amount</code> value and the <code>TRANSFER_mgr</code> function checks and updates that resource value each time the <code>TRANSFER</code> capability is called for in the <code>transfer</code> function:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(defun transfer:string (sender:string receiver:string amount:decimal)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (enforce (!= sender receiver) &quot;sender cannot be the receiver of a transfer&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (enforce (&gt; amount 0.0) &quot;transfer amount must be positive&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (with-capability (TRANSFER sender receiver amount)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (debit sender amount)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (with-read coin-table receiver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        { &quot;guard&quot; := g }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (credit receiver g amount))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If transfer operations exceed the <code>amount</code> value, the <code>TRANSFER</code> capability can no longer be brought into scope.</p>
<p>Smart contract users set the values for the <code>transfer</code> operation and <code>TRANSFER</code> capability and approve the operation by signing for the capability when they send the transaction to the blockchain.
Typically, you allow smart contract users to set the transfer values and approve the operation through the frontend of a smart wallet or a similar application.
For example, as a smart contract author, you enable smart contract users to construct and submit transactions that set the <code>sender</code>, <code>receiver</code>, and <code>amount</code> parameters and sign for the <code>TRANSFER</code> capability when they call the <code>transfer</code> operation.
In the Pact REPL, you can emulate setting the keys in the environment data and signing the capability.
For example:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(env-data {&quot;alice&quot;:[&quot;alice&quot;], &quot;bob&quot;:[&quot;bob&quot;]})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(env-sigs [{&quot;key&quot;:&quot;alice&quot;, &quot;caps&quot;:[(pistolas-coin.TRANSFER &quot;alice&quot; &quot;bob&quot; 50.0)]}])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(pistolas-coin.transfer &quot;alice&quot; &quot;bob&quot; 40.0)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You should note that managed capabilities always require smart contract users to explicitly approve the operation to be performed.
If a transaction includes a managed capability, all capabilities involved in the transaction require a signature.
Unrestricted keys aren&#x27;t allowed if a transaction includes a managed capability.</p>
<p>In most cases, managed resources represent decimal or integer values, but you can use managed capabilities and management functions to manage any type of resource.
For example, you could specify a list or an object as the resource you want to manage, then write a management function that removes names from the list or updates object properties based on some condition.
However, the <code>@managed</code> keyword only allows you to specify a single resource to be managed—that is, updated—by the management function.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="single-use-managed-capabilities">Single-use managed capabilities<a href="#single-use-managed-capabilities" class="hash-link" aria-label="Direct link to Single-use managed capabilities" title="Direct link to Single-use managed capabilities">​</a></h3>
<p>Managed capabilities that specify a management function update the managed resource dynamically each time the requested capability is acquired.
If a managed capability doesn&#x27;t specify a management function, the requested capability can only be called once in a transaction.
Further attempts will fail after the initial grant goes out of scope.</p>
<p>In the following example, the VOTE capability is automatically managed to ensure that a validated member can only vote once:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(defcap VOTE (member:string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @managed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (validate-member member))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="scoped-signatures-and-verifiers">Scoped signatures and verifiers<a href="#scoped-signatures-and-verifiers" class="hash-link" aria-label="Direct link to Scoped signatures and verifiers" title="Direct link to Scoped signatures and verifiers">​</a></h2>
<p>In Pact transaction messages, transaction signers can <strong>scope</strong> their signature to one or more specific capabilities.
By scoping signatures to specific capabilities, smart contract users can restrict guard operations based on that signature.
These explicitly-authorized actions are separate from the Pact code that&#x27;s executed in the transaction.
Regardless of the code that runs during the transaction, scoped capabilities ensure that only authorized actions can be performed on the user&#x27;s behalf.</p>
<p>Unlike managed capabilities that require a signature or a guard and a managed resource, most capabilities allow users to sign transactions using an unrestricted signing key.
Scoped capabilities provide a transparent way for transaction signers to safely call untrusted code.
For example, the <code>sender</code> of a transaction can explicitly sign for the <code>GAS</code> capability to authorize gas payments in the <code>coin</code> contract.
By scoping the signature to this capability, the account signature can&#x27;t be used to access any other code that might be called by the transaction.</p>
<p>If a user authorizes a specific capability, the capability is attached to the signature list for the transaction.
For example, the following transaction excerpt attaches two capabilities—coin.TRANSFER and coin.GAS—to the public key &quot;fe4b6da332193cce4d3bd1ebdc716a0e4c3954f265c5fddd6574518827f608b7&quot; signature:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;signers&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;pubKey&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;fe4b6da332193cce4d3bd1ebdc716a0e4c3954f265c5fddd6574518827f608b7&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;clist&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;coin.TRANSFER&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;args&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;k:fe4b6da3...27f608b7&quot;</span><span class="token plain"> &quot;k</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">4fe7981d...0bc284d0\&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;coin.GAS&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;args&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The following example illustrates an <code>accounts</code> module with a <code>PAY</code> capability that isn&#x27;t managed:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(begin-tx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(module accounts GOVERNANCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defcap GOVERNANCE ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (enforce false &quot;NON-UPGRADABLE&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defschema account</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    balance:decimal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    account-guard:guard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (deftable accounts-table:{account})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defcap PAY (sender:string receiver:string amount:decimal)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (enforce-guard (at &#x27;account-guard (read accounts-table sender))))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defun pay (sender:string receiver:string amount:decimal)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (with-capability (PAY sender receiver amount)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (transfer sender receiver amount)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defun transfer (sender:string receiver:string amount:decimal)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (with-read accounts-table sender</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      { &quot;balance&quot; := b}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (with-read accounts-table receiver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {&quot;balance&quot; := to-balance}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          (update accounts-table receiver {&quot;balance&quot;:(+ to-balance amount)})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          (update accounts-table sender {&quot;balance&quot;:(- b amount)})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(create-table accounts-table)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(env-data {&quot;alice&quot;:[&quot;alice&quot;], &quot;bob&quot;:[&quot;bob&quot;]})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(write accounts-table &quot;alice&quot; {&quot;balance&quot;:100.0, &quot;account-guard&quot;:(read-keyset &quot;alice&quot;)})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(write accounts-table &quot;bob&quot; {&quot;balance&quot;:100.0, &quot;account-guard&quot;:(read-keyset &quot;bob&quot;)})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(commit-tx)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the Pact REPL, you can attach the signature for the <code>alice</code> key to the <code>accounts.PAY</code> capability by using the <code>env-sigs</code> built-in function as follows:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(env-sigs [{&quot;key&quot;: &quot;alice&quot;, &quot;caps&quot;: [(accounts.PAY &quot;alice&quot; &quot;bob&quot; 10.0)]}])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(accounts.pay &quot;alice&quot; &quot;bob&quot; 10.0) ;; works as the cap matches the signature caps</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you modify the scoped capability to use a different receiver or amount, the transaction returns a keyset failure.</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(env-sigs [{&quot;key&quot;: &quot;alice&quot;, &quot;caps&quot;: [(accounts.PAY &quot;alice&quot; &quot;carol&quot; 10.0)]}])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(accounts.pay &quot;alice&quot; &quot;bob&quot; 10.0)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For example:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cope-pay.repl:14:4: Keyset failure (keys-all): [alice...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 14 |     (enforce-guard (at &#x27;account-guard (read accounts-table sender))))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  at(accounts.PAY.{z5Kc3VKBgIr085VLRK2n1rMdlmIxi-NN-P7lYfA6xqg} &quot;alice&quot; &quot;bob&quot; 10.0):scope-pay.repl:16:4-17:40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  at(accounts.pay.{z5Kc3VKBgIr085VLRK2n1rMdlmIxi-NN-P7lYfA6xqg} &quot;alice&quot; &quot;bob&quot; 10.0):scope-pay.repl:40:0-40:33</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Scoped capabilities can also be installed by <a href="https://github.com/kadena-io/KIPs/pull/57" target="_blank" rel="noopener noreferrer"><em>verifier plug-ins</em></a>.
Capabilities that are installed by verifier plug-ins are also scoped to the specific capabilities that they install.
Verifier plugins are external to Pact.
However, they are similar to signature capabilities in that they enable you to specify some type of trusted entity—for example, a signature or a generated proof—that grants the capabilities to perform some type of protected operation.
A signature capability can use the <code>(enforce-guard g)</code> function to check that the keyset guard <code>g</code> includes the signer&#x27;s key.
A capability granted by a verifier plug-in can use the <code>(enforce-verifier &#x27;name)</code> function to check that <code>&quot;name&quot;</code> is the name of the verifier plug-in.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="events">Events<a href="#events" class="hash-link" aria-label="Direct link to Events" title="Direct link to Events">​</a></h2>
<p>In Pact, events are emitted as part of transaction execution and are included in the transaction results.
With events, you can monitor transaction results to determine if a specific operation occurred and prove the outcome using a simple payment verification proof.</p>
<p>Events are treated as capabilities because they share the following characteristics:</p>
<ul>
<li>Events, like capabilities, allow arbitrary data to be published under a topic or a name.
With capabilities, the capability name is the topic, and the arguments are the data.</li>
<li>Granting permission to acquire a managed capability is, in itself, an event recorded for transaction.
Events complete the managed capability lifecycle, where you might install or approve a capability of some quantity on the way in, but not necessarily see what quantity was used.
With events, the output of the acquired capability is present in the transaction results.</li>
<li>Capabilities are protected such that they can only be acquired in module code, which is appropriate for events as well.</li>
</ul>
<p>You can emit events for any basic capability by including the <code>@event</code> metadata tag in the <code>defcap</code> declaration.
For example:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(defcap BURN:decimal (qty:decimal)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you include the <code>@event</code> metadata tag in the <code>defcap</code> declaration, the event is emitted any time that capability is successfully acquired.
Basic capabilities that aren&#x27;t managed can emit events any number of times.</p>
<p>Managed capabilities emit events automatically without specifying the <code>@event</code> metadata tag.
The event for a managed capability is emitted once when the capability is first installed or acquired.
Events from managed capabilities include the parameters specified when the capability was installed or acquired.</p>
<p>You can use the <a href="/docs/pact-5/repl/env-events"><code>env-events</code></a> built-in function to test for emitted events in <code>.repl</code> scripts.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/kda-community/kadena-docs-new/blob/master/docs/smart-contracts/capabilities.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/smart-contracts/modules"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Modules and interfaces</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/smart-contracts/guards"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Guards</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#permissions-resources-and-events" class="table-of-contents__link toc-highlight">Permissions, resources, and events</a></li><li><a href="#expressing-basic-capabilities" class="table-of-contents__link toc-highlight">Expressing basic capabilities</a></li><li><a href="#calling-basic-capabilities" class="table-of-contents__link toc-highlight">Calling basic capabilities</a></li><li><a href="#managed-capabilities" class="table-of-contents__link toc-highlight">Managed capabilities</a></li><li><a href="#scoped-signatures-and-verifiers" class="table-of-contents__link toc-highlight">Scoped signatures and verifiers</a></li><li><a href="#events" class="table-of-contents__link toc-highlight">Events</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 - Kadena LLC (<a href="https://www.kadena.io/privacy-policy" target="_blank">Privacy</a>)</div></div></div></footer><div class="footer-consent-link"><button>Analytics Consent</button></div></div>
</body>
</html>