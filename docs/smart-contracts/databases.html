<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-smart-contracts/databases" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Database model | Kadena Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kda-chain.org/docs/img/kadena-opengraph.png"><meta data-rh="true" name="twitter:image" content="https://kda-chain.org/docs/img/kadena-opengraph.png"><meta data-rh="true" property="og:url" content="https://kda-chain.org/docs/smart-contracts/databases"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Database model | Kadena Docs"><meta data-rh="true" name="description" content="Kadena blockchain nodes store information in two different data stores, with a key-value store that keeps track of information about nodes, chains, and blocks and a SQL-based database that stores information about Pact smart contracts and transactions."><meta data-rh="true" property="og:description" content="Kadena blockchain nodes store information in two different data stores, with a key-value store that keeps track of information about nodes, chains, and blocks and a SQL-based database that stores information about Pact smart contracts and transactions."><link data-rh="true" rel="icon" href="/docs/img/kadena-favicon.png"><link data-rh="true" rel="canonical" href="https://kda-chain.org/docs/smart-contracts/databases"><link data-rh="true" rel="alternate" href="https://kda-chain.org/docs/smart-contracts/databases" hreflang="en"><link data-rh="true" rel="alternate" href="https://kda-chain.org/docs/smart-contracts/databases" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://6UVWQF4IS8-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Kadena Docs" href="/docs/opensearch.xml"><link rel="stylesheet" href="/docs/assets/css/styles.01d78354.css">
<script src="/docs/assets/js/runtime~main.2ef1040c.js" defer="defer"></script>
<script src="/docs/assets/js/main.9cf849d4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/kadena-docs-light.png" alt="Kadena Documentation" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="196"><img src="/docs/img/kadena-docs-dark.png" alt="Kadena Documentation" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="196"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/quickstart">Get Started</a><a href="https://discord.com/invite/kadena" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Support<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kda-community/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link github-link-icon"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quickstart">Quick start</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/smart-contract-dev">Smart contracts</a><button aria-label="Collapse sidebar category &#x27;Smart contracts&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/get-started-intro">Get started: Introduction to Pact</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/smart-contracts/install">Installation and setup</a><button aria-label="Expand sidebar category &#x27;Installation and setup&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/basic-concepts">Basic concepts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/accounts">Accounts, keys, and principals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/lang-features">Pact features and conventions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/functions-variables">Functions, variables, and types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/modules">Modules and interfaces</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/capabilities">Capabilities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/guards">Guards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/smart-contracts/databases">Database model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/transactions">Transaction format and flow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/best-practices">Pact best practices</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/guides">How-to guides</a><button aria-label="Expand sidebar category &#x27;How-to guides&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/api">API</a><button aria-label="Expand sidebar category &#x27;API&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference">Reference</a><button aria-label="Expand sidebar category &#x27;Reference&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/coding-projects/coding-projects">Coding projects</a><button aria-label="Expand sidebar category &#x27;Coding projects&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/resources">Resources</a><button aria-label="Expand sidebar category &#x27;Resources&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/smart-contract-dev"><span itemprop="name">Smart contracts</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Database model</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Database model</h1></header>
<p>Kadena blockchain nodes store information in two different data stores.
On each Chainweb node, there&#x27;s a RocksDB key-value store that keeps track of information about the peer network, chains, and blocks.
Each node also hosts a set of SQLite database files that store information about Pact smart contracts and transaction results with one file for each chain in the network.</p>
<p>The following diagram presents a simplified view of this separation of concerns.</p>
<p><img decoding="async" loading="lazy" alt="Data store overview" src="/docs/assets/images/docs-database-model-82b28db3035befa34f202504fdd33f99.png" width="2672" height="1560" class="img_ev3q"></p>
<p>As a smart contract developer, you&#x27;re primarily interested in writing to and reading from the Pact state, but it&#x27;s helpful to know how data is organized and optimized for different execution modes and to perform different tasks.
The RocksDb database—sometimes referred to as the chain database—is optimized for efficient network communication and resiliency.
Pact database operations are optimized for transaction performance.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="working-with-pact-tables">Working with Pact tables<a href="#working-with-pact-tables" class="hash-link" aria-label="Direct link to Working with Pact tables" title="Direct link to Working with Pact tables">​</a></h2>
<p>Tables are a core component of Pact smart contracts because they enable you to store, manipulate, and read data using familiar patterns.
Interacting with Pact databases is much like interacting with any other type of database, but with constraints that reflect the unique requirements of blockchain execution.
For example, working with Pact databases is similar to working with other SQL-based databases, with similar database operations.
There are built-in functions to insert, read, and update values stored in tables.</p>
<table><thead><tr><th style="text-align:left">Function type</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left"><a href="/docs/pact-5/database/insert">Insert</a></td><td style="text-align:left">Insert new rows into a table.</td></tr><tr><td style="text-align:left"><a href="/docs/pact-5/database/read">Read</a></td><td style="text-align:left">Read values from a table.</td></tr><tr><td style="text-align:left"><a href="/docs/pact-5/database/update">Update</a></td><td style="text-align:left">Update values for a column that contains data in a table.</td></tr><tr><td style="text-align:left"><a href="/docs/pact-5/database/write">Write</a></td><td style="text-align:left">Write values for a column in a table, regardless of whether the column contains data or not.</td></tr><tr><td style="text-align:left">Delete</td><td style="text-align:left">Not available in Pact.</td></tr></tbody></table>
<p>If you&#x27;ve worked with other databases or programming languages, you should be familiar with similar functions that enable you to create, read, update, and delete (CRUD) information.
However, in Pact, you use the <code>insert</code> function in place of the create functionality to add rows to a table and there isn&#x27;t a function to delete rows from a table.</p>
<p>Although Pact doesn&#x27;t provide a delete function, you can use an <code>active</code> column in tables to mark table rows as active or inactive.
For more information about using an active column to indicate active and inactive rows, see <a href="#identifying-active-and-inactive-rows">Identifying active and inactive rows</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-access-model">Data access model<a href="#data-access-model" class="hash-link" aria-label="Direct link to Data access model" title="Direct link to Data access model">​</a></h3>
<p>Most smart contracts use one or more tables to store all of the information required for the application or service that the smart contract provides.
You access the information stored in Pact tables by using the table&#x27;s <em>key-row</em> structure.
This access model is similar to using a primary key to access table data in other relational databases.</p>
<p>With the Pact <em>key-row</em> model, you access a row of column values by using a single key.
As a result of this access model, Pact doesn&#x27;t support <em>joining</em> tables in a way that an online analytical processing database would support if populated from data exported from the Pact database.
However, Pact can record transactions using relational techniques.
For example, if you have a <code>Customer</code> table with keys used in a <code>Sales</code> table, a Pact smart contract could include code to look up the <code>Customer</code> record before writing to the <code>Sales</code> table.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="null-values-arent-allowed">Null values aren&#x27;t allowed<a href="#null-values-arent-allowed" class="hash-link" aria-label="Direct link to Null values aren&#x27;t allowed" title="Direct link to Null values aren&#x27;t allowed">​</a></h3>
<p>The Pact database model doesn&#x27;t support NULL values as a safety feature to ensure <em>totality</em> for transactions and to avoid unsafe control-flow for handling null values.
The main function for working with database results is the <a href="/docs/pact-5/database/with-read">with-read</a> function.
This function will return an error if any column value it attempts to read isn&#x27;t found.
To prevent transactions from failing with these errors, you should ensure that there are values in the columns you attempt to read in a transaction.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="versioned-history">Versioned history<a href="#versioned-history" class="hash-link" aria-label="Direct link to Versioned history" title="Direct link to Versioned history">​</a></h3>
<p>The key-row model is augmented by every change to column values being versioned by a transaction identifier.
For example, if you have a table with columns for <code>name</code>, <code>age</code>, and <code>role</code>, you might update the <code>name</code> column in a transaction with the identifier 100, and later update the <code>age</code> and <code>role</code> columns in a transaction identified as 102.
If you retrieve historical data for the table, only the change to the <code>name</code> column is returned for transaction identifier 100 and only the change to <code>age</code> and <code>role</code> columns are returned for transaction 102.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="table-creation">Table creation<a href="#table-creation" class="hash-link" aria-label="Direct link to Table creation" title="Direct link to Table creation">​</a></h2>
<p>Tables are defined by <strong>schemas</strong> in module declarations.
The schema defines the table columns, field values, and field types.
The module declaration also specifies the table name to associate with each schema you define.
There&#x27;s no restriction on the number of tables you can create.</p>
<p>The tables specified in the module declaration are <a href="/docs/pact-5/database/create-table">created</a> after the module declaration, and the table name is prepended with the module name, so that the module becomes the table owner.</p>
<p>It’s important to note this distinction between when tables are defined and when tables are created.
You define table schemas, the table associated with each schema, and the functions that insert, read, and modify database records inside of module code. You create the tables outside of module code.
The module acts as a guard to protect access to database functions and database records.
This separation also allows module code to be updated without necessarily recreating the table in Pact state.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="table-schemas">Table schemas<a href="#table-schemas" class="hash-link" aria-label="Direct link to Table schemas" title="Direct link to Table schemas">​</a></h2>
<p>Before you create a table in Pact, you must define its schema.
The schema describes the structure of the table by specifying the columns and data types for the values to be stored in the table.
Schemas are defined within the Pact module declarations by using the <a href="/docs/reference/syntax#defschema">defschema</a> keyword and consist of a
series of <strong>field names</strong> and <strong>field types</strong>.</p>
<p>Each field name specifies a column in the table, and each field type specifies the type of data held in that field.</p>
<p>In the following example, the <strong>accounts</strong> table has three columns with the field names  <strong>balance</strong>, <strong>amount</strong>, and <strong>currency</strong>:</p>
<table><thead><tr><th style="text-align:left">Field name</th><th style="text-align:left">Field type</th></tr></thead><tbody><tr><td style="text-align:left">balance</td><td style="text-align:left">decimal</td></tr><tr><td style="text-align:left">amount</td><td style="text-align:left">decimal</td></tr><tr><td style="text-align:left">currency</td><td style="text-align:left">string</td></tr></tbody></table>
<p>In this example, the <strong>balance</strong> and <strong>amount</strong> columns require <code>decimal</code> as the data type and the currency column requires data to be a <code>string</code> value.
You can create the schema for this table in Pact like this:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(defschema accounts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Schema for accounts table.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  balance:decimal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  amount:decimal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  currency:string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>All table schemas you create look similar to this example, but with different field names and data types.
Field names must start with a valid alphabetic character, but can contain alphabetic, numeric, and special characters.
In general, you should use field names that are short but recognizable.
For each field, the field type must be one the data types that Pact supports.</p>
<p>Types that are declared in code are enforced at runtime when expressions are evaluated.
For tables, any write to a table is type-checked against the table schema to ensure the data matches the expected type.
Execution fails if type checking fails.</p>
<p>For information about the data types that Pact supports, see <a href="/docs/smart-contracts/lang-features#data-types">Data types</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="table-definition">Table definition<a href="#table-definition" class="hash-link" aria-label="Direct link to Table definition" title="Direct link to Table definition">​</a></h2>
<p>In Pact, tables are defined inside of the module declaration by using the <code>deftable</code> keyword.
The table definition accomplishes two goals:</p>
<ul>
<li>It associates a table name with a specific table schema of columns and data types.</li>
<li>It defines the table inside of the module namespace.</li>
</ul>
<p>There&#x27;s no limit to the number of tables you can define in a module.
Because the table is defined inside of a module, direct access to the table using database functions is only authorized for the module owner, that is, its administrative keyset or governance capability.
However, module functions have unrestricted access to the table by default.
With this default behavior, the module acts as the main entry point for all user interaction.
You can restrict access to tables inside of the module by using <a href="#row-level-keysets">row-level keysets</a> and enforcing the keyset guard for specific functions.</p>
<p>The following example illustrates using the deftable keyword to define an <strong>accounts-table</strong> table that uses the <strong>accounts</strong> schema:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(deftable accounts-table:{accounts})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Notice that the table and schema are represented as a pair, separated by a colon (<code>:</code>).
The curly braces (<code>{ }</code>) around the schema name are there because the schema is an object.</p>
<p>The schema name and table name must be different from one another.
In general, you should use table and schema names that are similar to each other or follow a consistent convention to avoid confusion:
For example:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(deftable cat-table:{cats})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(deftable asset-tracker:{assets})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-module-tables">Create module tables<a href="#create-module-tables" class="hash-link" aria-label="Direct link to Create module tables" title="Direct link to Create module tables">​</a></h2>
<p>After you have defined all of the tables for your module inside of the module declaration, you can create those tables outside of the module.
Creating the table outside of the module ensures that other parts of the module logic can be redefined or updated without recreating the table.</p>
<p>You can created tables after the module declaration by using the <a href="/docs/pact-5/database/create-table">create-table</a> function followed by the table name as it&#x27;s defined in the module declaration.
For example:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(create-table accounts-table)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(create-table cat-table)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(create-table asset-tracker)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="insert">Insert<a href="#insert" class="hash-link" aria-label="Direct link to Insert" title="Direct link to Insert">​</a></h2>
<p>You can use the <a href="/docs/pact-5/database/insert">insert</a> function to add new data to a table.
You can use <code>insert</code> function to add any type of new artifact with a key value.
For example, you can use a key value to add a row of data about accounts, customers, loans, or assets.</p>
<p>The following example illustrates adding a row to the <code>accounts-table</code> using the <code>insert</code> function with the key value
&quot;account-1&quot;.</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(insert accounts-table “account-1” { &quot;balance&quot;: 12.3, &quot;amount&quot;: 0.0, &quot;currency&quot;:&quot;USD&quot;})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that the key must be a string value.
This example adds the following row to the <code>accounts-table</code>:</p>
<table><thead><tr><th style="text-align:left">key</th><th style="text-align:left">balance</th><th style="text-align:left">amount</th><th style="text-align:left">currency</th></tr></thead><tbody><tr><td style="text-align:left">account-1</td><td style="text-align:left">12.3</td><td style="text-align:left">0.0</td><td style="text-align:left">USD</td></tr></tbody></table>
<p>You can also use the <code>insert</code> function inside of another function to add new data to rows in a table from the input values for the function.
For example:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(defun create-account (id balance amount currency)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (insert accounts-table id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       { &quot;balance&quot;: balance,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;amount&quot; : amount,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;currency&quot;: currency })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, the row inserted into the <code>accounts-table</code> takes the values entered for the <code>create-account</code> function.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="read">Read<a href="#read" class="hash-link" aria-label="Direct link to Read" title="Direct link to Read">​</a></h2>
<p>You can use the <a href="/docs/pact-5/database/read">read</a> function to read a row of data from a specified table for a specified key value.</p>
<p>In the following example, the <code>accounts-table</code> has two rows of data storing the account balance and currency for <strong>account-1</strong> and <strong>account-2</strong>:</p>
<table><thead><tr><th>key</th><th>balance</th><th>currency</th></tr></thead><tbody><tr><td>account-1</td><td>4.00</td><td>USD</td></tr><tr><td>account-2</td><td>3.00</td><td>USD</td></tr></tbody></table>
<p>You can use the <code>read</code> function to retrieve the information for the key value.
For example, you can get the <code>balance</code> and <code>currency</code> information for <code>account-1</code> like this:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(read accounts-table account-1 [&#x27;balance &#x27;ccy])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can also use the <code>read</code> function inside of another function like this.</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(defun read-accounts (1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (read accounts id [‘balance ‘ccy])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In each example, the <code>read</code> functions returns the following values:</p>
<table><thead><tr><th style="text-align:left">balance</th><th style="text-align:left">currency</th></tr></thead><tbody><tr><td style="text-align:left">4.00</td><td style="text-align:left">USD</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="update">Update<a href="#update" class="hash-link" aria-label="Direct link to Update" title="Direct link to Update">​</a></h2>
<p>You can use the <a href="/docs/pact-5/database/update">update</a> function to update one or more values in an existing row of a table.
Updates enable you to change the status of a column or amend the initial dataset to record a new value.</p>
<p>With the <code>update</code> function, you specify the key for the row you want to update, the field you want to update, and the new value for the field in that that row.
In most cases, you use <code>update</code> functions in other functions to allow users to input new values.</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(update table-name id {&quot;field&quot;: new-value})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The following example illustrates updating the <code>status</code> field for an asset in the <code>assets-table</code>.
Before updating the  <code>assetPrice</code>, the  <code>assets-table</code> has the following fields and values.</p>
<table><thead><tr><th style="text-align:left">assetID</th><th style="text-align:left">assetName</th><th style="text-align:left">assetPrice</th><th style="text-align:left">status</th></tr></thead><tbody><tr><td style="text-align:left">asset-1</td><td style="text-align:left">My Asset</td><td style="text-align:left">5.0</td><td style="text-align:left">todo</td></tr></tbody></table>
<p>For this example, the <code>asset-update</code> function updates the <code>status</code> column, then reads the value of the updated column.</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(defun asset-update (assetId:string new-status:string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (update assets-table assetId {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;status&quot;: new-status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (read asset-table assetId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="select">Select<a href="#select" class="hash-link" aria-label="Direct link to Select" title="Direct link to Select">​</a></h2>
<p>You can use the <a href="/docs/pact-5/database/select">select</a> function to select values from one or more rows in a table.
The <code>select</code> function is similar to the <code>read</code> function except that the <code>read</code> function retrieves information for a single key-row value.
The <code>select</code> function enables you to retrieve multiple rows from a table based on the criteria you provide.
Because you can specify other criteria and not just a single key-row value, the <code>select</code> function provides you with more flexibility in what information you choose to return.</p>
<p>The syntax for the Pact <code>select</code> function is similar to the syntax for standard SQL <code>SELECT</code> statements.
In its simplest form, the <code>select</code> statement retrieves all values from a specified table.
In the following example, the <code>select</code> statement is used in a <code>select-assets</code> function to return all values from the <code>assets-table</code>:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  (defun select-assets ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (select assets-table (constantly true))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This query returns all of the values currently stored in the <code>assets-table</code> fields.
For example:</p>
<table><thead><tr><th style="text-align:left">assetId</th><th style="text-align:left">assetName</th><th style="text-align:left">assetPrice</th><th style="text-align:left">status</th></tr></thead><tbody><tr><td style="text-align:left">asset-1</td><td style="text-align:left">My Asset</td><td style="text-align:left">5.0</td><td style="text-align:left">todo</td></tr><tr><td style="text-align:left">asset-2</td><td style="text-align:left">Asset 2</td><td style="text-align:left">6.0</td><td style="text-align:left">in progress</td></tr><tr><td style="text-align:left">asset-3</td><td style="text-align:left">Asset 3</td><td style="text-align:left">7.0</td><td style="text-align:left">done</td></tr></tbody></table>
<p>Like standard SQL <code>SELECT</code> statements, you can use a <code>where</code> clause to refine your results.
For example, you can return only the <code>assetName</code> and <code>assetPrice</code> for a specific asset name like this:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  (select assets-table [&#x27;assetName,&#x27;assetPrice] (where &#x27;assetName (= &quot;Asset 2&quot;)))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This query returns the following values from the sample <code>assets-table</code>:</p>
<table><thead><tr><th>assetName</th><th>assetPrice</th></tr></thead><tbody><tr><td>Asset 2</td><td>6.0</td></tr></tbody></table>
<p>You can also specify operators—such as greater than (<code>&gt;</code>) or less than (<code>&lt;</code>)—from within the <code>where</code> clause.
For example:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  (select assets-table (where &#x27;assetPrice (&gt; 6.0)))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This query returns the following values from the sample <code>assets-table</code>:</p>
<table><thead><tr><th>key</th><th>assetName</th><th>assetPrice</th><th>status</th></tr></thead><tbody><tr><td>asset-3</td><td>Asset 3</td><td>7.0</td><td>done</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="select-queries-and-performance">Select queries and performance<a href="#select-queries-and-performance" class="hash-link" aria-label="Direct link to Select queries and performance" title="Direct link to Select queries and performance">​</a></h3>
<p>You should note that when you write queries using the Pact <code>select</code> function, the <code>select</code> and <code>where</code> operations provide a streaming interface that applies filters to the specified table, then operates on the row set as a list data structure using <a href="/docs/pact-5/general/sort">sort</a> and other functions.
Because of the computational overhead, you should avoid using <code>select</code> statements to work with on-chain data.</p>
<p>Although it can be convenient to use select statements to retrieve data, you can often return the same results more efficiently using other functions.
For example, the following query selects <code>Programmers</code> with salaries &gt;= 90000 and sorts by <code>age</code> in descending order:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(reverse (sort [&#x27;age]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (select &#x27;employees [&#x27;first-name,&#x27;last-name,&#x27;age]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (and? (where &#x27;title (= &quot;Programmer&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          (where &#x27;salary (&lt;= 90000))))))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can write the same query using the <code>filter</code> function and sorting the resulting list like this:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(reverse (sort [&#x27;age]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (filter (and? (where &#x27;title (= &quot;Programmer&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                (where &#x27;salary (&lt; 90000)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          employees))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For performance reasons, Pact database interactions are optimized for single-row reads and writes.
Queries that use the <code>select</code> statement to scan multiple rows in a table can be slow and prohibitively expensive computationally.
Therefore, the best practice is to use <code>select</code> statements in local, non-transactional operations and to avoid using <code>select</code> on large tables in functions that perform transactional operations.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="transactional-and-local-execution">Transactional and local execution<a href="#transactional-and-local-execution" class="hash-link" aria-label="Direct link to Transactional and local execution" title="Direct link to Transactional and local execution">​</a></h3>
<p>Pact doesn&#x27;t distinguish between transactional and local execution.
However, transactions typically involve business events that must be executed and recorded in a timely fashion.
Queries rarely represent a business event, and can often involve data payloads that could impact performance.
The best practice is to query data locally on a node by using the <code>/local</code> endpoint.
You can also query historical data using the <code>/local</code> endpoint and a <em>transaction identifier</em> as a point of reference.</p>
<p>For transactions, you should use the <code>/send</code> endpoint.</p>
<p>For more information about transaction execution, see <a href="/docs/smart-contracts/transactions">Transaction lifecycle</a>.
For more information about Pact endpoints, see <a href="/docs/api/pact-api">Pact API</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="keys">Keys<a href="#keys" class="hash-link" aria-label="Direct link to Keys" title="Direct link to Keys">​</a></h2>
<p>You can use the <a href="/docs/pact-5/database/keys">keys</a> function from within a module to return all of the <strong>key</strong> values in a table.
For example, you can return the <code>key</code> values for the sample <code>assets-table</code> with the following code:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(module asset-manager ADMIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defcap ADMIN () true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defschema assets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     assetId:string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     assetName:string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     assetPrice:decimal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     status:string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (deftable assets-table:{assets})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (keys assets-table)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can also use the <code>keys</code> function within another function.
For example:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  (defun get-keys (table-name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (keys table-name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="row-level-keysets">Row-level keysets<a href="#row-level-keysets" class="hash-link" aria-label="Direct link to Row-level keysets" title="Direct link to Row-level keysets">​</a></h2>
<p>Keysets can be stored as a column value in a row, allowing for row-level authorization. The following code indicates how this might be achieved:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(defun create-account (id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (insert accounts-table id { &quot;balance&quot;: 0.0, &quot;keyset&quot;: (read-keyset &quot;owner-keyset&quot;) }))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(defun read-balance (id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (with-read accounts-table id { &quot;balance&quot;:= bal, &quot;keyset&quot;:= ks }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (enforce-keyset ks)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (format &quot;Your balance is {}&quot; [bal])))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, the <code>create-account</code> function reads the <code>owner-keyset</code> definition from the message payload using <code>read-keyset</code>, then stores it in the <code>keyset</code> column in the <code>accounts-table</code> table.
The <code>read-balance</code> function only allows the <code>owner-keyset</code> to read the balance by first enforcing the keyset using <code>enforce-keyset</code> function.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="changing-a-table-schema">Changing a table schema<a href="#changing-a-table-schema" class="hash-link" aria-label="Direct link to Changing a table schema" title="Direct link to Changing a table schema">​</a></h2>
<p>As noted in <a href="#create-module-tables">Create module tables</a>, you can update contract functions without updating or recreating database tables.
However, you can&#x27;t modify the table schema when you update a contract.
In general, Pact doesn&#x27;t support database migration or schema and table upgrades.
To update a database, you must declare new tables and define any data migration functions as part of a module load step for the new module that contains the modified table schema.</p>
<p>To update a table schema:</p>
<ol>
<li>Create a new module and declare the new table schema.</li>
<li>Add functions to read rows from the old table and write them to the new table.</li>
<li>Deploy the updated module with the new table schema on the network.</li>
</ol>
<p>The original table and database state remain unchanged on the blockchain, but won&#x27;t receive any new information after you deploy the new module.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="identifying-active-and-inactive-rows">Identifying active and inactive rows<a href="#identifying-active-and-inactive-rows" class="hash-link" aria-label="Direct link to Identifying active and inactive rows" title="Direct link to Identifying active and inactive rows">​</a></h2>
<p>Pact doesn&#x27;t provide a delete function because of the potential issues with performance, data integrity, and data migration that row-level delete operations can introduce.
In addition, being able to delete rows or tables violates one of the most important properties of a blockchain environment: that it provides an immutable record of state.</p>
<p>Because deleting information from tables could also cause problems for replaying transactions or synchronizing nodes and leave the chain in an unhealthy state, Pact doesn&#x27;t support deleting rows or tables.
However, you can use an <code>active</code> column in tables to identify active table rows on insert, then later flag rows with obsolete information as inactive.
Inactive rows remain in the database, but you can write logic to prevent them from being updated or retrieved.</p>
<p>For example, you might define the <code>user</code> schema and <code>users-table</code> like this:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   (defschema user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       nickname:string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       keyset:guard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       active:bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   (deftable users-table:{user})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To add new users to the table, you might define a <code>create-user</code> function similar to the following:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   (defun create-user (id:string nickname:string keyset:guard active:bool)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (enforce-keyset &quot;free.operate-admin&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (insert users-table id {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;keyset&quot;: keyset,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;nickname&quot;: nickname,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;active&quot;: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can then define a separate function to identify rows—using the <code>id</code> key-row—that are no longer active similar to the following:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (defun tombstone:string (id:string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       &quot;Mark the specified row as inactive&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       (update users-table id { &quot;active&quot; : false })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can then check whether the <code>active</code> column is <code>true</code> or <code>false</code> for a specific row before allowing the row to be updated with code similar to the following:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   (defun change-nickname (id:string new-name:string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (with-read users-table id {&quot;active&quot; := active}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (if (= active true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          (update users-table id { &quot;nickname&quot;: new-name })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          (format &quot;Update NOT ALLOWED for user {}&quot; [id])))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For example, you can set the <code>active</code> column to <code>false</code> for the row identified by <code>tai</code> with a call similar to this:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(tombstone &quot;tai&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;Write succeeded&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you then attempt to update the <code>nickname</code> column for the <code>tai</code> row, you&#x27;ll see the message that the change isn&#x27;t allowed:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(change-nickname &quot;tai&quot; &quot;INACTIVE USER Tai&#x27;s Nickname&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;Update NOT ALLOWED for user tai&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/pact">pact</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/beginner">beginner</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/schemas-and-tables">schemas and tables</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/schemas">schemas</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/tables">tables</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/pact-tutorials">pact tutorials</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/kda-community/kadena-docs-new/blob/master/docs/smart-contracts/databases.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/smart-contracts/guards"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Guards</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/smart-contracts/transactions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Transaction format and flow</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#working-with-pact-tables" class="table-of-contents__link toc-highlight">Working with Pact tables</a></li><li><a href="#table-creation" class="table-of-contents__link toc-highlight">Table creation</a></li><li><a href="#table-schemas" class="table-of-contents__link toc-highlight">Table schemas</a></li><li><a href="#table-definition" class="table-of-contents__link toc-highlight">Table definition</a></li><li><a href="#create-module-tables" class="table-of-contents__link toc-highlight">Create module tables</a></li><li><a href="#insert" class="table-of-contents__link toc-highlight">Insert</a></li><li><a href="#read" class="table-of-contents__link toc-highlight">Read</a></li><li><a href="#update" class="table-of-contents__link toc-highlight">Update</a></li><li><a href="#select" class="table-of-contents__link toc-highlight">Select</a></li><li><a href="#keys" class="table-of-contents__link toc-highlight">Keys</a></li><li><a href="#row-level-keysets" class="table-of-contents__link toc-highlight">Row-level keysets</a></li><li><a href="#changing-a-table-schema" class="table-of-contents__link toc-highlight">Changing a table schema</a></li><li><a href="#identifying-active-and-inactive-rows" class="table-of-contents__link toc-highlight">Identifying active and inactive rows</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 - Kadena LLC (<a href="https://www.kadena.io/privacy-policy" target="_blank">Privacy</a>)</div></div></div></footer><div class="footer-consent-link"><button>Analytics Consent</button></div></div>
</body>
</html>