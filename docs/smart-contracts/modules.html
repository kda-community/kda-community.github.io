<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-smart-contracts/modules" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Modules and interfaces | Kadena Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kda-chain.org/docs/img/kadena-opengraph.png"><meta data-rh="true" name="twitter:image" content="https://kda-chain.org/docs/img/kadena-opengraph.png"><meta data-rh="true" property="og:url" content="https://kda-chain.org/docs/smart-contracts/modules"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Modules and interfaces | Kadena Docs"><meta data-rh="true" name="description" content="Modules define the business logic and essential functions for blockchain applications and provide the basic foundation for all Pact smart contracts."><meta data-rh="true" property="og:description" content="Modules define the business logic and essential functions for blockchain applications and provide the basic foundation for all Pact smart contracts."><link data-rh="true" rel="icon" href="/docs/img/kadena-favicon.png"><link data-rh="true" rel="canonical" href="https://kda-chain.org/docs/smart-contracts/modules"><link data-rh="true" rel="alternate" href="https://kda-chain.org/docs/smart-contracts/modules" hreflang="en"><link data-rh="true" rel="alternate" href="https://kda-chain.org/docs/smart-contracts/modules" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://6UVWQF4IS8-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Kadena Docs" href="/docs/opensearch.xml"><link rel="stylesheet" href="/docs/assets/css/styles.01d78354.css">
<script src="/docs/assets/js/runtime~main.2ef1040c.js" defer="defer"></script>
<script src="/docs/assets/js/main.9cf849d4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/kadena-docs-light.png" alt="Kadena Documentation" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="196"><img src="/docs/img/kadena-docs-dark.png" alt="Kadena Documentation" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="196"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/quickstart">Get Started</a><a href="https://discord.com/invite/kadena" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Support<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kda-community/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link github-link-icon"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quickstart">Quick start</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/smart-contract-dev">Smart contracts</a><button aria-label="Collapse sidebar category &#x27;Smart contracts&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/get-started-intro">Get started: Introduction to Pact</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/smart-contracts/install">Installation and setup</a><button aria-label="Expand sidebar category &#x27;Installation and setup&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/basic-concepts">Basic concepts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/accounts">Accounts, keys, and principals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/lang-features">Pact features and conventions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/functions-variables">Functions, variables, and types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/smart-contracts/modules">Modules and interfaces</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/capabilities">Capabilities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/guards">Guards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/databases">Database model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/transactions">Transaction format and flow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-contracts/best-practices">Pact best practices</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/guides">How-to guides</a><button aria-label="Expand sidebar category &#x27;How-to guides&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/api">API</a><button aria-label="Expand sidebar category &#x27;API&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference">Reference</a><button aria-label="Expand sidebar category &#x27;Reference&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/coding-projects/coding-projects">Coding projects</a><button aria-label="Expand sidebar category &#x27;Coding projects&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/resources">Resources</a><button aria-label="Expand sidebar category &#x27;Resources&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/smart-contract-dev"><span itemprop="name">Smart contracts</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Modules and interfaces</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Modules and interfaces</h1></header>
<p>The fundamental building blocks for all Pact smart contracts are defined in Pact <strong>modules</strong> and <strong>interfaces</strong>.
As Pact code, modules and interfaces have some similarities, but they are used differently have different usage rules.</p>
<p>A a high level:</p>
<ul>
<li>Module are typically self-contained logical units with all of the code necessary to create an application or a service—including schemas and tables—and can be upgraded after they are deployed.</li>
<li>Interfaces enable modules to interact by defining constant values and typed function signatures for common operations that can&#x27;t be changed except by defining a new interface.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="module-declaration">Module declaration<a href="#module-declaration" class="hash-link" aria-label="Direct link to Module declaration" title="Direct link to Module declaration">​</a></h2>
<p>All of the functions and data definitions required to complete business operations are defined within the context of a module.
For simple contracts, all of the business logic might be defined in a single module.
You can also use modules as composable units that interoperate if iit makes complex logic easier to navigate.
Whether you are building a contract as a single, self-contained Pact module or using multiple modules, <strong>module declarations</strong> typically include the following components:</p>
<ul>
<li>Capability definitions</li>
<li>Schema definitions</li>
<li>Table definitions</li>
<li>Function definitions</li>
<li>Multi-step defpact definitions</li>
<li>Constant value definitions</li>
</ul>
<p>There are also components that are required by smart contracts that aren&#x27;t part of the module declaration, but are defined outside of the module code.
For example, the code related to the following components is considered to be outside of and separate from the module declaration:</p>
<ul>
<li>Namespace definition</li>
<li>Keyset definitions</li>
<li>Table creation</li>
<li>Function calls</li>
</ul>
<p>In addition to the module declaration and the components that aren&#x27;t included in the module declaration, modules often require information passed in as message data, separate from the Pact code, but part of the transaction payload.
For example, a module might require keys or environment data that&#x27;s referenced in Pact code, but provided as part of the JSON object to be executed as a transaction.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="modules-and-smart-contracts">Modules and smart contracts<a href="#modules-and-smart-contracts" class="hash-link" aria-label="Direct link to Modules and smart contracts" title="Direct link to Modules and smart contracts">​</a></h2>
<p>When you start working with Pact, you typically create single modules that contain the full functionality of your smart contract, much like most of the examples in the <a href="/docs/coding-projects/coding-projects">coding projects</a>.
Using a single module to define a contract keeps your codebase simple and straightforward because there&#x27;s only one file to keep track of.
However, as you begin writing more complex or sophisticated programs, you might find it more convenient to split the smart contract logic into multiple modules that work together to compose the complete application.
In a typical smart contract—the full application—each individual module can provide a focused set of functionality with clear organizational logic.</p>
<p>Because a smart contract can be defined using one module or many modules and interfaces, the logic in individual Pact file—with the <code>.pact</code> file extension—is always referred to as a module or an interface.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="module-keyword-and-owner">Module keyword and owner<a href="#module-keyword-and-owner" class="hash-link" aria-label="Direct link to Module keyword and owner" title="Direct link to Module keyword and owner">​</a></h2>
<p>You can start a module declaration by typing the <a href="/docs/reference/syntax#module"><code>module</code></a> keyword, followed by the module name and the keyset or governance capability that owns the module.
The following example illustrates a module named <strong>example</strong> that is governed by the <strong>admin-keyset</strong> referenced in the first line of the module declaration:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">;; Define and read keysets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(module example &quot;admin-keyset&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;; module code goes here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;; function calls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The entire <strong>example</strong> module consists of the code within the opening and closing parentheses.
Top-level code, like <code>namespace</code> definitions and <code>keyset</code> definitions, are outside of these parentheses.
For example, you enter a namespace and define a keyset for a module before starting the module declaration like this:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">;; Enter a namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(namespace &quot;free&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;; Define and read a keyset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-keyset &quot;free.admin-keyset&quot; (read-keyset &quot;admin-keyset&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(module example &quot;admin-keyset&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;; module code goes here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;; function calls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="module-governance">Module governance<a href="#module-governance" class="hash-link" aria-label="Direct link to Module governance" title="Direct link to Module governance">​</a></h2>
<p>With keyset governance like the previous example, the <code>admin-keyset</code> is defined outside of the module and checked and enforced at the module level.
Any attempt to upgrade the module, write to module tables, or access table functions directly requires the <code>admin-keyset</code> to sign the transaction.</p>
<p>As an alternative to strict keyset enforcement, you can specify a <em>governance capability</em> in the module declaration to support a more generalized form of module governance.
By using a governance capability that references a <code>defcap</code> declaration in the module body, you can define more flexible models for enforcing access to Pact modules, tables, and functions.</p>
<p>For example, you can implement the same governance for the <strong>example</strong> module using a governance capability named <strong>GOVERNANCE</strong> like this:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(module example GOVERNANCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defcap GOVERNANCE ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (enforce-guard &quot;admin-keyset&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that the capability name has no significance, except to indicate the purpose of the capability.
Its placement at the beginning of the module declaration is what identifies this capability as a module governance capability.</p>
<p>It&#x27;s worth noting that, when you initially deploy a module, the module governance capability is not invoked.
This behavior is different than when you use a keyset.
With a keyset, the keyset must always be defined and evaluated to ensure that the keyset exists before a module can be deployed.
The module governance capability is enforces after a module is deployed, when it&#x27;s accessed or upgraded.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="invoking-governance">Invoking governance<a href="#invoking-governance" class="hash-link" aria-label="Direct link to Invoking governance" title="Direct link to Invoking governance">​</a></h3>
<p>Because the module governance capability is defined using the <code>defcap</code> keyword, its elevated administrative function cannot be called directly.
The <strong>module administrator</strong> elevated permissions are only automatically invoked in the following situations:</p>
<ul>
<li>When a module upgrade is attempted.</li>
<li>When module tables are directly accessed from outside of the module code.</li>
</ul>
<p>Transactions that attempt to upgrade a module or access module tables can only be executed by the module owner specified by the <strong>module administrator capability</strong>—in this example, the <code>GOVERNANCE</code> capability.
If the conditions specified for the <code>GOVERNANCE</code> capability are met, full administrative rights are granted.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="module-administrator-scope">Module administrator scope<a href="#module-administrator-scope" class="hash-link" aria-label="Direct link to Module administrator scope" title="Direct link to Module administrator scope">​</a></h3>
<p>The module administrator capability, once automatically invoked, stays in scope for the rest of the calling transaction.
This is unlike other capabilities that can only be acquired in a fixed scope specified by the body of a <code>with-capability</code> function call.
The reason for this difference in behavior is to ensure that a governance capability doesn&#x27;t rely on transient information that can change during a single transaction.
This is important, for example, in the case of module upgrades.
A module upgrade might change the governance capability itself.
If the module administrator capability didn&#x27;t remain in scope through the completion of the transaction, the upgrade might fail because the administrative capability is required to migrate table data as part of the upgrade process.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="stakeholder-upgrade-vote">Stakeholder upgrade vote<a href="#stakeholder-upgrade-vote" class="hash-link" aria-label="Direct link to Stakeholder upgrade vote" title="Direct link to Stakeholder upgrade vote">​</a></h3>
<p>The following example demonstrates how to upgrade a module based on a stakeholder vote.
The upgrade is designed as a Pact transaction, and its hash and code are distributed to stakeholders, who vote for or against the upgrade.
After the upgrade transaction is distributed, the vote is tallied in the governance capability, and if a simple majority is found, the code is upgraded.</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(module govtest count-votes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Demonstrate programmable governance showing votes \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> \ for upgrade transaction hashes&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defschema vote</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vote-hash:string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (deftable votes:{vote})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defun vote-for-hash (user hsh)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Register a vote for a particular transaction hash&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (write votes user { &quot;vote-hash&quot;: hsh })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defcap count-votes ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Governance capability to tally votes for the upgrade hash&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (let* ((h (tx-hash))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           (tally (fold (do-count h)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        { &quot;for&quot;: 0, &quot;against&quot;: 0 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        (keys votes)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (enforce (&gt; (at &#x27;for tally) (at &#x27;against tally))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               (format &quot;vote result: {}, {}&quot; [h tally])))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defun do-count (hsh tally u)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Add to TALLY if U has voted for HSH&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (bind tally { &quot;for&quot; := f, &quot;against&quot; := a }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (with-read votes u { &#x27;vote-hash := v }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (if (= v hsh)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            { &quot;for&quot;: (+ 1 f), &quot;against&quot;: a }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          { &quot;for&quot;: f, &quot;against&quot;: (+ 1 a) })))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="module-properties-and-components">Module properties and components<a href="#module-properties-and-components" class="hash-link" aria-label="Direct link to Module properties and components" title="Direct link to Module properties and components">​</a></h2>
<p>As you&#x27;ve seen, module declarations start with the <code>module</code> keyword and a name.
Module names must be unique within a namespace.
You can define custom namespaces for local development.
However, you must deploy modules to a registered namespace in the Kadena test or production networks.</p>
<p><a href="/docs/reference/syntax#module">Module declarations</a> use the following keywords to define module components:</p>
<ul>
<li><a href="/docs/reference/syntax#defun">defun</a> to define module functions.</li>
<li><a href="/docs/reference/syntax#defschema">defschema</a> to define schemas for module tables.</li>
<li><a href="/docs/reference/syntax#deftable">deftable</a> to define the tables to create for a module.</li>
<li><a href="/docs/reference/syntax#defpact">defpact</a> to define multi-step transactions in the module.</li>
<li><a href="/docs/reference/syntax#defconst">defconst</a> to define constant value variables in the module.</li>
<li><a href="/docs/reference/syntax#defcap">defcap</a> to define capabilities in the module.</li>
<li><a href="/docs/reference/syntax#use">use</a> to import functions from other modules into the module.</li>
<li><a href="/docs/reference/syntax#implements">implements</a> to implement functions from interfaces exposed in other modules into the module.</li>
</ul>
<p>Modules can also include different types of metadata, such as documentation strings or information for emitted events.</p>
<p>When a module is declared, all references to native functions, interfaces, or definitions from other modules are resolved.
Resolution failure results in transaction rollback.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="module-versioning-and-dependencies">Module versioning and dependencies<a href="#module-versioning-and-dependencies" class="hash-link" aria-label="Direct link to Module versioning and dependencies" title="Direct link to Module versioning and dependencies">​</a></h3>
<p>Module versioning is not supported, except by including a version identifier in the module name, for example, <code>accounts-v1</code> or <code>marmalade-v2</code>.
However, you can use <em>module hashes</em> to import a specific version of a module with the <a href="/docs/reference/syntax#use"><code>use</code></a> keyword.
By specifying a module hash when you import the module, you can link your code to a particular release of a module that&#x27;s identified by the hash.</p>
<p>By combining module imports with module hashes, you can ensure that updated module code will fail to import if a dependent module has subsequently changed on the chain.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="module-table-creation">Module table creation<a href="#module-table-creation" class="hash-link" aria-label="Direct link to Module table creation" title="Direct link to Module table creation">​</a></h3>
<p>Tables are created at the same time as modules and include the module name as a prefix to the table name.
With this naming convention, the module acts as a guard to protect access to tables using <a href="/docs/pact-5/database">database functions</a> that are controlled by the module owner.
You can create any number of tables in a module.</p>
<p>It’s important to note that you define table schemas, the tables that use the schemas, and the functions that insert, read, and modify database records inside of module code, but you create tables outside of module code.
That is, tables are <em>defined</em> in modules, but they are <em>created</em> after the module declaration.
This separation allows module code to be potentially updated without recreating the table.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="interfaces">Interfaces<a href="#interfaces" class="hash-link" aria-label="Direct link to Interfaces" title="Direct link to Interfaces">​</a></h2>
<p>In Pact, interfaces represent an abstract API that modules can implement to make use of the constants and typed function signatures that an interface defines.</p>
<p>To make use of the components defined in an interface, module declarations can include one or more <a href="/docs/reference/syntax#implements"><code>implements</code></a> statements to specify the interface from which the module wants to implement features.
A single module can implement multiple interfaces.
However, if you implement interfaces with conflicting function names, you must resolve the conflict in your code or by redefining the interfaces to remove the conflict.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="interface-properties-and-components">Interface properties and components<a href="#interface-properties-and-components" class="hash-link" aria-label="Direct link to Interface properties and components" title="Direct link to Interface properties and components">​</a></h3>
<p>You can declare an interface using the <code>interface</code> keyword followed by the name for the interface.
Interface names must be unique within a namespace.
Interfaces can&#x27;t be upgraded and aren&#x27;t governed by keysets or a governance capability.</p>
<p>Interfaces can import definitions from other modules with <a href="/docs/reference/syntax#use"><code>use</code></a> statements to construct new constant definitions, or make use of types or functions defined in the imported module.</p>
<p>Modules can implement interfaces that include the following components:</p>
<ul>
<li><a href="/docs/reference/syntax#defun">function</a> signatures</li>
<li><a href="/docs/reference/syntax#defconst">constant</a> values</li>
<li><a href="/docs/reference/syntax#defschema">schema</a> definitions</li>
<li><a href="/docs/reference/syntax#defpact">defpact</a> specifications</li>
<li><a href="/docs/reference/syntax#defcap">capability</a> specifications</li>
<li><a href="/docs/reference/syntax#use">imported definitions</a> from other modules</li>
</ul>
<p>The following example illustrates how to declare and implement an interface with one function signature and one constant value:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(interface my-interface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (defun hello-number:string (number:integer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @doc &quot;Return the string \&quot;Hello, $number!\&quot; when given a string&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (defconst SOME_CONSTANT 3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(module my-module (read-keyset &#x27;my-keyset)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (implements my-interface)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (defun hello-number:string (number:integer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (format &quot;Hello, {}!&quot; [number]))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (defun square-three ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (* my-interface.SOME_CONSTANT my-interface.SOME_CONSTANT))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you can see in this example, the <code>my-module</code> module implements the <code>hello-number</code> function signature.
The constant declared in the interface is accessed directly by its fully qualified name <code>namespace.interface.const</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implements-and-use-keywords">Implements and use keywords<a href="#implements-and-use-keywords" class="hash-link" aria-label="Direct link to Implements and use keywords" title="Direct link to Implements and use keywords">​</a></h2>
<p>You can create complex and layered relationships between interfaces and modules.
One important way you can create this layered relationships is by using combinations of the <code>implements</code> and <code>use</code> keywords.
The <code>use</code> keyword enables you to import elements from the specified <code>module</code> into a namespace, interface, or module.
For example, you can specify the <code>use</code> keyword in an interface declaration to import table schemas and types from a specified module.</p>
<p>You can also include <code>use</code> statements at the top-level of a contract or within a module declaration to make all or parts of a specified module available in the current module context.
For example, you can specify a list of functions, constants, and schema names to import from the specified <code>module</code>.
If you explicitly define the function, constant, and schema names to import, only those items are available in the module body.</p>
<p>You can also specify a <code>hash</code> argument in <code>use</code> statements to check that an imported module&#x27;s hash matches the <code>hash</code> you expect, and fail if the hashes are not the same.
By including the <code>hash</code> argument in a <code>use</code> statement, you can perform a simplified form of version control or dependency checking.</p>
<p>The following example is an excerpt from the <code>marmalade-v2.ledger</code> module that illustrates the relationships created by combining <code>implements</code> and <code>use</code> statements.
In this example, <code>marmalade-v2</code> is the primary namespace where the <code>ledger</code> contract is deployed.</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(namespace (read-string &#x27;ns))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(module ledger GOVERNANCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (implements marmalade-v2.ledger-v2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (implements kip.poly-fungible-v3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (use kip.poly-fungible-v3 [account-details sender-balance-change receiver-balance-change])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (use kip.token-policy-v2 [token-info])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (use util.fungible-util)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (use marmalade-v2.policy-manager)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This module implements the <code>ledger-v2</code> interface that defines a set of capabilities.</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(interface ledger-v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defcap INIT-CALL:bool (id:string precision:integer uri:string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Capability securing the modref call for enforce-init &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The module also implements the <code>poly-fungible-v3</code> interface and imports the specified functions.</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(interface poly-fungible-v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defschema account-details</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot; Account details: token ID, account name, balance, and guard.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id:string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    account:string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    balance:decimal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    guard:guard)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defschema sender-balance-change</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc &quot;For use in RECONCILE events&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    account:string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    previous:decimal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    current:decimal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defschema receiver-balance-change</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc &quot;For use in RECONCILE events&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    account:string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    previous:decimal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    current:decimal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For more information about the syntax for using these keywords, see the <a href="/docs/reference/syntax#implements">implements</a> and <a href="/docs/reference/syntax#use">use</a> syntax descriptions.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="module-references">Module references<a href="#module-references" class="hash-link" aria-label="Direct link to Module references" title="Direct link to Module references">​</a></h2>
<p>Pact <strong>module references</strong> enable you to support use-cases that require polymorphism.
For example, a Uniswap-like exchange allows users to specify pairs of tokens to allow trading between them.
The Pact <code>fungible-v2</code> interface allows tokens to offer identical operations such as <code>transfer-create</code>.
However, without a way to abstract over different <code>fungible-v2</code> implementations, an exchange smart contract would have to be upgraded for each token pair with custom code for every operation.</p>
<p>For example:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">;;; simplified DEX example with hardcoded dispatching on token symbols</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(defun swap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ( a-token:string a-amount:decimal a-account:string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b-token:string b-amount:decimal b-account:string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (with-read pair-accounts (format &quot;{}:{}&quot; [a-token b-token])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    { &#x27;pair-a-account := pair-a-account</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    , &#x27;pair-b-account := pair-b-account</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (cond</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ((= &quot;KDA&quot; a-token)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       (coin.transfer a-account pair-a-account a-amount))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ((= &quot;KBTC&quot; a-token)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       (kbtc.ledger.transfer a-account pair-a-account a-amount))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ((= &quot;KUSD&quot; a-token)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       (kusd.ledger.transfer a-account pair-a-account a-amount))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Unrecognized a-token value&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (cond</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ((= &quot;KDA&quot; b-token)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       (coin.transfer b-pair-account b-account b-amount))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ((= &quot;KBTC&quot; b-token)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       (kbtc.ledger.transfer b-pair-account b-account b-amount))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ((= &quot;KUSD&quot; b-token)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       (kusd.ledger.transfer b-pair-account b-account b-amount))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Unrecognized b-token value&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>With module references, an exchange-type smart contract can accept pairs of values where each value references a concrete module that implements the <code>fungible-v2</code> interface, giving it the ability to call <code>fungible-v2</code> operations using those values.</p>
<p>For example:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">;;; simplified DEX example with module references in a dynamic dispatch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(defun swap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ( a-token:module{fungible-v2} a-amount:decimal a-account:string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b-token:module{fungible-v2} b-amount:decimal b-account:string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (with-read pair-accounts (format &quot;{}:{}&quot; [a-token b-token])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    { &#x27;pair-a-account := pair-a-account</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    , &#x27;pair-b-account := pair-b-account</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (a-token::transfer a-account pair-a-account a-amount)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (b-token::transfer pair-b-account b-account b-amount))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To invoke the <code>swap</code> function, the module names are directly referenced in code.</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(swap coin a-amount a-account</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      kbtc.ledger b-amount b-account)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Module reference values are normal Pact values that can be stored in the database, referenced in events, and returned from functions.</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">;;; simplified DEX example with stored pair module reference values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(defun swap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ( pair-symbol:string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a-amount:decimal a-account:string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b-amount:decimal b-account:string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (with-read pair-accounts pair-symbol</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    { &#x27;pair-a-account := pair-a-account:string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    , &#x27;a-token := a-token:module{fungible-v2}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    , &#x27;pair-b-account := pair-b-account:string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    , &#x27;b-token := b-token:module{fungible-v2}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (a-token::transfer a-account pair-a-account a-amount)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (b-token::transfer pair-b-account b-account b-amount))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="polymorphism">Polymorphism<a href="#polymorphism" class="hash-link" aria-label="Direct link to Polymorphism" title="Direct link to Polymorphism">​</a></h3>
<p>Module reference values provide polymorphism for use cases like the previous example with an emphasis on interoperability.
A module reference is specified with one or more interfaces, allowing for values to reference modules that implement those interfaces.</p>
<p>In the previous example, the module reference <code>a-token:module{fungible-v2}</code> accepts a reference to the Kadena <code>coin</code> KDA token module, because <code>coin</code> implements <code>fungible-v2</code>.
There&#x27;s nothing special about the <code>fungible-v2</code> interface.
Module references can specify any defined interface and accept any module that implements the specified interface.</p>
<p>The Pact module reference polymorphism is similar to generics in Java or traits in Rust, and should not be confused with more object-oriented polymorphism like that found with Java classes or TypeScript types.
Modules cannot extend one another.
They can only offer operations that match some interface specification, and interfaces themselves cannot extend other interface.</p>
<p>You should note that module references introduce indirection and, therefore, can increase the overall complexity of Pact smart contracts, making contract logic harder to understand and reason about.
You should only use module references when you need to provide flexible interoperation between smart contracts.
If all of the modules are your own code, you should use direct references instead of external module references whenever possible.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="reference-value-binding">Reference value binding<a href="#reference-value-binding" class="hash-link" aria-label="Direct link to Reference value binding" title="Direct link to Reference value binding">​</a></h3>
<p>Module references use the latest upgraded version of the referenced module when you invoke a module operation.
For example, consider a module reference to a <code>payments</code> module stored in the database when the <code>payments</code> module is at version 1.
Sometime later, the <code>payments</code> module is upgraded to version 2.
The module reference in the database will refer to the upgraded version 2 of the <code>payments</code> module when the reference is called.
This behavior is different from Pact direct references, which are not late-binding, so you should consider this difference in module reference behavior to prevent returning unexpected results.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="referencing-untrusted-code">Referencing untrusted code<a href="#referencing-untrusted-code" class="hash-link" aria-label="Direct link to Referencing untrusted code" title="Direct link to Referencing untrusted code">​</a></h3>
<p>Because module references allow external modules to interoperate with your code, you should not assume that the external code is safe.
Instead, you should treat any module reference call as a call to untrusted code.
In particular, you should be aware that invoking module references in the context of acquiring a capability can result in unintended privilege escalation.</p>
<p>For example, the following <code>data-market</code> module has a public <code>collect-data</code> function that is intended to allow external modules to provide some data, resulting in the one-time payment of a fee.
The external modules implement a <code>data-collector</code> interface with a <code>collect</code> function to get the data and a <code>get-fee-recipient</code> function to identify the receiving account.
In this example, the <code>data-market</code> module code acquires the <code>COLLECT</code> capability, and uses this capability to prevent <code>collect</code> and a <code>get-fee-recipient</code> functions from being called directly.</p>
<p>However, with the wrong code, this seemingly benign code can be exploited by a malicious module reference implementation:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(module data-market GOVERNANCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defun collect-data (collector:module{data-collector})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Provide data, get paid!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;; BAD: capability acquired before modref calls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (with-capability (COLLECT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ;; BAD: modref invoked with capability in scope!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (store-data (collector::collect))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (pay-fee (collector::get-fee-recipient)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defun pay-fee (account:string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Private function to pay one-time fee for collection&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (require-capability (COLLECT))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (coin.transfer FEE_BANK account FEE))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defun store-data (data:object{data-schema})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Private function to update database with data collection results&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (require-capability (COLLECT))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The problem with the module code is that the <code>with-capability</code> call happens <em>before</em> the calls to the module reference operations, such that while the external module code is executing, the <code>COLLECT</code> capability is in scope.
While the <code>COLLECT</code> capability is in scope, the <code>pay-fee</code> and <code>store-data</code> functions can be called from anywhere.
Malicious code could exploit this code with a module reference that calls the <code>data-market.pay-fee</code> function repeatedly in the seemingly innocent calls to the <code>collect</code> or <code>get-fee-recipient</code> functions.
Malicious code could also call the <code>data-market.store-data</code> function and wreak havoc that way.
The important point in this example is that once a capability is in scope, the protections provided by the <code>require-capability</code> function aren&#x27;t available.</p>
<p>Fortunately, you can avoid this situation by keeping module reference calls outside of the scope of the sensitive capability.
For example:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(defun collect-data (collector:module{data-collector})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Provide data, get paid!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ;; GOOD: modref invoked before with-capability call</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (let ((data (collector::collect))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (account (collector::get-fee-recipient)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (with-capability (COLLECT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (store-data data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (pay-fee account))))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, the module reference calls have safely returned before the <code>COLLECT</code> capability is acquired.
A malicious implementation has no way to invoke the sensitive code.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="coding-with-module-references">Coding with module references<a href="#coding-with-module-references" class="hash-link" aria-label="Direct link to Coding with module references" title="Direct link to Coding with module references">​</a></h3>
<p>You can reference modules and interfaces directly by issuing their name in code.
For example:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(module foo &#x27;k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defun bar () 0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(namespace ns)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(interface bar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defun quux:string ()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(module zzz &#x27;k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (implements bar)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defun quux:string () &quot;zzz&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo ;; module reference to &#x27;foo&#x27;, of type &#x27;module&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ns.bar ;; module reference to `bar` interface, also of type &#x27;module&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ns.zzz ;; module reference to `zzz` module, of type &#x27;module{ns.bar}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Using a module reference in a function is accomplished by specifying the type of the module reference argument, and using the <a href="/docs/reference/syntax#dereference-operator">dereference operator</a> <code>::</code> to invoke a member function of the interface specified in the type.</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(interface baz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defun quux:bool (a:integer b:string))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defconst ONE 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(module impl &#x27;k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (implements baz)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defun quux:bool (a:integer b:string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (&gt; (length b) a))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(defun foo (bar:module{baz})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (bar::quux 1 &quot;hi&quot;)   ;; dereferences &#x27;quux&#x27; on whatever module is passed in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bar::ONE             ;; directly references interface const</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(foo impl) ;; &#x27;impl&#x27; references the module defined above, of type &#x27;module{baz}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You should use module reference calls in use cases that require dynamic evaluation of a function or interface or when an interface requires multiple implementations.
For example, decentralized exchanges and liquidity pools typically require module references.
You should avoid using use module reference calls where you have a capability that you are using to guard resources could be brought into scope in an external module.</p>
<p>For example, if you are using the INTERNAL_FUNDS_CAP to guard account funds in the <code>mymodule</code> module, you shouldn&#x27;t bring that capability into scope before calling the external module:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(module mymodule GOVERNANCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defcap INTERNAL_FUNDS_CAP true) ; my capability for funds owned by this module</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defconst MODULE_ACCOUNT_GUARD (create-capability-guard (INTERNAL_FUNDS_CAP))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defconst MODULE_ACCOUNT (create-principal MODULE_ACCOUNT_GUARD))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defun withdraw (person:string amount:decimal mref:module{fungible-v2}) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (with-capability (INTERNAL_FUNDS_CAP)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (mref::transfer person MODULE_ACCOUNT amount)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (coin.transfer MODULE_ACCOUNT person amount))))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, the INTERNAL_FUNDS_CAP capability—which should only be brought into scope for the <code>coin.transfer</code> call—is in scope for both the external <code>mref::transfer</code> call and the <code>coin.transfer</code> call.
With this vulnerability, a malicious user could write a module that satisfies the <code>fungible-v2</code> interface that drains all of the funds from <code>mymodule</code> because the INTERNAL_FUNDS_CAP is in scope.</p>
<p>To fix the issue, you need to change where the call that grants the INTERNAL_FUNDS_CAP capability is brought into scope:</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(defun withdraw (person:string amount:decimal mref:module{fungible-v2}) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (mref::transfer person MODULE_ACCOUNT amount)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (with-capability (INTERNAL_FUNDS_CAP)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       (coin.transfer MODULE_ACCOUNT person amount))))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="securing-module-reference-calls">Securing module reference calls<a href="#securing-module-reference-calls" class="hash-link" aria-label="Direct link to Securing module reference calls" title="Direct link to Securing module reference calls">​</a></h2>
<p>Pact has always relied on restricting loops and preventing recursion to provide security guarantees.
These security measure ensure that your program can never enter into an infinite loop and functions can&#x27;t call into themselves.
However, module references introduced a potential vulnerability that Turing incompleteness alone didn&#x27;t address.
In particular, virtual calls to module code that were not controlled by the module caller have been difficult for module authors to make secure.
While functions are not allowed to recurse, module references don&#x27;t prevent virtual calls from reentering the calling module.
If the virtual call then calls a separate credit or debit function, that call isn&#x27;t considered recursion down the call stack.
For applications that rely on module references to provide the function interfaces they use, this behavior— combined with the importance of controlling capability scope—has made it difficult for contract authors to write secure contract code.</p>
<p>As a security enhancement, Pact 5.3 introduces module reference calls that are ready-only by default.
With Pact 5.3, any module reference function call that reenters the originating module is treated as a read-only call to prevent database modification and code reentry attacks.
For example, assume you have a <code>my-token</code> module with the module reference <code>fungible::transfer-create</code>.
If the <code>fungible</code> module tries to call back into the <code>my-token</code> module to execute a <code>withdraw-funds</code> or <code>deposit-funds</code> function, the operation isn&#x27;t allowed because all calls from the <code>fungible</code> module reference  are read-only by default.</p>
<div class="language-pact codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pact codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(module my-token GOVERNANCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defconst MODULE_GUARD (create-capability-guard (SOME-SECURE-CAP)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defconst MODULE_OWNED_ACCOUNT:string (create-principal ...))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(defun withdraw-funds (account:string destination:module{fungible-v2})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (require-capability (SOME-SECURE-CAP))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   # Code withdraws funds and transfers them to a particular account</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (defun deposit-funds (account:string amount:decimal fung:module{fungible-v2})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (with-capability (SOME-SECURE-CAP)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (fungible::transfer-create account MODULE_OWNED_ACCOUNT MODULE_GUARD amount)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If the <code>fungible::transfer-create</code> function were written to call back into <code>my-token</code>, calls back into <code>my-token</code> from the <code>fungible</code> module reference would be allowed to <strong>retrieve</strong> information, such as account details, but not <strong>modify</strong> balances or any database entries that are part of the <code>my-token</code> module.</p>
<p>For projects like decentralized exchanges (DEX) and bridges that require virtual calls, this enhancement enables Pact to provide module-level security guarantees against reentry attacks.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/kda-community/kadena-docs-new/blob/master/docs/smart-contracts/modules.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/smart-contracts/functions-variables"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Functions, variables, and types</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/smart-contracts/capabilities"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Capabilities</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#module-declaration" class="table-of-contents__link toc-highlight">Module declaration</a></li><li><a href="#modules-and-smart-contracts" class="table-of-contents__link toc-highlight">Modules and smart contracts</a></li><li><a href="#module-keyword-and-owner" class="table-of-contents__link toc-highlight">Module keyword and owner</a></li><li><a href="#module-governance" class="table-of-contents__link toc-highlight">Module governance</a></li><li><a href="#module-properties-and-components" class="table-of-contents__link toc-highlight">Module properties and components</a></li><li><a href="#interfaces" class="table-of-contents__link toc-highlight">Interfaces</a></li><li><a href="#implements-and-use-keywords" class="table-of-contents__link toc-highlight">Implements and use keywords</a></li><li><a href="#module-references" class="table-of-contents__link toc-highlight">Module references</a></li><li><a href="#securing-module-reference-calls" class="table-of-contents__link toc-highlight">Securing module reference calls</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 - Kadena LLC (<a href="https://www.kadena.io/privacy-policy" target="_blank">Privacy</a>)</div></div></div></footer><div class="footer-consent-link"><button>Analytics Consent</button></div></div>
</body>
</html>