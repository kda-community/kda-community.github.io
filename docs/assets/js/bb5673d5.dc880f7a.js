"use strict";(self.webpackChunkkadena_docs=self.webpackChunkkadena_docs||[]).push([[8333],{31710:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"smart-contracts/transactions","title":"Transaction format and flow","description":"There are two types of transaction in Pact smart contracts: transactions that execute in a single step and transactions that consist of more than one step.","source":"@site/docs/smart-contracts/transactions.md","sourceDirName":"smart-contracts","slug":"/smart-contracts/transactions","permalink":"/docs/smart-contracts/transactions","draft":false,"unlisted":false,"editUrl":"https://github.com/kda-community/kadena-docs-new/blob/master/docs/smart-contracts/transactions.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"title":"Transaction format and flow","id":"transactions","sidebar_position":10,"description":"There are two types of transaction in Pact smart contracts: transactions that execute in a single step and transactions that consist of more than one step."},"sidebar":"default","previous":{"title":"Database model","permalink":"/docs/smart-contracts/databases"},"next":{"title":"Pact best practices","permalink":"/docs/smart-contracts/best-practices"}}');var i=n(74848),s=n(28453);const o={title:"Transaction format and flow",id:"transactions",sidebar_position:10,description:"There are two types of transaction in Pact smart contracts: transactions that execute in a single step and transactions that consist of more than one step."},r="Transaction format and lifecycle",c={},l=[{value:"Transaction formats",id:"transaction-formats",level:2},{value:"Execution request format",id:"execution-request-format",level:3},{value:"Continuation request format",id:"continuation-request-format",level:3},{value:"Basic transaction flow",id:"basic-transaction-flow",level:2},{value:"Multi-step transaction flow",id:"multi-step-transaction-flow",level:2},{value:"Two-step transactions without rollback",id:"two-step-transactions-without-rollback",level:3},{value:"Two-step transactions with rollback",id:"two-step-transactions-with-rollback",level:3}];function d(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"transaction-format-and-lifecycle",children:"Transaction format and lifecycle"})}),"\n",(0,i.jsx)(t.p,{children:"There are two types of transaction in Pact smart contracts:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Transactions that execute in a single step, identified in Pact code as ",(0,i.jsx)(t.code,{children:"exec"})," transactions."]}),"\n",(0,i.jsxs)(t.li,{children:["Transactions that continue a sequence with more than one step, identified in Pact code as ",(0,i.jsx)(t.code,{children:"cont"})," transactions."]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Most transactions execute as a single step with a single message that is sent to a blockchain node to be evaluated by Pact.\nThe execution of the code in the message is ",(0,i.jsx)(t.em,{children:"atomic"})," and the transaction succeeds as a complete unit, or doesn't succeed at all.\nFor these types of transactions, Pact doesn't allow partial execution or provide any concept for rollback handling."]}),"\n",(0,i.jsx)(t.p,{children:"For transactions that consist of more than one step, each step is effectively a single transaction.\nHowever, each step must be executed in sequence and if any step in the sequence fails, the entire transaction can be rolled back to its initial state or allowed to continue without rollback handling.\nFor example, a cross-chain transfer is essentially a two-step transaction, with a debit transaction initiated on a source chain and a separate credit transaction occurring on a destination chain.\nWithout rollback handling, if the second step isn't called to complete the transaction, the first step becomes an orphan and the intended transfer operation remains in an incomplete, interrupted state.\nHowever, multi-step transactions can include a rollback step so that if a specific condition exists, a previously completed steps can be reversed.\nFor example, if an asset is moved from a seller's account to an escrow account awaiting a buyer to complete the transaction, the transfer can be reversed if the buyer doesn't complete necessary steps within a previously agreed upon time."}),"\n",(0,i.jsxs)(t.p,{children:["Single-step transactions are defined in smart contracts as function calls using the ",(0,i.jsx)(t.code,{children:"defun"})," reserved keyword, as previously introduced in ",(0,i.jsx)(t.a,{href:"/smart-contracts/functions-variables#define-a-function",children:"Define a function"}),".\nTransactions with multiple steps are defined in smart contracts using the ",(0,i.jsx)(t.a,{href:"/reference/syntax#defpact",children:(0,i.jsx)(t.code,{children:"defpact"})}),", ",(0,i.jsx)(t.a,{href:"/reference/syntax#step",children:(0,i.jsx)(t.code,{children:"step"})}),", and ",(0,i.jsx)(t.a,{href:"/reference/syntax#step-with-rollback",children:(0,i.jsx)(t.code,{children:"step-with-rollback"})})," reserved keywords."]}),"\n",(0,i.jsx)(t.h2,{id:"transaction-formats",children:"Transaction formats"}),"\n",(0,i.jsxs)(t.p,{children:["Given that there are two types of transactions, there are also two transaction formats.\nThe format for transaction execution requests\u2014that is, the ",(0,i.jsx)(t.code,{children:"exec"})," transaction type\u2014is the same for single-step transactions and the first step (0) in multi-step ",(0,i.jsx)(t.code,{children:"defpact"})," transactions.\nThese transactions always contain the Pact code to execute, either as raw embedded code or as a reference to a ",(0,i.jsx)(t.code,{children:".pact"})," file.\nBy contrast, continuation requests\u2014",(0,i.jsx)(t.code,{children:"cont"})," requests\u2014don't contain Pact code.\nFor a ",(0,i.jsx)(t.code,{children:"defpact"})," transaction, the first step, step 0, initiates the transaction using the ",(0,i.jsx)(t.code,{children:"exec"})," transaction format.\nSubsequent ",(0,i.jsx)(t.code,{children:"step"})," or ",(0,i.jsx)(t.code,{children:"step-with-rollback"})," code blocks use the continuation\u2014the ",(0,i.jsx)(t.code,{children:"cont"})," transaction type\u2014format.\nInstead of containing Pact code, continuation requests reference the ",(0,i.jsx)(t.code,{children:"defpact"})," identifier that links the steps together and the continuation step they are attempting to execute."]}),"\n",(0,i.jsxs)(t.p,{children:["The difference between execution transaction requests and continuation transaction requests is reflected in the different fields required to construct the transactions.\nFor example, if you're constructing a transaction request using the YAML API format, you use the ",(0,i.jsx)(t.a,{href:"//model-payload",children:"exec"})," payload format for ",(0,i.jsx)(t.code,{children:"defun"})," and ",(0,i.jsx)(t.code,{children:"defpact"})," execution requests and the ",(0,i.jsx)(t.a,{href:"https://api.chainweb.com/openapi/pact.html#tag/model-payload",children:"cont"})," payload format for the continuation requests for ",(0,i.jsx)(t.code,{children:"defpact"})," steps after the first step."]}),"\n",(0,i.jsx)(t.h3,{id:"execution-request-format",children:"Execution request format"}),"\n",(0,i.jsx)(t.p,{children:"The following template describes the YAML format for signed execution transaction requests:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:"code: Pact code to execute for the transaction\ncodeFile: Pact file that contains the transaction code to execute\ndata: JSON data to include in the transaction\ndataFile: JSON data file for the transaction\nkeyPairs: [ List of public and secret key pairs for signing\n  - public: Base 16 public key\n    secret: Base 16 secret key\n    caps: [ List of capabilities and arguments (optional)\n      - name:\n        args:\n  ]\n]\nnonce: Request nonce or current time if not provided (optional)\nnetworkId: String identifier for the blockchain network\npublicMeta:\n  chainId: String chain id of the chain of execution\n  sender: String denoting the sender of the transaction\n  gasLimit: Integer gas limit\n  gasPrice: Decimal gas price\n  ttl: Integer time-to-live value\n  creationTime: Integer transaction execution time after offset (optional)\ntype: exec\n"})}),"\n",(0,i.jsxs)(t.p,{children:["You can generate public and private key pairs that use the Ed25519 signature scheme by running ",(0,i.jsx)(t.code,{children:"pact --genkey"}),".\nBoth keys are required to submit signed transaction execution requests."]}),"\n",(0,i.jsxs)(t.p,{children:["If you only want to include the public key in a transaction execution request, you can use the unsigned YAML request format.\nThe YAML format for unsigned requests is similar to the format for signed requests.\nHowever, in an unsigned request, a ",(0,i.jsx)(t.code,{children:"signers"})," attribute replaces the ",(0,i.jsx)(t.code,{children:"keyPairs"})," attribute:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:"code: Pact code to execute for the transaction\ncodeFile: Pact file that contains the transaction code to execute\ndata: JSON data to include in the transaction\ndataFile: JSON data file for the transaction\nsigners: [ List of public keys for required signers\n  - public: Base 16 public key\n    caps: [ List of capabilities and arguments (optional)\n      - name:\n        args:\n  ]\n]\nnonce: Request nonce or current time if not provided (optional)\nnetworkId: String identifier for the blockchain network\npublicMeta:\n  chainId: String chain id of the chain of execution\n  sender: String denoting the sender of the transaction\n  gasLimit: Integer gas limit\n  gasPrice: Decimal gas price\n  ttl: Integer time-to-live value\n  creationTime: Integer transaction execution time after offset (optional)\ntype: exec\n"})}),"\n",(0,i.jsx)(t.h3,{id:"continuation-request-format",children:"Continuation request format"}),"\n",(0,i.jsx)(t.p,{children:"The following template describes the YAML format for continuation transaction requests:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:"pactTxHash: integer transaction identifier for a defpact\nstep: integer next step of a defpact\nrollback: boolean for rolling back a defpact step\nproof: string spv proof of continuation (optional, cross-chain only)\ndata: JSON transaction data\ndataFile: JSON transaction data file\nkeyPairs: list of key pairs for signing (use pact -g to generate): [\n  public: string base 16 public key\n  secret: string base 16 secret key\n  caps: [\n      optional capabilities\n  ]\n]\nnetworkId: string identifier for a blockchain network\npublicMeta:\n  chainId: string chain id of the chain of execution\n  sender: string denoting the sender of the transaction\n  gasLimit: integer gas limit\n  gasPrice: decimal gas price\n  ttl: integer time-to-live value\n  creationTime: optional integer tx execution time after offset\nnonce: optional request nonce, will use current time if not provided\ntype: cont\n"})}),"\n",(0,i.jsx)(t.h2,{id:"basic-transaction-flow",children:"Basic transaction flow"}),"\n",(0,i.jsxs)(t.p,{children:["After you have a transaction message properly formatted as a JSON object, it can be executed locally for testing purposes or sent to the blockchain for execution on-chain.\nYou submit transactions to the blockchain for on-chain execution by connecting to a node using the Pact ",(0,i.jsx)(t.code,{children:"/send"})," endpoint.\nIn most cases, the node you connect to is a node that you control\u2014in the local development environment, the public test network, or the production main network."]}),"\n",(0,i.jsxs)(t.p,{children:["Before moving the transaction into a pending state, Pact performs some initial checks on the message to validate that the transaction doesn't have errors that would prevent it from being executed.\nThese initial checks include verifying the signatures format, metadata, and the availability of funds to pay transaction fees.\nIf there are issues\u2014like an invalid signature or a time-to-live (TTL) that has expired\u2014the transaction fails immediately without further processing.\nIf the initial checks pass, the node receiving the transaction message assigns the message a unique transaction identifier (txid) and inserts the transaction into its holding area for pending transactions, called the ",(0,i.jsx)(t.strong,{children:"mempool"}),".\nThe transactions waiting to be included in a block are synchronized across all of the nodes."]}),"\n",(0,i.jsx)(t.p,{children:"Mining nodes, typically Chainweb nodes with specialized application-specific integrated circuit hardware attached, periodically check the transaction pool\u2014the mempool\u2014for new work and select transactions to validate based on their transaction fees.\nAfter the mining node computes the solution that validates the transaction, it includes the transaction in its next block.\nThe block that includes the transaction is then sent to all of the nodes in the network, including the node where the transaction originated."}),"\n",(0,i.jsx)(t.p,{children:"The following diagram provides a simplified view of the transaction flow for a single-step exec transaction."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Transaction lifecycle",src:n(44286).A+"",width:"2672",height:"1560"})}),"\n",(0,i.jsxs)(t.p,{children:["Throughout its lifecycle, there are several ways you can check the status of the transaction using the transaction identifier or request key.\nFor example, you can use the Pact ",(0,i.jsx)(t.code,{children:"/listen"})," endpoint to wait for the results from a single transaction or the Pact ",(0,i.jsx)(t.code,{children:"/poll"})," endpoint to poll the node for one or more transaction results without blocking new requests.\nYou can also check whether transactions are pending in the mempool by calling the ",(0,i.jsx)(t.a,{href:"/api/peer-to-peer",children:"peer-to-peer API"})," endpoints, such as the ",(0,i.jsx)(t.code,{children:"/mempool/member"})," and ",(0,i.jsx)(t.code,{children:"/mempool/lookup"})," endpoints."]}),"\n",(0,i.jsxs)(t.p,{children:["If you don't want to use the ",(0,i.jsx)(t.a,{href:"/api/pact-api",children:"Pact API"})," or the ",(0,i.jsx)(t.a,{href:"/api/peer-to-peer",children:"peer-to-peer API"})," to see results, you can enter the transaction request key in a block explorer, such as ",(0,i.jsx)(t.a,{href:"https://explorer.kadena.io/mainnet",children:"explorer.kadena.io/mainnet"})," or ",(0,i.jsx)(t.a,{href:"https://explorer.kadena.io/testnet",children:"explorer.kadena.io/testnet"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"multi-step-transaction-flow",children:"Multi-step transaction flow"}),"\n",(0,i.jsx)(t.p,{children:"At a high level, the workflow for transactions with more than one step is the same as single-step transactions.\nHowever, transactions with more than one step require a both an initial transaction request and a continuation message to be sent to a node.\nDepending on the logic in the smart contract, each part of the transaction might be initiated by the same entity or required to be initiated by different entities.\nThe logic in the smart contract also determines whether each step can be rolled back to a previous state under specific conditions or discontinued as an incomplete operation."}),"\n",(0,i.jsxs)(t.p,{children:["Much like single-step transactions, the node receiving the first step in a ",(0,i.jsx)(t.code,{children:"defpact"})," transaction message assigns the message a unique identifier (pact-id).\nThis identifier is what ties the steps together as parts of the same transaction.\nThe remainder of the workflow for the first step in a ",(0,i.jsx)(t.code,{children:"defpact"})," transaction is the same as any other execution request."]}),"\n",(0,i.jsx)(t.h3,{id:"two-step-transactions-without-rollback",children:"Two-step transactions without rollback"}),"\n",(0,i.jsxs)(t.p,{children:["In cross-chain transfers, a receiving account is typically responsible for sending the continuation transaction request and paying the transaction fee associated with that request.\nHowever, any account\u2014including a dedicated autonomous ",(0,i.jsx)(t.a,{href:"/resources/glossary#gas-station",children:"gas station"})," account\u2014can sign and send the continuation request.\nIf there's a delay in sending the continuation request, the transfer operation remains incomplete."]}),"\n",(0,i.jsx)(t.h3,{id:"two-step-transactions-with-rollback",children:"Two-step transactions with rollback"}),"\n",(0,i.jsxs)(t.p,{children:["Multi-step ",(0,i.jsx)(t.code,{children:"defpact"})," transactions can also include logic to rollback a step under specified conditions.\nFor example, you can use a  ",(0,i.jsx)(t.code,{children:"defpact"})," transaction to orchestrate operations similar to an escrow service, moving assets into a holding account until contractual obligations are met and the releasing assets only after all parties have completed require actions.\nA step with rollback logic could specify a time limit for completing required actions and return assets to the original account if all required steps aren't completed within the time allowed."]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},44286:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/docs-transactions-flow-smart-contracts-da99da905f56f258502a4c6a49f2717d.png"},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>r});var a=n(96540);const i={},s=a.createContext(i);function o(e){const t=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);