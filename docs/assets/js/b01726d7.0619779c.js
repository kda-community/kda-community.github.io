"use strict";(self.webpackChunkkadena_docs=self.webpackChunkkadena_docs||[]).push([[3802],{86399:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"guides/contracts/howto-deploy-contracts","title":"Deploy smart contracts","description":"A guide to deploying smart contracts using an API call, the Kadena CLI, and Kadena.js","source":"@site/docs/guides/contracts/deploy-a-contract.md","sourceDirName":"guides/contracts","slug":"/guides/contracts/howto-deploy-contracts","permalink":"/docs/guides/contracts/howto-deploy-contracts","draft":false,"unlisted":false,"editUrl":"https://github.com/kda-community/kadena-docs-new/blob/master/docs/guides/contracts/deploy-a-contract.md","tags":[],"version":"current","frontMatter":{"title":"Deploy smart contracts","description":"A guide to deploying smart contracts using an API call, the Kadena CLI, and Kadena.js","id":"howto-deploy-contracts"},"sidebar":"default","previous":{"title":"Check account balances","permalink":"/docs/guides/accounts/howto-get-balances"},"next":{"title":"Call contract functions","permalink":"/docs/guides/contracts/howto-call-functions"}}');var c=t(74848),o=t(28453);const s={title:"Deploy smart contracts",description:"A guide to deploying smart contracts using an API call, the Kadena CLI, and Kadena.js",id:"howto-deploy-contracts"},r="Deploy smart contracts",i={},l=[{value:"Using a YAML request and curl",id:"using-a-yaml-request-and-curl",level:2},{value:"Using kadena-cli commands",id:"using-kadena-cli-commands",level:2},{value:"Using the Kadena client library",id:"using-the-kadena-client-library",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"deploy-smart-contracts",children:"Deploy smart contracts"})}),"\n",(0,c.jsx)(n.p,{children:"This guide provides instructions and examples for deploying a smart contract by using an API call, the Kadena CLI, or the Kadena client TypeScript library."}),"\n",(0,c.jsx)(n.h2,{id:"using-a-yaml-request-and-curl",children:"Using a YAML request and curl"}),"\n",(0,c.jsxs)(n.p,{children:["One way you can deploy a new smart contract is by constructing a YAML execution request, formatting the request as a JSON object, and sending the request to an API endpoint using the ",(0,c.jsx)(n.code,{children:"curl"})," command.\nYou could also submit the request using Postman or other tools that enable you to call API endpoints directly.\nHowever, formatting an API request manually is typically an error-prone process and inserting full contract code\u2014even for a simple contract\u2014into a YAML configuration file can often lead to unexpected results or errors."]}),"\n",(0,c.jsx)(n.p,{children:"In most cases, constructing a transaction to deploy a smart contract is less error-prone if you use the Kadena CLI.\nThe Kadena CLI uses the Kadena client library as a foundation for abstracting and simplifying interaction with the blockchain."}),"\n",(0,c.jsxs)(n.p,{children:["If you want to deploy a contract by using the ",(0,c.jsx)(n.code,{children:"curl"})," command directly, the following example illustrates the steps involved."]}),"\n",(0,c.jsxs)(n.p,{children:["To deploy a smart contract with a ",(0,c.jsx)(n.code,{children:"curl"})," command:"]}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"Generate a public and secret key pair and save them to a file."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"pact --genkey > pistolas.yaml\n"})}),"\n",(0,c.jsx)(n.p,{children:"For this example, the following keys are used:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:"public: 3bdb1d3c48a1bb5f072b067e265ce5d9a5eabf5e290128be4d2623dd559ca698\nsecret: 682ce35a77eece5060537632423de96b965136bd7739c5064903612c0b300608\n"})}),"\n",(0,c.jsx)(n.p,{children:"Use the public key to create and fund an account on at least one chain in the development, test, or main network.\nFor example:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Use ",(0,c.jsx)(n.code,{children:"kadena account add"})," to add an account for the public key manually in the development network and one or more chains."]}),"\n",(0,c.jsxs)(n.li,{children:["Use ",(0,c.jsx)(n.code,{children:"kadena account fund"})," to fund the account on one or more chains."]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"Construct the transaction using the YAML transaction request format.\nFor example, using the account values associated with the 3bdb1d3c48a1bb5f072b067e265ce5d9a5eabf5e290128be4d2623dd559ca698 public key account, the YAML file looks like this:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'# deploy-vote.yaml - YAML configuration for deploying a smart contract\ncodeFile: "simple-vote.pact"\ndata:\npublicMeta:\n  chainId: "3"\n  sender: "pact-generated-key"\n  gasLimit: 80300\n  gasPrice: 0.000001\n  ttl: 6000\nkeyPairs:\n  - public: 3bdb1d3c48a1bb5f072b067e265ce5d9a5eabf5e290128be4d2623dd559ca698\n    secret: 682ce35a77eece5060537632423de96b965136bd7739c5064903612c0b300608\n    caps:\n      - name: "coin.GAS"\n        args: []\nnetworkId: "development"\ntype: exec\n'})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"Convert the YAML transaction request to a valid transaction JSON object."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"pact --apireq deploy-vote.yaml > deploy-vote.json\n"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Use ",(0,c.jsx)(n.code,{children:"curl"})," to connect to the ",(0,c.jsx)(n.code,{children:"/send"})," endpoint to deploy the contract.\nFor example, you can run a command similar to the following to deploy a contract on the ",(0,c.jsx)(n.code,{children:"development"})," network:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'curl -X POST -H "Content-Type: application/json" -d "@deploy-vote.json" http://localhost:8080/chainweb/0.0/development/chain/3/pact/api/v1/send\n'})}),"\n",(0,c.jsx)(n.p,{children:"The command returns a request key that you can use to view the transaction results in the block explorer."}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"using-kadena-cli-commands",children:"Using kadena-cli commands"}),"\n",(0,c.jsxs)(n.p,{children:["With the ",(0,c.jsx)(n.code,{children:"kadena-cli"}),", you can construct a transaction template to deploy smart contracts.\nYou can then customize the transactions to deploy the same contract on different chains or different networks.\nDepending on how you create your template, you can also use it to deploy different types of contracts with interactive prompting for values or by setting command-line options."]}),"\n",(0,c.jsxs)(n.p,{children:["To deploy a smart contract using ",(0,c.jsx)(n.code,{children:"kadena-cli"}),":"]}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Create a ",(0,c.jsx)(n.code,{children:"deploy-contract.ktpl"})," template file with the template variables for deploying a contract."]}),"\n",(0,c.jsxs)(n.p,{children:["Note that you can embed Pact code directly in a template or data file using the ",(0,c.jsx)(n.code,{children:"code"})," key.\nAlternatively, you can use the ",(0,c.jsx)(n.code,{children:"codeFile"})," key to specify the path to a Pact file.\nFor example, you might create a template file similar to the following:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'# deploy-contract.yaml - YAML configuration for deploying a smart contract\ncodeFile: |-\n  "{{contract-filename}}"\ndata:\n  ks: {\n    keys: [58705e8699678bd15bbda2cf40fa236694895db614aafc82cf1c06c014ca963c],\n    pred: "keys-all"\n  }\npublicMeta:\n  chainId: "{{chain-id}}"\n  sender: "{{{deployer-account}}}"\n  gasLimit: 80300\n  gasPrice: 0.000001\n  ttl: 600\nsigners:\n  - public: "{{deployer-public-key}}"\n    caps:\n      - name: "coin.GAS"\n        args: []\nnetworkId: "{{network-id}}"\ntype: exec\n'})}),"\n",(0,c.jsxs)(n.p,{children:["For convenience, you can move the ",(0,c.jsx)(n.code,{children:"deploy-contract.ktpl"})," template to the ",(0,c.jsx)(n.code,{children:".kadena/transaction-templates"})," directory, so that the template is listed when you add transactions with interactive prompting."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Create a new unsigned transaction using the ",(0,c.jsx)(n.code,{children:"kadena tx add"})," command and the ",(0,c.jsx)(n.code,{children:"deploy-contract.ktpl"})," template and follow the prompts displayed to set the appropriate information."]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["For the ",(0,c.jsx)(n.code,{children:"contract-filename"})," template value, specify the path to the Pact file you want to deploy.\nThe path should be relative to the ",(0,c.jsx)(n.code,{children:".kadena/transaction-templates"})," directory."]}),"\n",(0,c.jsxs)(n.li,{children:["For the ",(0,c.jsx)(n.code,{children:"deployer-account"})," template value, specify the account name of the contract owner.\nIn this example, it's the Chainweaver wallet account ",(0,c.jsx)(n.code,{children:"k:58705e8699678bd15bbda2cf40fa236694895db614aafc82cf1c06c014ca963c"}),"\nand the public key is ",(0,c.jsx)(n.code,{children:"58705e8699678bd15bbda2cf40fa236694895db614aafc82cf1c06c014ca963c"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["For the ",(0,c.jsx)(n.code,{children:"chain-id"})," and ",(0,c.jsx)(n.code,{children:"network-id"})," template values, specify the chain and network where you want to deploy the contract.\nIn this example, the contract is deployed on chain ",(0,c.jsx)(n.code,{children:"3"})," in the ",(0,c.jsx)(n.code,{children:"development"})," network."]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"For example, the prompts and output for creating the transaction look similar to the following:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'kadena tx add\n? Which template do you want to use: deploy-hello.ktpl\n? File path of data to use for template .json or .yaml (optional):\n? Template value contract-filename: deploy-hello.pact\n? Template value chain-id: 3\n? Template value deployer-account:\nk:58705e8699678bd15bbda2cf40fa236694895db614aafc82cf1c06c014ca963c\n? Template value deployer-public-key:\n58705e8699678bd15bbda2cf40fa236694895db614aafc82cf1c06c014ca963c\n? Template value network-id: development\n? Where do you want to save the output: test-hello\n{\n  "cmd": "{\\"payload\\":{\\"exec\\":{\\"code\\":\\"(namespace \'free)\\\\n    (module simplemodule GOV\\\\n    (defcap GOV () true)\\\\n      (defconst TEXT:string \\\\\\"Hello World\\\\\\")\\\\n      (defun greet:string () TEXT)\\\\n)\\\\n\\",\\"data\\":{\\"ks\\":{\\"keys\\":[\\"58705e8699678bd15bbda2cf40fa236694895db614aafc82cf1c06c014ca963c\\"],\\"pred\\":\\"keys-all\\"}}}},\\"nonce\\":\\"\\",\\"networkId\\":\\"development\\",\\"meta\\":{\\"sender\\":\\"k:58705e8699678bd15bbda2cf40fa236694895db614aafc82cf1c06c014ca963c\\",\\"chainId\\":\\"3\\",\\"creationTime\\":1733266205,\\"gasLimit\\":80300,\\"gasPrice\\":0.000001,\\"ttl\\":600},\\"signers\\":[{\\"pubKey\\":\\"58705e8699678bd15bbda2cf40fa236694895db614aafc82cf1c06c014ca963c\\",\\"clist\\":[{\\"name\\":\\"coin.GAS\\",\\"args\\":[]}]}]}",\n  "hash": "B-j2_RSbfNixi3tAP6yl3PAGG1WU2RuGV4Wy9x4pcS8",\n  "sigs": [\n    null\n  ]\n}\n\ntransaction saved to: ./test-hello.json\n'})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Sign the unsigned transaction using the ",(0,c.jsx)(n.code,{children:"kadena tx sign"})," command and the transaction file name generated by the ",(0,c.jsx)(n.code,{children:"kadena tx add"})," command."]}),"\n",(0,c.jsx)(n.p,{children:"For example, the prompts and output for the transaction look similar to the following:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'kadena tx sign\n? Select an action: Sign with wallet\n? Select a transaction file: Transaction: test-hello.json\n? 1 wallets found containing the keys for signing this transaction, please \nselect a wallet to sign this transaction with first: Wallet: chainweaver-web\n? Enter the wallet password: ********\nCommand 1 (hash: B-j2_RSbfNixi3tAP6yl3PAGG1WU2RuGV4Wy9x4pcS8) will now be signed with the following signers:\nPublic Key                                                       Capabilities\n58705e8699678bd15bbda2cf40fa236694895db614aafc82cf1c06c014ca963c coin.GAS()  \nTransaction executed code: \n"(namespace \'free)\\n    (module simplemodule GOV\\n    (defcap GOV () true)\\n      (defconst TEXT:string \\"Hello World\\")\\n      (defun greet:string () TEXT)\\n)\\n"\n\nTransaction with hash: B-j2_RSbfNixi3tAP6yl3PAGG1WU2RuGV4Wy9x4pcS8 was successfully signed.\nSigned transaction saved to /Users/lisagunn/KADENA-DOCS-NextGen/pact-coding-projects/transaction-B-j2_RSbfN-signed.json\n'})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Send the signed transaction using the ",(0,c.jsx)(n.code,{children:"kadena tx send"})," command and the signed transaction file name generated by the ",(0,c.jsx)(n.code,{children:"kadena tx sign"})," command."]}),"\n",(0,c.jsx)(n.p,{children:"For example, the prompts and output for the transaction look similar to the following:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"kadena tx send\n? Select a transaction file: Transaction: transaction-B-j2_RSbfN-signed.json\n\u280b Sending transactions...\n\nTransaction detail for command with hash: B-j2_RSbfNixi3tAP6yl3PAGG1WU2RuGV4Wy9x4pcS8\nNetwork ID  Chain ID\ndevelopment 3       \n\n\n\u2714 Completed\nTransaction: B-j2_RSbfNixi3tAP6yl3PAGG1WU2RuGV4Wy9x4pcS8 submitted with request key: B-j2_RSbfNixi3tAP6yl3PAGG1WU2RuGV4Wy9x4pcS8\n"})}),"\n",(0,c.jsx)(n.p,{children:"After the transaction is sent to the blockchain, you can verify deployment in the block explorer by using the request key."}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"using-the-kadena-client-library",children:"Using the Kadena client library"}),"\n",(0,c.jsxs)(n.p,{children:["If you prefer to work with JavaScript, you can use the ",(0,c.jsx)(n.code,{children:"@kadena/client"})," library to write your own scripts to deploy contracts and perform other tasks.\nThe ",(0,c.jsx)(n.code,{children:"@kadena/client"})," library implements a TypeScript-based API for interacting with smart contracts and Chainweb nodes.\nThe library provides functions that simplify building transactions with Pact commands and connecting to blockchain nodes.\nYou should note that creating the client connection is separate from using the ",(0,c.jsx)(n.code,{children:"Pact.builder"})," function to construct transactions."]}),"\n",(0,c.jsxs)(n.p,{children:["The following example illustrates what a script using ",(0,c.jsx)(n.code,{children:"@kadena/client"})," to deploy a smart contract would look like.\nThis example deploys the ",(0,c.jsx)(n.code,{children:"simplemodule"})," in the ",(0,c.jsx)(n.code,{children:"free"})," namespace on the ",(0,c.jsx)(n.code,{children:"testnet04"})," network."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"import type { ICommand } from '@kadena/client';\nimport { Pact, createClient } from '@kadena/client';\nimport { createRequestToSign } from './util/requestToSign';\n\nconst signTransaction = createRequestToSign();\n\nasync function deployContract(\n  deployerAccount: string,\n  pubKey: string,\n  contractCode: string,\n) {\n  const pactClient = createClient();\n\n  const tx = Pact.builder\n    .execution(contractCode)\n    .addSigner(pubKey, (signFor) => [signFor('coin.GAS')])\n    .setMeta({\n      chainId: '1',\n      gasLimit: 80300,\n      gasPrice: 0.0000001,\n      senderAccount: deployerAccount,\n    })\n    .setNetworkId('testnet04')\n    .createTransaction();\n\n  try {\n    const signedTx = (await signTransaction(tx)) as ICommand; // Pick your preferred signing method\n    const preflightResult = await pactClient.preflight(signedTx);\n    console.log('Preflight result:', preflightResult);\n\n    if (preflightResult.result.status === 'failure') {\n      console.error('Preflight failed:', preflightResult.result.error);\n      return preflightResult;\n    }\n\n    const res = await pactClient.submit(signedTx);\n    console.log('Deploy request sent', res);\n    const result = await pactClient.pollOne(res);\n    if (result.result.status === 'failure') {\n      console.error('Deploy failed:', result.result.error);\n    }\n    return result;\n  } catch (error) {\n    console.error('Error deploying contract:', error);\n  }\n}\nconst deployerKDAAccount =\n  'k:94eede9754031395401332c2032694da9dd2f7972fb039070f698a3173745a8b';\nconst deployerPublicKey =\n  '94eede9754031395401332c2032694da9dd2f7972fb039070f698a3173745a8b';\ndeployContract(\n  deployerKDAAccount,\n  deployerPublicKey,\n  `\n  (namespace 'free)\n  (module simplemodule GOV\n    (defcap GOV () true)\n    (defconst TEXT:string \"Hello World\")\n    (defun greet:string () TEXT)\n  )`,\n)\n  .then((result) => {\n    console.log('Contract deployed:', result);\n  })\n  .catch(console.error);\n"})}),"\n",(0,c.jsxs)(n.p,{children:["The following example illustrates using a ",(0,c.jsx)(n.code,{children:"requestToSign"})," helper script."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"import type { ICommand, IUnsignedCommand } from '@kadena/types';\n\nconst browserPrompt = async (command: string) => {\n  await window.navigator.clipboard.writeText(command);\n  return Promise.resolve(\n    window.prompt(\n      `Command:\\n${command}\\nCommand copied to the clipboard\\nEnter Signature:\\n)`,\n    ) ?? '',\n  );\n};\n\nconst nodePrompt = async (command: string) => {\n  const message = `Command:\\n${command}\\nEnter Signature:\\n`;\n  const readline = await import('node:readline');\n  const rl = readline.createInterface({\n    input: process.stdin,\n    output: process.stdout,\n  });\n  return new Promise<string>((resolve) => {\n    rl.question(message, (answer) => {\n      resolve(answer);\n      rl.close();\n    });\n  });\n};\n\nexport function createRequestToSign(\n  prompt: (message: string) => Promise<string> = typeof window !== 'undefined'\n    ? browserPrompt\n    : nodePrompt,\n) {\n  return async (command: IUnsignedCommand): Promise<ICommand> => {\n    const sig = await prompt(JSON.stringify(command, null, 2));\n    return {\n      ...command,\n      sigs: [{ sig }],\n    };\n  };\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>r});var a=t(96540);const c={},o=a.createContext(c);function s(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:s(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);