"use strict";(self.webpackChunkkadena_docs=self.webpackChunkkadena_docs||[]).push([[5435],{19435:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>u,frontMatter:()=>s,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"reference/guard-json","title":"Guard JSON representation","description":"This technical specification describes the JSON representation for different guards returned by the chain.","source":"@site/docs/reference/guard-json.md","sourceDirName":"reference","slug":"/reference/guard-json","permalink":"/docs/reference/guard-json","draft":false,"unlisted":false,"editUrl":"https://github.com/kda-community/kadena-docs-new/blob/master/docs/reference/guard-json.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Guard JSON representation","description":"This technical specification describes the JSON representation for different guards returned by the chain.","id":"guard-json","sidebar_position":5},"sidebar":"default","previous":{"title":"Chainweb execution and latency","permalink":"/docs/reference/latency"},"next":{"title":"Exchange integration guide","permalink":"/docs/reference/dex-integration"}}');var i=a(74848),r=a(28453);const s={title:"Guard JSON representation",description:"This technical specification describes the JSON representation for different guards returned by the chain.",id:"guard-json",sidebar_position:5},d="Guard JSON representation",c={},o=[{value:"Keyset guards",id:"keyset-guards",level:2},{value:"Type definition",id:"type-definition",level:3},{value:"Examples",id:"examples",level:3},{value:"Principal account prefix",id:"principal-account-prefix",level:3},{value:"KeysetRef guard",id:"keysetref-guard",level:2},{value:"Type definition",id:"type-definition-1",level:3},{value:"Examples",id:"examples-1",level:3},{value:"User guard",id:"user-guard",level:2},{value:"Type definition",id:"type-definition-2",level:3},{value:"Examples",id:"examples-2",level:3},{value:"Principal account prefix",id:"principal-account-prefix-1",level:3},{value:"Capability guard",id:"capability-guard",level:2},{value:"Type definition",id:"type-definition-3",level:3},{value:"Principal account prefix",id:"principal-account-prefix-2",level:2},{value:"Module guard (DEPRECATED)",id:"module-guard-deprecated",level:2},{value:"Type definition",id:"type-definition-4",level:3},{value:"Examples",id:"examples-3",level:3},{value:"Pact guard (DEPRECATED)",id:"pact-guard-deprecated",level:2},{value:"Type definition",id:"type-definition-5",level:3},{value:"Examples",id:"examples-4",level:3},{value:"Union",id:"union",level:2},{value:"Pact value literals",id:"pact-value-literals",level:2},{value:"Pact value union types",id:"pact-value-union-types",level:2}];function l(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"guard-json-representation",children:"Guard JSON representation"})}),"\n",(0,i.jsx)(n.p,{children:"In the technical specification for the guard types, the following types all correspond to JSON types:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"String"}),"\n",(0,i.jsx)(n.li,{children:"Number"}),"\n",(0,i.jsx)(n.li,{children:"Array[*]"}),"\n",(0,i.jsx)(n.li,{children:"Bool"}),"\n",(0,i.jsxs)(n.li,{children:["Objects (",(0,i.jsx)(n.code,{children:'{"field":type}'}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"keyset-guards",children:"Keyset guards"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"keyset"})," guard is the backward-compatible ",(0,i.jsx)(n.code,{children:"keyset"})," as originally defined in Pact.\nThis guard is also referred to as a ",(0,i.jsx)(n.strong,{children:"concrete keyset"})," that's defined in the environment.\nUsing the ",(0,i.jsx)(n.code,{children:"keyset"})," type is the one instance where you can restrict a guard subtype.\nFor all other guards, the ",(0,i.jsx)(n.code,{children:"guard"})," type obscures the implementation type to discourage you from using guard-specific control flow, which would be against best practices.\nIn general, you should use the ",(0,i.jsx)(n.code,{children:"guard"})," type unless you have a specific need to use a keyset."]}),"\n",(0,i.jsx)(n.h3,{id:"type-definition",children:"Type definition"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "keys": Array[String],\n    "pred": String\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "admin-keyset": {\n    "keys": [\n      "58705e8699678bd15bbda2cf40fa236694895db614aafc82cf1c06c014ca963c"\n    ],\n    "pred": "keys-all"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'(define-keyset "admin-keyset" (read-keyset "admin-keyset"))\n(enforce-guard (read-keyset "admin-keyset"))\n'})}),"\n",(0,i.jsx)(n.h3,{id:"principal-account-prefix",children:"Principal account prefix"}),"\n",(0,i.jsxs)(n.p,{children:["Each type of principal and guard uses a unique prefix, so they are easy to recognize.\nIf you use the ",(0,i.jsx)(n.code,{children:"create-principal"})," function to a create principal account for a keyset guard, the principal account uses one of the following prefixes:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"k: for single key keysets"}),"\n",(0,i.jsx)(n.li,{children:"w: for multiple keys keysets"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"keysetref-guard",children:"KeysetRef guard"}),"\n",(0,i.jsxs)(n.p,{children:["You can install concrete keyset guards in the REPL environment by using the ",(0,i.jsx)(n.code,{children:"define-keyset"})," function.\nHowever, if you want to store a reference to a defined keyset, you must use a ",(0,i.jsx)(n.code,{children:"string"})," type.\nTo make REPL environment keysets interoperate with concrete keysets and other guards, you can use the KeysetRef guard to indicate that a defined keyset is used instead of a concrete keyset."]}),"\n",(0,i.jsx)(n.h3,{id:"type-definition-1",children:"Type definition"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "keysetref": {\n        "ns": String?,\n        "ksn": String\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"examples-1",children:"Examples"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'(enforce-guard (keyset-ref-guard "foo"))\n\n(update accounts user { "guard": (keyset-ref-guard "foo") })\n'})}),"\n",(0,i.jsx)(n.h2,{id:"user-guard",children:"User guard"}),"\n",(0,i.jsx)(n.p,{children:"User guards allow you to design an arbitrary predicate function to enforce the guard, given some initial data.\nWith user guards, you can implement any type custom predicate logic that can't be expressed by other built-in guard types."}),"\n",(0,i.jsx)(n.p,{children:"For example, you might want to customize the guard to allow one of two different keysets to sign:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"One keyset registers the keys for the members of a board of directors."}),"\n",(0,i.jsx)(n.li,{children:"A second keyset registers the keys for union representatives."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"You can then design a user guard to require two separate keysets to be enforced:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'(defun both-sign (board union)\n  (enforce-keyset board)\n  (enforce-keyset union))\n\n(defun install-both-guard ()\n  (write guard-table "both"\n    { "guard":\n      (create-user-guard\n        (both-sign (read-keyset "board) (read-keyset "union")))\n    }))\n\n\n(defun enforce-both-guard ()\n  (enforce-guard (at "guard" (read guard-table "both"))))\n'})}),"\n",(0,i.jsx)(n.p,{children:"User guards can be very flexible and powerful.\nThey can be stored in the database and passed around like plain data.\nHowever, user guards are pure functions that don't allow access to a database during evaluation of the guard."}),"\n",(0,i.jsx)(n.h3,{id:"type-definition-2",children:"Type definition"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "fun": String,\n    "args": Array[PactValue]\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"examples-2",children:"Examples"}),"\n",(0,i.jsx)(n.p,{children:"The following example illustrates how to write a custom hash timelock guard to implement atomic swaps."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'\n(create-hashlock-guard (secret-hash timeout signer-ks)\n  (create-user-guard (enforce-hashlock secret-hash timeout signer-ks)))\n\n(defun enforce-hashlock (secret-hash timeout signer-ks)\n  (enforce-one [\n    (enforce (= (hash (read-msg "secret")) secret-hash))\n    (and\n      (enforce-keyset signer-ks)\n      (enforce (> (at "block-time" (chain-data)) timeout) "Timeout not passed"))\n      ]))\n'})}),"\n",(0,i.jsx)(n.h3,{id:"principal-account-prefix-1",children:"Principal account prefix"}),"\n",(0,i.jsxs)(n.p,{children:["Each type of principal and guard uses a unique prefix, so they are easy to recognize.\nIf you use the ",(0,i.jsx)(n.code,{children:"create-user-guard"})," function to create a principal account for a user guard, the principal account uses the following prefix:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"u: for user guards"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"capability-guard",children:"Capability guard"}),"\n",(0,i.jsx)(n.p,{children:"Capabilities are in-module rights that can only be enforced within the declaring module, and offer scoping and the other benefits."}),"\n",(0,i.jsx)(n.p,{children:"Because user guards are required to be pure functions, they can't take database state into account.\nIf you need to access database state, you can define a guard that requires a capability to be brought into scope.\nWith this type of guard, you can retrieve database state when you bring the capability into scope."}),"\n",(0,i.jsx)(n.h3,{id:"type-definition-3",children:"Type definition"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "cgName": String,\n    "cgArgs": Array[PactValue],\n    "cgPactId": String?\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"For information about PactValue types, see Pact values."}),"\n",(0,i.jsx)(n.h2,{id:"principal-account-prefix-2",children:"Principal account prefix"}),"\n",(0,i.jsxs)(n.p,{children:["Each type of principal and guard uses a unique prefix, so they are easy to recognize.\nIf you use the ",(0,i.jsx)(n.code,{children:"create-capability-guard"})," function to create a principal account for a capability guard, the principal account uses the following prefix:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"c: for capability guards"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"module-guard-deprecated",children:"Module guard (DEPRECATED)"}),"\n",(0,i.jsxs)(n.p,{children:["Modules always guard access to the tables and functions that are defined within the module.\nFor example, when you create a table, you must specify a module name.\nThis requirement ensures that tables are fully encapsulated or ",(0,i.jsx)(n.em,{children:"guarded"})," by the module and that direct access to the table through ",(0,i.jsx)(n.a,{href:"/pact-5/database",children:"data-access functions"})," can only be authorized by the administrative owner of the module.\nHowever, within module functions, table access is unconstrained.\nThis behavior gives you flexibility in designing data access, and ensures that the module is the main point of entry for all data-related interactions."]}),"\n",(0,i.jsx)(n.p,{children:"Within a module, only the module code or a transaction having module administrative privileges can write directly to a module table or upgrade the module.\nModule guards aren't required to protect these in-module operations."}),"\n",(0,i.jsx)(n.p,{children:"Instead, module guards are intended to allow a Pact module or smart contract to autonomously own or manage an asset outside of the module, for example, to own coins in an external ledger or manage assets in an internal ledger alongside other non-module owners.\nIf a module guard is enforced:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"enforce-guard"})," function must called from within the module."]}),"\n",(0,i.jsx)(n.p,{children:"or"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Module governance must be granted to the current transaction."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["For more information about module management, see ",(0,i.jsx)(n.a,{href:"/smart-contracts/modules#module-governance",children:"Governance"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"type-definition-4",children:"Type definition"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "moduleName": ModuleName,\n    "name": String\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"examples-3",children:"Examples"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"create-module-guard"})," function takes a ",(0,i.jsx)(n.code,{children:"string"})," argument to allow you to name the guard with text that indicates the purpose or role of the guard."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'(enforce-guard (create-module-guard "module-owned-asset"))\n'})}),"\n",(0,i.jsx)(n.h2,{id:"pact-guard-deprecated",children:"Pact guard (DEPRECATED)"}),"\n",(0,i.jsxs)(n.p,{children:["Pact guards are a special guard that only pass if called in the specific ",(0,i.jsx)(n.code,{children:"defpact"})," execution in which the guard was created.\nPact guards turn ",(0,i.jsx)(n.code,{children:"defpact"})," executions into autonomous processes that can own assets, and is a powerful technique for trustless asset management within a multi-step operation."]}),"\n",(0,i.jsx)(n.h3,{id:"type-definition-5",children:"Type definition"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "pactId": String,\n    "name": String\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"examples-4",children:"Examples"}),"\n",(0,i.jsxs)(n.p,{children:["The following example illustrates the use of a ",(0,i.jsx)(n.code,{children:"pact"})," guard for an escrow transaction modeled as a two-step ",(0,i.jsx)(n.code,{children:"defpact"})," declaration.\nIn this example, the funds go into a account named after the ",(0,i.jsx)(n.code,{children:"pact-id"})," identifier, guarded by a ",(0,i.jsx)(n.code,{children:"pact"})," guard.\nThis means that only code in a subsequent step of that particular pact execution\u2014that is, having the same ",(0,i.jsx)(n.code,{children:"pact-id"})," as the previous\u2014can satisfy the guard."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'(defpact escrow (from to amount)\n  (step (with-capability (ESCROW) (init-escrow from amount)))\n  (step (with-capability (ESCROW) (complete-escrow to amount))))\n\n(defun init-escrow (from amount)\n  (require-capability (ESCROW))\n  (create-account (pact-id) (create-pact-guard "escrow"))\n  (transfer from (pact-id) amount))\n\n(defun complete-escrow (to amount)\n  (require-capability (ESCROW))\n  (with-capability (USER_GUARD (pact-id)) ;; enforces guard on account (pact-id)\n    (transfer (pact-id) to amount)))\n'})}),"\n",(0,i.jsx)(n.h2,{id:"union",children:"Union"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:"Union = Keyset | KeysetRef | UserGuard | CapabilityGuard | ModuleGuard | PactGuard\n"})}),"\n",(0,i.jsx)(n.h2,{id:"pact-value-literals",children:"Pact value literals"}),"\n",(0,i.jsx)(n.p,{children:"The following pseudo code provides type information for decoding Pact values returned by guards:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'Union PvLiteral = PvString | PvInteger | PvDecimal | PvBool\n\nPvString = String\n\n# You can treat an integer as a JSON number if it\'s between the range\n# -9007199254740991 <= n && n <= 9007199254740991\n# or as a string you need to decode an integer that exceeds the range:\n\nPvInteger = {"int": (Number | String) }\n\n# You can treat an integer as a JSON number if it\'s between the range\n# -9007199254740991 <= n && n <= 9007199254740991\n# or as a string you need to decode an integer that exceeds the range:\n\n  The exact logic for how this happens is determined by the function, in pseudo:\n    def encodeInteger (i:PactInteger) : {"int": (Number | String) } =\n      let encodeInt(n:PactInteger) : Number | String =\n            if -9007199254740991 <= n && n <= 9007199254740991 then encodeNumber else encodeString\n      in return { "int": encodeInt(i) }\n\nPvDecimal = Number | { "decimal":String }\n\n# You can treat a decimal as a JSON number if it\'s between the range\n# -9007199254740991 <= mantissa(i) && mantissa(i) <= 9007199254740991\n# or as a string you need to decode an integer that exceeds the range:\n\n  The exact logic for how this happens is determined by the function, in pseudo:\n    def encodeDecimal (i:PactDecimal) : (Number | {"decimal": String }) =\n      if -9007199254740991 <= mantissa(i) && mantissa(i) <= 9007199254740991 then\n        return encodeNumber(i)\n       else return { "decimal":encodeString(i) }\n\nPvBool = Bool\n'})}),"\n",(0,i.jsx)(n.h2,{id:"pact-value-union-types",children:"Pact value union types"}),"\n",(0,i.jsx)(n.p,{children:"The following pseudo code provides type information for decoding Pact values returned by recursive guards:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'Union PactValue = PvLiteral | PvList | PvGuard | PvObject | PvModRef | PvTime | PvCapToken\n\nPvList = Array[PactValue]\n\nPvGuard = Guard\n\nPvObject = { f : PactValue | f in {String} }\n// Fields can be any string, but their value is a pact value:\n\nPvModRef = { "refName":String, "refSpec":Array[ModuleName])\n// See # Misc type for module names\n\nPvTime = { "time" : String } | { "timep" : String }\n// There\'s specific formatting here depending on the UTC denom.\n// See https://github.com/kadena-io/pact/blob/e72d86749f5d65ac8d6e07a7652dd2ffb468607b/src/Pact/Types/Codec.hs#L150\n// for further details.\n\nPvCapToken = { "ctName":String, "ctArgs":Array[PactValue] }\n// Only after pact 5:\n\nModuleName = { "name":String, "namespace":String? }\n// Misc type\n'})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},28453:(e,n,a)=>{a.d(n,{R:()=>s,x:()=>d});var t=a(96540);const i={},r=t.createContext(i);function s(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);