"use strict";(self.webpackChunkkadena_docs=self.webpackChunkkadena_docs||[]).push([[2094],{6578:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>h,frontMatter:()=>c,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"resources/election-workshop/workshop-nominate","title":"Nominate candidates","description":"Work with database schemas and tables in your Pact module to manage candidates for the election application smart contract backend.","source":"@site/docs/resources/election-workshop/7-nominate-candidates.md","sourceDirName":"resources/election-workshop","slug":"/resources/election-workshop/workshop-nominate","permalink":"/docs/resources/election-workshop/workshop-nominate","draft":false,"unlisted":false,"editUrl":"https://github.com/kda-community/kadena-docs-new/blob/master/docs/resources/election-workshop/7-nominate-candidates.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"title":"Nominate candidates","description":"Work with database schemas and tables in your Pact module to manage candidates for the election application smart contract backend.","id":"workshop-nominate","sidebar_position":8}}');var d=t(74848),i=t(28453);const c={title:"Nominate candidates",description:"Work with database schemas and tables in your Pact module to manage candidates for the election application smart contract backend.",id:"workshop-nominate",sidebar_position:8},s="Nominate candidates",o={},l=[{value:"Before you begin",id:"before-you-begin",level:2},{value:"Define the database schema and table",id:"define-the-database-schema-and-table",level:2},{value:"Test table creation",id:"test-table-creation",level:2},{value:"Update the list-candidates function",id:"update-the-list-candidates-function",level:2},{value:"Add candidates",id:"add-candidates",level:2},{value:"Guard add-candidate with a capability",id:"guard-add-candidate-with-a-capability",level:2},{value:"Deploy the election module",id:"deploy-the-election-module",level:2},{value:"Add a candidate",id:"add-a-candidate",level:2},{value:"Connect the frontend",id:"connect-the-frontend",level:2},{value:"Next steps",id:"next-steps",level:2}];function r(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"nominate-candidates",children:"Nominate candidates"})}),"\n",(0,d.jsxs)(n.p,{children:["In ",(0,d.jsx)(n.a,{href:"/resources/election-workshop/workshop-write",children:"Write a smart contract"}),", you learned about defining Pact modules and created a skeleton ",(0,d.jsx)(n.code,{children:"election"})," module for the smart contract that will become the backend of the election application.\nIn this tutorial, you'll update the ",(0,d.jsx)(n.code,{children:"election"})," module with a database table and functions to support the following operations:"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Store a list of candidates and the number of votes each candidate receives."}),"\n",(0,d.jsx)(n.li,{children:"Store a list of the accounts that have voted to ensure that every account can\nvote only once."}),"\n",(0,d.jsx)(n.li,{children:"Add nominated candidates to the candidate table."}),"\n",(0,d.jsx)(n.li,{children:"List all of the candidates that are stored in the table."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"before-you-begin",children:"Before you begin"}),"\n",(0,d.jsx)(n.p,{children:"Before you start this tutorial, verify the following basic requirements:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"You have an internet connection and a web browser installed on your local computer."}),"\n",(0,d.jsxs)(n.li,{children:["You have a code editor, such as ",(0,d.jsx)(n.a,{href:"https://code.visualstudio.com/download",children:"Visual Studio Code"}),", access to an interactive terminal shell, and are generally familiar with using command-line programs."]}),"\n",(0,d.jsxs)(n.li,{children:["You have cloned the ",(0,d.jsx)(n.a,{href:"https://github.com/kadena-community/voting-dapp.git",children:"voting-dapp"})," repository to create your project directory as described in ",(0,d.jsx)(n.a,{href:"/resources/election-workshop/workshop-prepare",children:"Prepare your workspace"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["You have the development network running in a Docker container as described in ",(0,d.jsx)(n.a,{href:"/resources/election-workshop/workshop-start",children:"Start a local blockchain"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["You are ",(0,d.jsx)(n.a,{href:"/resources/election-workshop/workshop-start#connect-to-the-development-network",children:"connected to the development network"})," using your local host IP address and port number 8080."]}),"\n",(0,d.jsxs)(n.li,{children:["You have created and funded an administrative account as described in ",(0,d.jsx)(n.a,{href:"/resources/election-workshop/workshop-admin",children:"Add an administrator account"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["You have created a principal namespace on the development network as described in ",(0,d.jsx)(n.a,{href:"/resources/election-workshop/workshop-namespace",children:"Define a namespace"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["You have defined the keyset that controls your namespace using the administrative account as described in ",(0,d.jsx)(n.a,{href:"/resources/election-workshop/workshop-keysets",children:"Define keysets"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["You have created a minimal election module using the Pact smart contract language as described in ",(0,d.jsx)(n.a,{href:"/resources/election-workshop/workshop-write",children:"Write a smart contract"}),"."]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"define-the-database-schema-and-table",children:"Define the database schema and table"}),"\n",(0,d.jsxs)(n.p,{children:["To prepare the ",(0,d.jsx)(n.code,{children:"election"})," module database, you must first define a ",(0,d.jsx)(n.strong,{children:"schema"})," for the table.\nYou can then define a table that uses the schema inside the ",(0,d.jsx)(n.code,{children:"election"})," module.\nThe actual creation of the table happens outside the Pact module declaration, as you saw with defining and entering a namespace."]}),"\n",(0,d.jsx)(n.p,{children:"To define the database schema and table:"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Open the ",(0,d.jsx)(n.code,{children:"election-workshop/pact/election.pact"})," file in the code editor on your computer."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Add the schema for the database table inside of the ",(0,d.jsx)(n.code,{children:"election"})," module declaration with the following lines of code:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'  (defschema candidates-schema\n    "Candidates table schema"\n    name:string\n    votes:integer)\n\n  (deftable candidates:{candidates-schema})\n'})}),"\n",(0,d.jsxs)(n.p,{children:["In this code, ",(0,d.jsx)(n.code,{children:"defschema"})," defines a ",(0,d.jsx)(n.code,{children:"candidate-schema"})," for a database table named ",(0,d.jsx)(n.code,{children:"candidates"})," with two columns:"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"name"})," of type string"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"votes"})," of type integer"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Create the table outside of the election module by adding the following lines of code at the end of the ",(0,d.jsx)(n.code,{children:"./pact/election.pact"})," file, after the closing parenthesis (",(0,d.jsx)(n.code,{children:")"}),") of the ",(0,d.jsx)(n.code,{children:"election"})," module declaration:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'(if (read-msg "init-candidates")\n  [(create-table candidates)]\n  []\n)\n'})}),"\n",(0,d.jsxs)(n.p,{children:["With this code, the ",(0,d.jsx)(n.code,{children:"read-msg"})," function reads the ",(0,d.jsx)(n.code,{children:"init-candidates"})," field from the transaction data.\nIf you set this field to ",(0,d.jsx)(n.code,{children:"true"})," in the data for your module deployment transaction, the statement between the first square brackets\u2014",(0,d.jsx)(n.code,{children:"(create-table candidates)"}),"\u2014is executed to create the ",(0,d.jsx)(n.code,{children:"candidates"})," table based on its schema definition inside the ",(0,d.jsx)(n.code,{children:"election"})," module."]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"test-table-creation",children:"Test table creation"}),"\n",(0,d.jsx)(n.p,{children:"Before trying to create the table on your local development network, you can verify that your changes work as expected by running some tests in the Pact REPL."}),"\n",(0,d.jsx)(n.p,{children:"To test table creation:"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Open the ",(0,d.jsx)(n.code,{children:"election-workshop/pact"})," folder in the code editor."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Create a new file named ",(0,d.jsx)(n.code,{children:"election.repl"})," in the ",(0,d.jsx)(n.code,{children:"pact"})," folder."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Set the ",(0,d.jsx)(n.code,{children:"env-data"})," and ",(0,d.jsx)(n.code,{children:"env-sigs"})," fields for the REPL test environment to use the public key for your administrative account."]}),"\n",(0,d.jsx)(n.p,{children:"For example:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'(env-data\n  { "election-admin":\n      { "keys" : [ "d0aa32802596b8e31f7e35d1f4995524f11ed9c7683450b561e01fb3a36c18ae" ]\n      , "pred" : "keys-all"\n      }\n  , "init-candidates": true\n  }\n)\n\n(env-sigs\n  [{ "key"  : "d0aa32802596b8e31f7e35d1f4995524f11ed9c7683450b561e01fb3a36c18ae"\n   , "caps" : []\n  }]\n)\n'})}),"\n",(0,d.jsxs)(n.p,{children:["Also, notice that ",(0,d.jsx)(n.code,{children:"init-candidates: true"})," is included in the environment data to ensure that the ",(0,d.jsx)(n.code,{children:"(create-table candidates)"})," command is executed when you load the ",(0,d.jsx)(n.code,{children:"election"})," module into the Pact REPL."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Define your principal namespace and the ",(0,d.jsx)(n.code,{children:"admin-keyset"})," for the namespace using the principal namespace you used in your ",(0,d.jsx)(n.code,{children:"election.pact"})," file."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'(begin-tx "Define the principal namespace")\n  (define-namespace "n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80" (read-keyset "election-admin" ) (read-keyset "election-admin" ))\n(commit-tx)\n\n(begin-tx "Define the election-admin keyset in the namespace")\n  (namespace "n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80")\n  (define-keyset "n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election-admin" (read-keyset "election-admin" ))\n(commit-tx)\n'})}),"\n",(0,d.jsxs)(n.p,{children:["These transactions are required because, inside of the ",(0,d.jsx)(n.code,{children:"election.pact"})," file, the ",(0,d.jsx)(n.code,{children:"election"})," module is defined in your principal namespace and it is governed by the ",(0,d.jsx)(n.code,{children:"election-admin"})," in that namespace."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Add a transaction to load the election module:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'(begin-tx "Load election module")\n  (load "election.pact")\n(commit-tx)\n'})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Execute the code in the ",(0,d.jsx)(n.code,{children:"election.repl"})," file using the Pact command-line interpreter and the ",(0,d.jsx)(n.code,{children:"--trace"})," command-line option."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"pact election.repl --trace\n"})}),"\n",(0,d.jsx)(n.p,{children:"You should see that the transaction succeeds with output similar to the following:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'...\nelection.repl:0:0-7:1:Trace: "Setting transaction data"\nelection.repl:9:0-13:1:Trace: "Setting transaction signatures/caps"\nelection.repl:15:0-15:43:Trace: "Begin Tx 0 Define the principal namespace"\nelection.repl:16:2-16:129:Trace: "Namespace defined: n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80"\nelection.repl:17:0-17:11:Trace: "Commit Tx 0 Define the principal namespace"\nelection.repl:19:0-19:62:Trace: "Begin Tx 1 Define the election-admin keyset in the namespace"\nelection.repl:20:2-20:58:Trace: "Namespace set to n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80"\nelection.repl:21:2-21:109:Trace: "Keyset write success"\nelection.repl:22:0-22:11:Trace: "Commit Tx 1 Define the election-admin keyset in the namespace"\nelection.repl:24:0-24:33:Trace: "Begin Tx 2 Load election module"\nelection.repl:25:2-25:24:Trace: "Loading election.pact..."\nelection.pact:0:0-0:56:Trace: "Namespace set to n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80"\nelection.pact:3:0-16:1:Trace: Loaded module n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election, hash _zJBtnrLTTYsbTcnDk_qt13sJPfnlTTBJ13jz11x_Sc\nelection.pact:19:0-22:1:Trace: ["TableCreated"]\nelection.repl:26:0-26:11:Trace: "Commit Tx 2 Load election module"\nLoad successful\n'})}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"update-the-list-candidates-function",children:"Update the list-candidates function"}),"\n",(0,d.jsxs)(n.p,{children:["The current implementation of the ",(0,d.jsx)(n.code,{children:"list-candidates"})," function returns a simple list.\nAlthough it appears that the ",(0,d.jsx)(n.code,{children:"candidates"})," table has been created successfully, the table doesn't have any data to return.\nBefore you can test that the ",(0,d.jsx)(n.code,{children:"candidates"})," table works as expected, you must modify the code for the ",(0,d.jsx)(n.code,{children:"list-candidates"})," function."]}),"\n",(0,d.jsx)(n.p,{children:"To update the list-candidates function to read data from a table:"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Open the ",(0,d.jsx)(n.code,{children:"election-workshop/pact/election.pact"})," file in your code editor."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Update the return value of the ",(0,d.jsx)(n.code,{children:"list-candidates"})," function to select all of the rows of the ",(0,d.jsx)(n.code,{children:"candidates"})," table, including the key and the column values of each row."]}),"\n",(0,d.jsx)(n.p,{children:"For example:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'(defun list-candidates ()\n  (fold-db candidates\n    (lambda (key columnData) true)\n    (lambda (key columnData) (+ { "key": key } columnData))\n  ))\n'})}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"fold-db"})," function fetches the value of the ",(0,d.jsx)(n.code,{children:"key"})," column separately from the other column values."]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["The first argument for ",(0,d.jsx)(n.code,{children:"fold-db"})," is the table name."]}),"\n",(0,d.jsxs)(n.li,{children:["The second argument is a predicate function that determines which rows should be selected.\nTo fetch all rows from a table, you can simply return ",(0,d.jsx)(n.code,{children:"true"})," here."]}),"\n",(0,d.jsx)(n.li,{children:"The third argument is an accumulator function that allows you to map the data of each row to a different format."}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["This code example formats the return value of the ",(0,d.jsx)(n.code,{children:"fold-db"})," function as a JSON object with the following structure."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'[\n  { "key": "1", "name": "Candidate A", "votes": 0 },\n  { "key": "2", "name": "Candidate B", "votes": 0 }\n]\n'})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Open the ",(0,d.jsx)(n.code,{children:"election-workshop/pact/election.repl"})," file in the code editor."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Add a transaction to test the new implementation of the ",(0,d.jsx)(n.code,{children:"election.list-candidates"})," function:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'(begin-tx "List candidates")\n  (use n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election)\n  (expect\n    "There are no candidates in the candidates table"\n    []\n    (list-candidates)\n  )\n(commit-tx)\n'})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Execute the code in the ",(0,d.jsx)(n.code,{children:"election.repl"})," file using the Pact command-line interpreter and the ",(0,d.jsx)(n.code,{children:"--trace"})," command-line option."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"pact election.repl --trace\n"})}),"\n",(0,d.jsx)(n.p,{children:"Because there are no candidates in the table, you should see the transaction succeeds with output similar to the following:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'...\nelection.repl:28:0-28:28:Trace: "Begin Tx 3 List candidates"\nelection.repl:29:2-29:59:Trace: Loaded imports from n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election\nelection.repl:30:2-34:3:Trace: "Expect: success There are no candidates in the candidates table"\nelection.repl:35:0-35:11:Trace: "Commit Tx 3 List candidates"\nLoad successful\n'})}),"\n",(0,d.jsxs)(n.p,{children:["Note that you shouldn't include a call to a function like ",(0,d.jsx)(n.code,{children:"fold-db"})," in transactions sent to the blockchain.\nInstead, you can make a local request to select all rows from a table to save gas.\nYou'll learn more about making local requests later in this tutorial."]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"add-candidates",children:"Add candidates"}),"\n",(0,d.jsx)(n.p,{children:"At this point, you have a database table for storing candidate names and the votes they've received, but without any candidates for anyone to vote on."}),"\n",(0,d.jsx)(n.p,{children:"To add candidates to the database:"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Open the ",(0,d.jsx)(n.code,{children:"election-workshop/pact/election.pact"})," file in your code editor."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Define a new ",(0,d.jsx)(n.code,{children:"add-candidate"})," function inside the ",(0,d.jsx)(n.code,{children:"election"})," module declaration.\nYou'll use this function to insert candidate information from a JSON object into each row in the ",(0,d.jsx)(n.code,{children:"candidates"})," table.\nThe function uses the ",(0,d.jsx)(n.code,{children:"insert"})," built-in function to add each candidate to the table."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'(defun add-candidate (candidate:object)\n  (insert candidates\n    (at "key" candidate)\n    {\n      "name": (at "name" candidate),\n      "votes": 0\n    }\n  )\n)\n'})}),"\n",(0,d.jsxs)(n.p,{children:["In this code, you pass the following arguments to the ",(0,d.jsx)(n.code,{children:"insert"})," function:"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["The name of table you want to update.\nIn this case, the table is the ",(0,d.jsx)(n.code,{children:"candidates"})," table."]}),"\n",(0,d.jsxs)(n.li,{children:["The value for the key of the row to be inserted.\nIn this case, the value of the ",(0,d.jsx)(n.code,{children:"key"})," field is extracted from the ",(0,d.jsx)(n.code,{children:"candidate"})," object."]}),"\n",(0,d.jsxs)(n.li,{children:["The key-value object representing the row to be inserted into the table.\nThe object consists of a ",(0,d.jsx)(n.code,{children:"name"})," key and a ",(0,d.jsx)(n.code,{children:"votes"})," key that correspond to the columns in the schema for the ",(0,d.jsx)(n.code,{children:"candidates"})," table.\nIn this case, the ",(0,d.jsx)(n.code,{children:"votes"})," column of the new value always gets a value ",(0,d.jsx)(n.code,{children:"0"})," and the ",(0,d.jsx)(n.code,{children:"name"})," column gets the name you specify in the JSON object."]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["Now that you've added the ",(0,d.jsx)(n.code,{children:"add-candidate"})," function to the ",(0,d.jsx)(n.code,{children:"election"})," module, you can test it by adding tests to the ",(0,d.jsx)(n.code,{children:"election.repl"})," file."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Open the ",(0,d.jsx)(n.code,{children:"election-workshop/pact/election.repl"})," file in your code editor."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Add a transaction to test that candidates can be added to the database using the ",(0,d.jsx)(n.code,{children:"election.add-candidate"})," function:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'(begin-tx "Add candidates")\n  (use n_14912521e87a6d387157d526b281bde8422371d1.election)\n  (expect\n    "Add Candidate A"\n    "Write succeeded"\n    (add-candidate { "key": "1", "name": "Candidate A" })\n  )\n  (expect\n    "Add Candidate B"\n    "Write succeeded"\n    (add-candidate { "key": "2", "name": "Candidate B" })\n  )\n  (expect\n    "Add Candidate C"\n    "Write succeeded"\n    (add-candidate { "key": "3", "name": "Candidate C" })\n  )\n(commit-tx)\n'})}),"\n",(0,d.jsxs)(n.p,{children:["Notice that each candidate object has the fields ",(0,d.jsx)(n.code,{children:"key"})," and ",(0,d.jsx)(n.code,{children:"name"}),", while the ",(0,d.jsx)(n.code,{children:"candidate-schema"})," you defined for the ",(0,d.jsx)(n.code,{children:"candidates"})," table has columns for ",(0,d.jsx)(n.code,{children:"name"})," and ",(0,d.jsx)(n.code,{children:"votes"}),".\nBecause the ",(0,d.jsx)(n.code,{children:"add-candidate"})," function sets the ",(0,d.jsx)(n.code,{children:"votes"})," column to have an initial value of ",(0,d.jsx)(n.code,{children:"0"})," when a new candidate is added, you don't need to send a value for votes in the transaction."]}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"key"})," value is a unique index for the table row that is added.\nThis value can't be automatically generated, so you have to pass a value yourself."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Execute the code in the ",(0,d.jsx)(n.code,{children:"election.repl"})," file using the Pact command-line interpreter and the ",(0,d.jsx)(n.code,{children:"--trace"})," command-line option."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"pact election.repl --trace\n"})}),"\n",(0,d.jsx)(n.p,{children:"You should see that the transaction succeeds with output similar to the following:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'...\nelection.repl:37:0-37:27:Trace: "Begin Tx 4 Add candidates"\nelection.repl:38:5-38:62:Trace: Loaded imports from n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election\nelection.repl:39:5-43:6:Trace: "Expect: success Add Candidate A"\nelection.repl:44:5-48:6:Trace: "Expect: success Add Candidate B"\nelection.repl:49:5-53:6:Trace: "Expect: success Add Candidate C"\nelection.repl:54:0-54:11:Trace: "Commit Tx 4 Add candidates"\nLoad successful\n'})}),"\n",(0,d.jsxs)(n.p,{children:["You can add a transaction to call the ",(0,d.jsx)(n.code,{children:"list-candidates"})," function after adding candidates to the database in the ",(0,d.jsx)(n.code,{children:"election.repl"})," file like this:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'(begin-tx "List candidates")\n  (use n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election)\n    (list-candidates)\n(commit-tx)\n'})}),"\n",(0,d.jsxs)(n.p,{children:["Now that there's data in the table, the ",(0,d.jsx)(n.code,{children:"list-candidates"})," function returns the rows from the table:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'...\nelection.repl:57:2-57:59:Trace: Loaded imports from n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election\nelection.repl:58:4-58:21:Trace: [{"key": "1","name": "Candidate A","votes": 0} {"key": "2","name": "Candidate B","votes": 0} {"key": "3","name": "Candidate C","votes": 0}]\nelection.repl:59:0-59:11:Trace: "Commit Tx 5 List candidates"\nLoad successful\n'})}),"\n",(0,d.jsx)(n.p,{children:"Because the key for each row in a table must be unique, you should test that you can't insert a row with a duplicate\nkey."}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Add a transaction to the ",(0,d.jsx)(n.code,{children:"election.repl"})," file to test that you can't insert a row with a duplicate key:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'(begin-tx "Add candidate with existing key fails")\n  (use n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election)\n  (expect-failure\n    "Database exception: Insert: row found for key 1"\n    (add-candidate { "key": "1", "name": "Candidate D" })\n  )\n(commit-tx)\n'})}),"\n",(0,d.jsx)(n.p,{children:"If you were to execute this transaction, it would fail\u2014as expected\u2014with output similar to the following:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'...\nelection.repl:61:0-61:50:Trace: "Begin Tx 6 Add candidate with existing key fails"\nelection.repl:62:0-62:57:Trace: Loaded imports from n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election\nelection.repl:63:0-66:1:Trace: "Expect failure: Success: Database exception: Insert: row found for key 1"\nelection.repl:67:0-67:11:Trace: "Commit Tx 6 Add candidate with existing key fails"\nLoad successful\n'})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Verify that you only have three candidates in the table by adding the following assertion to the ",(0,d.jsx)(n.code,{children:"election-workshop/pact/election.repl"})," file:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'(begin-tx "List candidates")\n  (use n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election)\n  (expect\n    "There should be three candidates"\n    3\n    (length (list-candidates))\n  )\n(commit-tx)\n'})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Execute the code in the ",(0,d.jsx)(n.code,{children:"election.repl"})," file using the Pact command-line interpreter and the ",(0,d.jsx)(n.code,{children:"--trace"})," command-line option."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"pact election.repl --trace\n"})}),"\n",(0,d.jsx)(n.p,{children:"You should see that the transaction succeeds with output similar to the following:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"...\nelection.repl:64:0:Trace: Begin Tx 6: List candidates\nelection.repl:65:2:Trace: Using n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election\nelection.repl:66:2:Trace: Expect: success: There should be three candidates\nelection.repl:71:0:Trace: Commit Tx 6: List candidates\nLoad successful\n"})}),"\n",(0,d.jsxs)(n.p,{children:["You've now seen how candidates can be stored in a database table and that the ",(0,d.jsx)(n.code,{children:"list-candidates"})," function works as expected to retrieve information from that table.\nThe next step is to restrict access to the ",(0,d.jsx)(n.code,{children:"add-candidate"})," function, so that ony the ",(0,d.jsx)(n.code,{children:"election"})," module owner can update the ",(0,d.jsx)(n.code,{children:"candidates"})," database."]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"guard-add-candidate-with-a-capability",children:"Guard add-candidate with a capability"}),"\n",(0,d.jsxs)(n.p,{children:["At this point, the ",(0,d.jsx)(n.code,{children:"add-candidate"})," function is a public function that anyone can use to nominate candidates.\nTo prevent that kind of election chaos, you need a gatekeeper\u2014a guard\u2014that restricts access to the nominating process and the number of candidates or proposals to be voted on."]}),"\n",(0,d.jsxs)(n.p,{children:["For the election application, this gatekeeper or ",(0,d.jsx)(n.strong,{children:"guard"})," is the holder of the ",(0,d.jsx)(n.code,{children:"election-admin"})," administrative account.\nTo restrict access to the ",(0,d.jsx)(n.code,{children:"add-candidate"})," function, you can define a new ",(0,d.jsx)(n.code,{children:"ELECTION-ADMIN"})," capability.\nWith this capability, you can enforce that the ",(0,d.jsx)(n.code,{children:"election-admin"})," must sign transactions that call specific functions. For the ",(0,d.jsx)(n.code,{children:"election"})," module, you'll use the ",(0,d.jsx)(n.code,{children:"ELECTION-ADMIN"})," capability to protect access to the ",(0,d.jsx)(n.code,{children:"add-candidate"})," function."]}),"\n",(0,d.jsxs)(n.p,{children:["To guard access to the ",(0,d.jsx)(n.code,{children:"add-candidate"})," function:"]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Open the ",(0,d.jsx)(n.code,{children:"election-workshop/pact/election.pact"})," file in your code editor."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Define a new ELECTION-ADMIN capability that enforces the use of the ",(0,d.jsx)(n.code,{children:"election-admin"})," administrative account."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'(defcap ELECTION-ADMIN () \n  (enforce-guard (keyset-ref-guard "n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election-admin")))\n'})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Update the ",(0,d.jsx)(n.code,{children:"add-candidate"})," function to check whether the ",(0,d.jsx)(n.code,{children:"ELECTION-ADMIN"})," capability is granted:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'(defun add-candidate (candidate:object)\n  (with-capability (ELECTION-ADMIN)\n    (insert candidates\n      (at "key" candidate)\n      {\n        "name": (at "name" candidate),\n        "votes": 0\n      }\n    )\n  )\n)\n'})}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"with-capability"})," function ensures that the ",(0,d.jsx)(n.code,{children:"ELECTION-ADMIN"})," capability is in scope for the code block\u2014the capability body\u2014that inserts a ",(0,d.jsx)(n.code,{children:"candidate"})," object into the ",(0,d.jsx)(n.code,{children:"candidates"})," table.\nIf the ",(0,d.jsx)(n.code,{children:"ELECTION-ADMIN"})," capability can't be granted, because of a keyset failure in this case, the code block wrapped by the ",(0,d.jsx)(n.code,{children:"with-capability"})," function isn't executed."]}),"\n",(0,d.jsxs)(n.p,{children:["After making these changes in the ",(0,d.jsx)(n.code,{children:"election.pact"})," file, you should add tests to verify the code works as you expect it to."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Open the ",(0,d.jsx)(n.code,{children:"election-workshop/pact/election.repl"})," file in the code editor."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Set the environment data and signature to use a different key, then add a transaction that you expect to fail for adding a fourth candidate."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'(env-data\n  { "admin-keyset" :\n    { "keys" : [ "other-key" ]\n    , "pred" : "keys-all"\n    }\n  }\n)\n\n(env-sigs\n  [{ "key"  : "other-key"\n   , "caps" : []\n  }]\n)\n\n(begin-tx "Add candidate without permission fails")\n  (use n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election)\n  (expect-failure\n    "Adding a candidate with the wrong keyset should fail"\n    "Keyset failure (keys-all)"\n    (add-candidate { "key": "4", "name": "Candidate D" })\n  )\n(commit-tx)\n'})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Execute the code in the ",(0,d.jsx)(n.code,{children:"election.repl"})," file using the Pact command-line interpreter and the ",(0,d.jsx)(n.code,{children:"--trace"})," command-line option."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"pact election.repl --trace\n"})}),"\n",(0,d.jsxs)(n.p,{children:["You should see that the using the ",(0,d.jsx)(n.code,{children:"add-candidate"})," function is a guarded operation that fails when the wrong keyset is used with output similar to the following:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'...\nelection.repl:77:3-83:3:Trace: "Setting transaction data"\nelection.repl:85:2-89:3:Trace: "Setting transaction signatures/caps"\nelection.repl:91:2-91:53:Trace: "Begin Tx 8 Add candidate without permission fails"\nelection.repl:92:4-92:61:Trace: Loaded imports from n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election\nelection.repl:93:4-97:5:Trace: "Expect failure: Success: Adding a candidate with the wrong keyset should fail"\nelection.repl:98:2-98:13:Trace: "Commit Tx 8 Add candidate without permission fails"\nLoad successful\n'})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Clear the environment data and signature and add another transaction to try to call the ",(0,d.jsx)(n.code,{children:"add-candidate"})," function."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'(env-data {})\n(env-sigs [])\n(begin-tx "Add candidate without permission fails")\n  (use n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election)\n  (add-candidate { "key": "4", "name": "Candidate D" })\n(commit-tx)\n'})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Execute the code in the ",(0,d.jsx)(n.code,{children:"election.repl"})," file using the Pact command-line interpreter and the ",(0,d.jsx)(n.code,{children:"--trace"})," command-line option."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"pact election.repl --trace\n"})}),"\n",(0,d.jsxs)(n.p,{children:["You should see that calling the ",(0,d.jsx)(n.code,{children:"add-candidate"})," function fails with output similar to the following:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'...\nelection.repl:103:2-103:59:Trace: Loaded imports from n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election\nelection.pact:11:5: Keyset failure (keys-all): [d0aa3280...]\n 11 |      (enforce-guard (keyset-ref-guard "n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election-admin")))\n    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  at(n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election.ELECTION-ADMIN.{Cp4zNjFLxwm66mq6BWMpo4z1seYIjWyOfsPXXUNkcxE}):election-07-wip.pact:26:5-34:6\n  at(n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election.add-candidate.{Cp4zNjFLxwm66mq6BWMpo4z1seYIjWyOfsPXXUNkcxE} {"key": "4","...}):election.repl:104:2-104:55\n'})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Remove the changes to the environment data and signatures and the last two transactions, then execute the code in the ",(0,d.jsx)(n.code,{children:"election.repl"})," file to verify that the file loads successfully using the ",(0,d.jsx)(n.code,{children:"election-admin"})," keyset guard."]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"deploy-the-election-module",children:"Deploy the election module"}),"\n",(0,d.jsxs)(n.p,{children:["Now that you've updated and tested your ",(0,d.jsx)(n.code,{children:"election"})," module using the Pact REPL, you can update the module deployed on the local development network."]}),"\n",(0,d.jsxs)(n.p,{children:["To update the ",(0,d.jsx)(n.code,{children:"election"})," module on the development network:"]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Verify the development network is currently running on your local computer."}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Open the ",(0,d.jsx)(n.code,{children:"election-module-devnet.ktpl"})," file, add the ",(0,d.jsx)(n.code,{children:'"init-candidates": true'})," property to the transaction data, and save the file."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:'data:\n  election-admin:\n    keys: ["{{public-key}}"]\n    pred: "keys-all"\n  "init-candidates": true\n'})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Create a transaction that uses the ",(0,d.jsx)(n.code,{children:"election-module-devnet.ktpl"})," template by running the ",(0,d.jsx)(n.code,{children:"kadena tx add"})," command and following the prompts displayed."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Sign the transaction by running the ",(0,d.jsx)(n.code,{children:"kadena tx sign"})," command and following the prompts displayed."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Send the signed transaction to the blockchain by running the ",(0,d.jsx)(n.code,{children:"kadena tx send"})," command and following the prompts displayed."]}),"\n",(0,d.jsx)(n.p,{children:"You can verify the transaction results using the request key for the transaction."}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{alt:"Election module deployed on the development chain",src:t(15275).A+"",width:"2074",height:"1708"})}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"add-a-candidate",children:"Add a candidate"}),"\n",(0,d.jsxs)(n.p,{children:["After you deploy the module on the local development network, you can use your administrative account to add, sign, and send transactions that add candidates to the ",(0,d.jsx)(n.code,{children:"candidates"})," table."]}),"\n",(0,d.jsxs)(n.p,{children:["To add a candidate to the ",(0,d.jsx)(n.code,{children:"election"})," module you have deployed on the development network:"]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Create a new reusable transaction template named ",(0,d.jsx)(n.code,{children:"add-election-candidate.ktpl"})," in the ",(0,d.jsx)(n.code,{children:"~/.kadena/transaction-templates"})," folder."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Open the ",(0,d.jsx)(n.code,{children:"add-election-candidate.ktpl"})," file and create a YAML transaction request similar to the following."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'code: |-\n   (n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election.add-candidate  { "key": "1", "name": "Maya Garcia" })\ndata:\n   election-admin:\n     keys: ["{{public-key}}"]\n     pred: "keys-all"\nmeta:\n   chainId: "{{chain-id}}"\n   sender: "{{{sender-account}}}"\n   gasLimit: 80300\n   gasPrice: 0.000001\n   ttl: 600\nsigners:\n   - public: "{{public-key}}"\n     caps: []\nnetworkId: "{{network-id}}"\n'})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Create a transaction that uses the ",(0,d.jsx)(n.code,{children:"add-election-candidate.ktpl"})," template by running the ",(0,d.jsx)(n.code,{children:"kadena tx add"})," command and following the prompts displayed."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Sign the transaction by running the ",(0,d.jsx)(n.code,{children:"kadena tx sign"})," command and following the prompts displayed."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Send the signed transaction to the blockchain by running the ",(0,d.jsx)(n.code,{children:"kadena tx send"})," command and following the prompts displayed."]}),"\n",(0,d.jsx)(n.p,{children:"You can verify the transaction results using the request key for the transaction."}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{alt:"Candidate added to the blockchain successfully",src:t(5444).A+"",width:"1746",height:"494"})}),"\n",(0,d.jsxs)(n.p,{children:["You can reuse the ",(0,d.jsx)(n.code,{children:"add-election-candidate.ktpl"})," template to add more candidates to the candidates table by updating the code to specify a new index key and candidate name or proposal title.\nFor example:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'code: |-\n(n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election.add-candidate  { "key": "2", "name": "Tai Xi" })\n'})}),"\n",(0,d.jsx)(n.p,{children:"You could also use this template to add proposals instead of the candidates to election by providing a new unique index key and a proposal title.\nFor example:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-pact",children:'code: |-\n(n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election.add-candidate  { "key": "2a", "name": "Approve the budget for the new library." })\n'})}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"connect-the-frontend",children:"Connect the frontend"}),"\n",(0,d.jsx)(n.p,{children:"You now have the election backend defined in a Pact module running on the development network.\nTo make the functions in the module available to the election application website, you need to modify the frontend to exchange data with the development network."}),"\n",(0,d.jsxs)(n.p,{children:["The frontend, written in TypeScript, uses repositories to exchange data with the backend.\nThe interfaces for these repositories are defined in the ",(0,d.jsx)(n.code,{children:"frontend/src/types.ts"})," file.\nBy default, the frontend uses the in-memory implementations of the repositories.\nBy making changes to the implementation of the ",(0,d.jsx)(n.code,{children:"interface ICandidateRepository"})," in ",(0,d.jsx)(n.code,{children:"frontend/src/repositories/candidate/DevnetCandidateRepository.ts"}),", you can configure the frontend to use the ",(0,d.jsx)(n.code,{children:"devnet"})," backend instead of the ",(0,d.jsx)(n.code,{children:"in-memory"})," backend.\nAfter making these changes, you can use the frontend to view candidates from the ",(0,d.jsx)(n.code,{children:"candidates"})," table that are managed by your ",(0,d.jsx)(n.code,{children:"election"})," module running on the development network blockchain."]}),"\n",(0,d.jsx)(n.p,{children:"To modify the frontend to list candidates from the development network:"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Open ",(0,d.jsx)(n.code,{children:"election-workshop/frontend/src/repositories/candidate/DevnetCandidateRepository.ts"})," in your code editor."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Update the values for the ",(0,d.jsx)(n.code,{children:"CHAIN_ID"})," and ",(0,d.jsx)(n.code,{children:"NAMESPACE"})," constants with the chain where you deployed the ",(0,d.jsx)(n.code,{children:"election"})," module and your own principal namespace."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",children:"const NETWORK_ID = 'development';\nconst CHAIN_ID = '3';\nconst API_HOST = `http://localhost:8080/chainweb/0.0/${NETWORK_ID}/chain/${CHAIN_ID}/pact`;\nconst NAMESPACE = 'n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80';\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Remove the ",(0,d.jsx)(n.code,{children:"@ts-ignore"})," comment from the ",(0,d.jsx)(n.code,{children:"listCandidates"})," function:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",children:"const listCandidates = async (): Promise<ICandidate[]> => {\n  const transaction = Pact.builder\n    // @ts-ignore\n    .execution(Pact.modules[`${NAMESPACE}.election`]['list-candidates']())\n    .setMeta({\n      chainId: CHAIN_ID,\n      gasLimit: 100000,\n    })\n    .setNetworkId(NETWORK_ID)\n    .createTransaction();\n\n  const { result } = await client.dirtyRead(transaction);\n\n  return result.status === 'success'\n    ? (result.data.valueOf() as ICandidate[])\n    : [];\n};\n"})}),"\n",(0,d.jsxs)(n.p,{children:["This function uses the Kadena client (",(0,d.jsx)(n.code,{children:"@kadena/client"}),") library to connect to the development network and read data from the blockchain.\nAfter you remove the ",(0,d.jsx)(n.code,{children:"@ts-ignore"})," comment, you should notice that the code editor highlights a problem with your module because it isn't defined in the ",(0,d.jsx)(n.code,{children:"IPactModules"})," interface.\nTo fix this problem, you must generate types for the ",(0,d.jsx)(n.code,{children:"election"})," module so they can be used when called by Kadena client library functions."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Open a terminal in your code editor, change to the ",(0,d.jsx)(n.code,{children:"election-workshop/frontend"})," directory, then generate types for the ",(0,d.jsx)(n.code,{children:"election"})," module by running the following command:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"npm run pactjs:generate:contract:election\n"})}),"\n",(0,d.jsxs)(n.p,{children:["This command uses the ",(0,d.jsx)(n.code,{children:"pactjs"})," library to generate TypeScript definitions for the ",(0,d.jsx)(n.code,{children:"election"})," module and should clear the error reported by the code editor.\nDepending on the code editor, you might need to close the project in the editor and reopen it to reload the code editor window with the change."]}),"\n",(0,d.jsxs)(n.p,{children:["After you clear the error, note that the ",(0,d.jsx)(n.code,{children:"listCandidates"})," function:"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Sets the chain identifier, gas limit, and network identifier before creating the transaction."}),"\n",(0,d.jsxs)(n.li,{children:["Creates a ",(0,d.jsx)(n.code,{children:"client"})," connection to the blockchain."]}),"\n",(0,d.jsxs)(n.li,{children:["Uses the ",(0,d.jsx)(n.code,{children:"dirtyRead"})," method from the ",(0,d.jsx)(n.code,{children:"@kadena/client"})," library to return a raw response for the transaction result without sending a transaction to the blockchain."]}),"\n",(0,d.jsx)(n.li,{children:"Processes the response from the development network and returns a list of candidates or an empty list."}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["In the terminal where the ",(0,d.jsx)(n.code,{children:"election-workshop/frontend"})," directory is your current working directory, install the frontend dependencies by running the following command:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"npm install\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Start the frontend application configured to use the ",(0,d.jsx)(n.code,{children:"devnet"})," backend by running the following command:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"npm run start-devnet\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Open ",(0,d.jsx)(n.code,{children:"http://localhost:5173"})," in your browser and verify that the website loads without errors."]}),"\n",(0,d.jsxs)(n.p,{children:["You'll notice that\u2014unlike the frontend configured to use the in-memory backend\u2014only the candidate you added after deploying the module on the development network is displayed.\nWith the development network backend, candidates must be added to the ",(0,d.jsx)(n.code,{children:"candidates"})," table before they can be displayed."]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,d.jsx)(n.p,{children:"In this tutorial, you learned how to:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Define a simple database schema and database table to store candidates."}),"\n",(0,d.jsxs)(n.li,{children:["Define functions for listing and adding candidates to the ",(0,d.jsx)(n.code,{children:"candidates"})," table."]}),"\n",(0,d.jsxs)(n.li,{children:["Deploy the ",(0,d.jsx)(n.code,{children:"election"})," module on the development network running locally."]}),"\n",(0,d.jsxs)(n.li,{children:["Connect the frontend of the election website to use the ",(0,d.jsx)(n.code,{children:"election"})," module deployed on the development network as a backend."]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["In the next tutorial, you'll upgrade the ",(0,d.jsx)(n.code,{children:"election"})," module to enable people to cast a vote on a candidate with their Kadena account."]}),"\n",(0,d.jsxs)(n.p,{children:["To see the code for the activity you completed in this tutorial and get the starter code for the next tutorial, check out the ",(0,d.jsx)(n.code,{children:"08-voting"})," branch from the ",(0,d.jsx)(n.code,{children:"election-workshop"})," repository by running the following command in your terminal\nshell:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"git checkout 08-voting\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(r,{...e})}):r(e)}},5444:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/add-candidate-7b49cfb20d7464cb5852d4132425cf15.png"},15275:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/deploy-module-177f314b4c70532b888a7e6425367ebb.png"},28453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>s});var a=t(96540);const d={},i=a.createContext(d);function c(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:c(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);