"use strict";(self.webpackChunkkadena_docs=self.webpackChunkkadena_docs||[]).push([[4890],{61567:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"reference/marmalade/policy-manager","title":"Policy manager","description":"Functions and capabilities defined in the Marmalade policy manager contract enforce the policies you select for tokens and token-related operations.","source":"@site/docs/reference/marmalade/policy-manager.md","sourceDirName":"reference/marmalade","slug":"/reference/marmalade/policy-manager","permalink":"/docs/reference/marmalade/policy-manager","draft":false,"unlisted":false,"editUrl":"https://github.com/kda-community/kadena-docs-new/blob/master/docs/reference/marmalade/policy-manager.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Policy manager","description":"Functions and capabilities defined in the Marmalade policy manager contract enforce the policies you select for tokens and token-related operations.","id":"policy-manager","sidebar_position":2}}');var c=i(74848),s=i(28453);const t={title:"Policy manager",description:"Functions and capabilities defined in the Marmalade policy manager contract enforce the policies you select for tokens and token-related operations.",id:"policy-manager",sidebar_position:2},l="Policy manager contract",o={},a=[{value:"Tables and schemas",id:"tables-and-schemas",level:2},{value:"Capabilities",id:"capabilities",level:2},{value:"Functions",id:"functions",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"policy-manager-contract",children:"Policy manager contract"})}),"\n",(0,c.jsxs)(n.p,{children:["As discussed in ",(0,c.jsx)(n.a,{href:"/reference/marmalade/token-standard-architecture",children:"Token standard architecture"}),", the policy manager provides a standard for collecting and distributing fungibles and ensures that all of the policies applied to tokens are enforced.\nThe policy manager provides the following key features:"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"The ability to customize and manage token behavior and attributes by enforcing built-in and custom policies."}),"\n",(0,c.jsx)(n.li,{children:"Consistent and predictable policy enforcement."}),"\n",(0,c.jsx)(n.li,{children:"The ability to stack multiple policies to craft the exact behavior requirement for every token."}),"\n",(0,c.jsxs)(n.li,{children:["A standardized interface for all policies through\n",(0,c.jsx)(n.a,{href:"https://github.com/kadena-io/marmalade/blob/main/pact/kip/token-policy-v2.pact",children:(0,c.jsx)(n.code,{children:"kip.token-policy-v2"})}),"."]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["Source code: ",(0,c.jsx)(n.a,{href:"https://github.com/kadena-io/marmalade/blob/main/pact/policy-manager/policy-manager.pact",children:"policy-manager.pact"})]}),"\n",(0,c.jsx)(n.h2,{id:"tables-and-schemas",children:"Tables and schemas"}),"\n",(0,c.jsx)(n.p,{children:"The policy manager contract defines the following tables and schemas:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Ledgers table"}),": Ensures functions are initiated only from the ledger."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Concrete policies table"}),": Maintains concrete policy information for each\ntoken."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Sale whitelist table"}),": Lists valid whitelisted sale contracts."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Quotes table"}),": Archives quotes for quoted sales."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Ledger schema"}),": Contains the module reference governed by the policy\nmanager, adhering strictly to the ledger-v1 interface."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Concrete policies schema"}),": Includes the module reference, strictly using\nthe token-policy-v2 interface."]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"capabilities",children:"Capabilities"}),"\n",(0,c.jsx)(n.p,{children:"The policy manager supports a comprehensive set of capabilities to cover a wide\narray of functionalities:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"GOVERNANCE"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"QUOTE @event"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"ESCROW"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"INIT-CALL"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"TRANSFER-CALL"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"MINT-CALL"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"BURN-CALL"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"OFFER-CALL"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"WITHDRAW-CALL"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"BUY-CALL"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"SALE-GUARD-CALL"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"FUNGIBLE-TRANSFER-CALL"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"UPDATE-QUOTE-PRICE @event"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"SALE-WHITELIST @event"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"CONCRETE-POLICY @event"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"OFFER"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"BUY"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"WITHDRAW"})}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"functions",children:"Functions"}),"\n",(0,c.jsxs)(n.p,{children:["As a general rule, all of the ",(0,c.jsx)(n.code,{children:"enforce-**"})," functions require the ",(0,c.jsx)(n.code,{children:"ledger::**-CALL"}),"\ncapability to be in scope to ensure that functions are initiated from the ledger.\nThe ",(0,c.jsx)(n.code,{children:"enforce-**"})," functions then extract the policy list from the token input, which lists\nthe associated policies."]}),"\n",(0,c.jsx)(n.p,{children:"The policy manager defines the following functions:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"enforce-init"}),": Initiates ",(0,c.jsx)(n.code,{children:"policies::enforce-init"})," at ",(0,c.jsx)(n.code,{children:"marmalade-v2.ledger.create-token"}),"."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"enforce-mint"}),": Executes ",(0,c.jsx)(n.code,{children:"policies::enforce-mint"})," at ",(0,c.jsx)(n.code,{children:"marmalade-v2.ledger.mint"}),"."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"enforce-burn"}),": Activates ",(0,c.jsx)(n.code,{children:"policies::enforce-burn"})," at ",(0,c.jsx)(n.code,{children:"marmalade-v2.ledger.burn"}),"."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"enforce-offer"}),": Runs ",(0,c.jsx)(n.code,{children:"policies::enforce-offer"})," at ",(0,c.jsx)(n.code,{children:"marmalade-v2.ledger.offer"})," (step 0 of ",(0,c.jsx)(n.code,{children:"marmalade-v2.ledger.sale"}),").\nHere, an optional ",(0,c.jsx)(n.code,{children:"quote"})," parameter can be accessed in the ",(0,c.jsx)(n.code,{children:"env-data"})," field.\nIf a quote is identified, the offer saves this quote, and escrow accounts are generated.\nOtherwise, the offer continues without quotes."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"enforce-withdraw"}),": Operates ",(0,c.jsx)(n.code,{children:"policies::enforce-withdraw"})," at ",(0,c.jsx)(n.code,{children:"marmalade-v2.ledger.withdraw"})," (step 1 rollback of ",(0,c.jsx)(n.code,{children:"marmalade-v2.ledger.sale"}),")."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"enforce-buy"}),": Engages ",(0,c.jsx)(n.code,{children:"policies::enforce-buy"})," at ",(0,c.jsx)(n.code,{children:"marmalade-v2.ledger.buy"})," (step 1 of ",(0,c.jsx)(n.code,{children:"marmalade-v2.ledger.sale"}),")."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"write-concrete-policy"}),": This function registers a concrete policy modref into the concrete policies table."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"get-escrow-account"}),": Returns the fungible escrow account created for quoted sales at enforce-offer.\nThe escrow account receives the fungible from the buyer and distributes the fungibles to the policies and the seller at the buy step."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"write-concrete-policy"}),": Registers concrete policy ",(0,c.jsx)(n.code,{children:"modref"})," into the concrete-policies table."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"get-concrete-policy"}),": Returns the ",(0,c.jsx)(n.code,{children:"modref"})," of the concrete policy."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"enforce-sale-pact"}),": Ensures that the sale parameter provided to the function is equal to the ID of the currently executing pact.\nIt does this by calling the ",(0,c.jsx)(n.code,{children:"pact-id"})," function to retrieve the ID of the currently executing pact and comparing it to the provided sale parameter.\nIf they are not equal, an exception will be thrown."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>l});var r=i(96540);const c={},s=r.createContext(c);function t(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:t(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);