"use strict";(self.webpackChunkkadena_docs=self.webpackChunkkadena_docs||[]).push([[2644],{26548:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>s,default:()=>h,frontMatter:()=>c,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"resources/election-workshop/workshop-gas","title":"Add a gas station","description":"Prepare a gas station module to pay the transaction fees for account holders who cast votes in the election application.","source":"@site/docs/resources/election-workshop/9-add-a-gas-station.md","sourceDirName":"resources/election-workshop","slug":"/resources/election-workshop/workshop-gas","permalink":"/docs/resources/election-workshop/workshop-gas","draft":false,"unlisted":false,"editUrl":"https://github.com/kda-community/kadena-docs-new/blob/master/docs/resources/election-workshop/9-add-a-gas-station.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"title":"Add a gas station","description":"Prepare a gas station module to pay the transaction fees for account holders who cast votes in the election application.","id":"workshop-gas","sidebar_position":10}}');var o=t(74848),i=t(28453);const c={title:"Add a gas station",description:"Prepare a gas station module to pay the transaction fees for account holders who cast votes in the election application.",id:"workshop-gas",sidebar_position:10},s="Add a gas station",r={},l=[{value:"Before you begin",id:"before-you-begin",level:2},{value:"Create a voter account",id:"create-a-voter-account",level:2},{value:"Attempt to cast a vote",id:"attempt-to-cast-a-vote",level:2},{value:"Implement the gas payer interface",id:"implement-the-gas-payer-interface",level:2},{value:"Deploy the module on the development network",id:"deploy-the-module-on-the-development-network",level:2},{value:"Create the gas station account",id:"create-the-gas-station-account",level:2},{value:"Update the gas station module",id:"update-the-gas-station-module",level:2},{value:"Fund the gas station account",id:"fund-the-gas-station-account",level:2},{value:"Update the vote function",id:"update-the-vote-function",level:2},{value:"Set the scope for signatures",id:"set-the-scope-for-signatures",level:2},{value:"Cast a vote",id:"cast-a-vote",level:2},{value:"Enforce a limit on transaction fees",id:"enforce-a-limit-on-transaction-fees",level:2},{value:"Set limits on the transactions allowed",id:"set-limits-on-the-transactions-allowed",level:2},{value:"Update the smart contract on the development network",id:"update-the-smart-contract-on-the-development-network",level:2},{value:"Next steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"add-a-gas-station",children:"Add a gas station"})}),"\n",(0,o.jsx)(n.p,{children:"Traditional elections have minimal safeguards against fraud, corruption, mishandling of ballots, and intentional or unintentional disruptions.\nEven where voting is available by mail or online, elections can be costly, inefficient, and subject to human error."}),"\n",(0,o.jsx)(n.p,{children:"By using blockchain technology, elections could be made more convenient, transparent, and reliable.\nFor example:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Every vote can be recorded as a public transaction that can't be altered."}),"\n",(0,o.jsx)(n.li,{children:"Voters can remain anonymous with votes linked to an encrypted digital fingerprint instead of government-issued identification."}),"\n",(0,o.jsx)(n.li,{children:"Election results can be independently verified by anyone."}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["However, there is one main drawback to using a blockchain to cast votes in an election.\nBecause every vote is a public transaction that changes the state of the blockchain, every vote requires computational resources and incurs a processing fee\u2014commonly referred to as a ",(0,o.jsx)(n.strong,{children:"gas"})," payment."]}),"\n",(0,o.jsxs)(n.p,{children:["Paying for transaction processing is normal in the context of many business operations, but paying to vote is essentially undemocratic.\nTo address this issue, Kadena introduced a transaction processing clearing house for paying fees called a ",(0,o.jsx)(n.strong,{children:"gas station"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"A gas station is an account that exists only to make transaction fee payments on behalf of other accounts and under specific conditions.\nFor example, a government agency could apply a fraction of its budget for a traditional election to fund a gas station.\nThe gas station could then pay the transaction fee for every voting transaction, allowing all citizens to vote for free."}),"\n",(0,o.jsxs)(n.p,{children:["For more information about the introduction of gas stations, see ",(0,o.jsx)(n.a,{href:"https://medium.com/kadena-io/the-first-crypto-gas-station-is-now-on-kadenas-blockchain-6dc43b4b3836",children:"The First Crypto Gas Station is Now on Kadena\u2019s Blockchain"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"before-you-begin",children:"Before you begin"}),"\n",(0,o.jsx)(n.p,{children:"Before you start this tutorial, verify the following basic requirements:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"You have an internet connection and a web browser installed on your local computer."}),"\n",(0,o.jsxs)(n.li,{children:["You have a code editor, such as ",(0,o.jsx)(n.a,{href:"https://code.visualstudio.com/download",children:"Visual Studio Code"}),", access to an interactive terminal shell, and are generally familiar with using command-line programs."]}),"\n",(0,o.jsxs)(n.li,{children:["You have cloned the ",(0,o.jsx)(n.a,{href:"https://github.com/kadena-community/voting-dapp.git",children:"voting-dapp"})," repository to create your project directory as described in ",(0,o.jsx)(n.a,{href:"/resources/election-workshop/workshop-prepare",children:"Prepare your workspace"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["You have the development network running in a Docker container as described in ",(0,o.jsx)(n.a,{href:"/resources/election-workshop/workshop-start",children:"Start a local blockchain"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["You are ",(0,o.jsx)(n.a,{href:"/resources/election-workshop/workshop-start#connect-to-the-development-network",children:"connected to the development network"})," using your local host IP address and port number 8080."]}),"\n",(0,o.jsxs)(n.li,{children:["You have created and funded an administrative account as described in ",(0,o.jsx)(n.a,{href:"/resources/election-workshop/workshop-admin",children:"Add an administrator account"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["You have created a principal namespace on the development network as described in ",(0,o.jsx)(n.a,{href:"/resources/election-workshop/workshop-namespace",children:"Define a namespace"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["You have defined the keyset that controls your namespace using the administrative account as described in ",(0,o.jsx)(n.a,{href:"/resources/election-workshop/workshop-keysets",children:"Define keysets"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["You have created an ",(0,o.jsx)(n.code,{children:"election"})," Pact module and deployed it as described in ",(0,o.jsx)(n.a,{href:"/resources/election-workshop/workshop-write",children:"Write a smart contract"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["You have added functions and updated the ",(0,o.jsx)(n.code,{children:"election"})," module deployed on the development network as described in ",(0,o.jsx)(n.a,{href:"/resources/election-workshop/workshop-nominate",children:"Nominate candidates"})," and ",(0,o.jsx)(n.a,{href:"/resources/election-workshop/workshop-vote",children:"Add vote management"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"create-a-voter-account",children:"Create a voter account"}),"\n",(0,o.jsx)(n.p,{children:"In the previous tutorial, you voted with your administrative account.\nThe transaction was successful because the account had sufficient funds to pay the transaction fee.\nFor this tutorial, you need to create a new voter account on the development network.\nInitially, you'll use the voter account to see that voting in the election application requires you to have funds in an account.\nLater, you'll use the voter account to verify that voting transactions are paid using a separate gas station account."}),"\n",(0,o.jsxs)(n.p,{children:["As previously discussed, there are many ways you can create keys and accounts, including ",(0,o.jsx)(n.code,{children:"kadena-cli"})," commands, Chainweaver, or another wallet application.\nFor this tutorial, you'll create an account in the wallet you created when you ran the ",(0,o.jsx)(n.code,{children:"kadena config init"})," command in ",(0,o.jsx)(n.a,{href:"/resources/election-workshop/workshop-start#create-an-account",children:"Create an account"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"To create a voter account:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Verify the development network is currently running on your local computer."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Open a terminal shell on your computer."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Add a new account to the wallet by running ",(0,o.jsx)(n.code,{children:"kadena account add"})," and following the prompts displayed."]}),"\n",(0,o.jsx)(n.p,{children:"For example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'? How would you like to add the account locally? Wallet - Add an account by providing public keys from a list of available wallets\n? Select a wallet: Wallet: pistolas\n? Enter an alias for an account: voter\n? Enter the name of a fungible: coin\n? Select public keys to add to account(index - alias - publickey): Generate new public key\n? Enter the wallet password: ********\n? Select a keyset predicate: keys-all\n\nThe account configuration "voter" has been saved in .kadena/accounts/voter.yaml\n'})}),"\n",(0,o.jsxs)(n.p,{children:["You now have a new local ",(0,o.jsx)(n.code,{children:"voter"})," account.\nHowever, the account doesn't exist on any specific network or chain.\nYou could use ",(0,o.jsx)(n.code,{children:"kadena account fund"})," to give the account a minimal balance on the development network.\nFor the purposes of this tutorial, you want to add the account to the coin ledger with a zero (0.0) balance.\nTo do that, you can create a transaction that calls the ",(0,o.jsx)(n.code,{children:"coin.create-account"})," function."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Add a new ",(0,o.jsx)(n.code,{children:"create-account.ktpl"})," transaction template for creating an account in the ",(0,o.jsx)(n.code,{children:".kadena/transaction-templates"})," folder.\nFor example:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'code: |-\n  (coin.create-account "{{{new-account-name}}}" (read-keyset "account-guard"))\ndata:\n  account-guard:\n    keys:\n      - {{{publicKey}}}\n    pred: {{{predicate}}}\nmeta:\n  chainId: "{{chain-id}}"\n  sender: {{{wallet-account}}}\n  gasLimit: 2000\n  gasPrice: 0.00000001\n  ttl: 7200\nsigners:\n  - public: {{wallet-publicKey}}\n    caps:\n      - name: "coin.GAS"\n        args: []\nnetworkId: "{{network:networkId}}"\ntype: exec\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Create a transaction that uses the template by running the ",(0,o.jsx)(n.code,{children:"kadena tx add"})," command and following the prompts displayed."]}),"\n",(0,o.jsx)(n.p,{children:"For this transaction:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Use the ",(0,o.jsx)(n.code,{children:"voter"})," account name from your wallet for the ",(0,o.jsx)(n.code,{children:"new-account-name"})," variable."]}),"\n",(0,o.jsxs)(n.li,{children:["Use the ",(0,o.jsx)(n.code,{children:"voter"})," public key for the ",(0,o.jsx)(n.code,{children:"publicKey"})," variable."]}),"\n",(0,o.jsxs)(n.li,{children:["Use the ",(0,o.jsx)(n.code,{children:"wallet"})," account name for the ",(0,o.jsx)(n.code,{children:"wallet-account"})," variable."]}),"\n",(0,o.jsxs)(n.li,{children:["Use the ",(0,o.jsx)(n.code,{children:"wallet"})," public key for the ",(0,o.jsx)(n.code,{children:"wallet-publicKey"})," variable."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Sign the transaction by running the ",(0,o.jsx)(n.code,{children:"kadena tx sign"})," command and following the prompts displayed."]}),"\n",(0,o.jsxs)(n.p,{children:["For this transaction, select the ",(0,o.jsx)(n.code,{children:"Sign with wallet"})," option and specify the wallet password."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Send the signed transaction to the blockchain by running the ",(0,o.jsx)(n.code,{children:"kadena tx send"})," command and following the prompts displayed."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"attempt-to-cast-a-vote",children:"Attempt to cast a vote"}),"\n",(0,o.jsxs)(n.p,{children:["To attempt to cast a vote with the new ",(0,o.jsx)(n.code,{children:"voter"})," account:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Verify the development network is currently running on your local computer."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Add a new ",(0,o.jsx)(n.code,{children:"vote.ktpl"})," transaction template in the ",(0,o.jsx)(n.code,{children:".kadena/transaction-templates"})," folder.\nFor example:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'code: |-\n   (n_90785a0e8c65525ef342c84991842f851868f7cb.election.vote "{{account-name}}")\ndata:\nmeta:\n   chainId: "{{chain-id}}"\n   sender: "{{{account-name}}}"\n   gasLimit: 80300\n   gasPrice: 0.000001\n   ttl: 600\nsigners:\n   - public: "{{public-key}}"\n     caps: []\nnetworkId: "{{network-id}}"\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Create a transaction that uses the template by running the ",(0,o.jsx)(n.code,{children:"kadena tx add"})," command and following the prompts displayed."]}),"\n",(0,o.jsx)(n.p,{children:"For this transaction:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Use the voter account name from your wallet for the ",(0,o.jsx)(n.code,{children:"account-name"})," variable."]}),"\n",(0,o.jsxs)(n.li,{children:["Use the chain where you deployed the election module for the ",(0,o.jsx)(n.code,{children:"chain-id"})," variable."]}),"\n",(0,o.jsxs)(n.li,{children:["Use the voter public key for the ",(0,o.jsx)(n.code,{children:"publicKey"})," variable."]}),"\n",(0,o.jsxs)(n.li,{children:["Use development for the ",(0,o.jsx)(n.code,{children:"network-id"})," variable."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Sign the transaction by running the ",(0,o.jsx)(n.code,{children:"kadena tx sign"})," command, select the ",(0,o.jsx)(n.code,{children:"Sign with wallet"})," option, and type the wallet password."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Send the signed transaction by running the ",(0,o.jsx)(n.code,{children:"kadena tx send"})," command and selecting the signed transaction file."]}),"\n",(0,o.jsx)(n.p,{children:"Because the current implementation doesn't allow accounts with a zero balance to vote, you'll see that the transaction fails with an error message similar to the following:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'Error in processing transaction: "D62Gs0Zx...3f8vuajw" Failed to buy gas: Insufficient funds\n'})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"implement-the-gas-payer-interface",children:"Implement the gas payer interface"}),"\n",(0,o.jsxs)(n.p,{children:["Before accounts without funds can vote, you need to add a second Pact module\u2014the ",(0,o.jsx)(n.code,{children:"election-gas-station"})," module\u2014that implements the ",(0,o.jsx)(n.code,{children:"gas-payer"})," interface to your ",(0,o.jsx)(n.code,{children:"election"})," smart contract."]}),"\n",(0,o.jsx)(n.p,{children:"To create the gas station module:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"election-workshop/pact"})," folder in the code editor on your computer."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Create a new ",(0,o.jsx)(n.code,{children:"election-gas-station.pact"})," file in the ",(0,o.jsx)(n.code,{children:"pact"})," folder."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"election-gas-station.pact"})," file and add the Pact code to specify the namespace, module name, and module owner."]}),"\n",(0,o.jsx)(n.p,{children:"For example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(namespace "n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80")\n\n(module election-gas-station GOVERNANCE\n  (defcap GOVERNANCE () \n    (enforce-guard (keyset-ref-guard "n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election-admin")))\n\n)\n'})}),"\n",(0,o.jsxs)(n.p,{children:["As you can see in this example, the new module\u2014like the ",(0,o.jsx)(n.code,{children:"election"})," module\u2014is deployed in the principal namespace and governed by the ",(0,o.jsx)(n.code,{children:"election-admin"})," keyset.\nBe sure you replace the namespace and keyset information with the principal namespace and keyset you have deployed on the development network."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Add ",(0,o.jsx)(n.code,{children:"gas-payer-v1"})," as the interface you want to implement in this module inside of the module declaration."]}),"\n",(0,o.jsx)(n.p,{children:"For example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(namespace "n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80")\n\n(module election-gas-station GOVERNANCE\n  (defcap GOVERNANCE () \n    (enforce-guard (keyset-ref-guard "n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election-admin")))\n  (implements gas-payer-v1)\n)\n'})}),"\n",(0,o.jsxs)(n.p,{children:["You can find the ",(0,o.jsx)(n.code,{children:"gas-payer-v1"})," interface locally in the ",(0,o.jsx)(n.code,{children:"election-workshop/pact/root/gas-payer-v1.pact"})," file for your project so that you can test your module in the Pact REPL.\nThe interface is also pre-installed on the Kadena development, test, and main networks, so you don't need to deploy it when you deploy the ",(0,o.jsx)(n.code,{children:"election-gas-station"})," module.\nHowever, you must implement the capabilities, types, and functions that are defined in the ",(0,o.jsx)(n.code,{children:"gas-payer-v1.pact"})," file before you can start testing."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Implement the ",(0,o.jsx)(n.code,{children:"GAS_PAYER"})," capability as defined in the ",(0,o.jsx)(n.code,{children:"gas-payer-v1.pact"})," file and compose an inner capability called ",(0,o.jsx)(n.code,{children:"ALLOW_GAS"})," to use as a guard for the account used to pay transaction fees:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:"  (defcap GAS_PAYER:bool\n     ( user  : string\n       limit : integer\n       price : decimal\n     )\n     (compose-capability (ALLOW_GAS))\n  )\n\n  (defcap ALLOW_GAS () true)\n\n  (defun create-gas-payer-guard:guard ()\n    (create-capability-guard (ALLOW_GAS))\n  )\n"})}),"\n",(0,o.jsxs)(n.p,{children:["With this code, an account granted the ",(0,o.jsx)(n.code,{children:"GAS_PAYER"})," capability can pay gas fees for any transaction.\nIn addition, the ",(0,o.jsx)(n.code,{children:"create-gas-payer-guard"})," function uses the built-in ",(0,o.jsx)(n.code,{children:"create-capability-guard"})," function to return a guard for the ",(0,o.jsx)(n.code,{children:"ALLOW_GAS"})," capability.\nThe guarded inner capability ",(0,o.jsx)(n.code,{children:"ALLOW_GAS"})," always returns ",(0,o.jsx)(n.code,{children:"true"})," so that the gas station account can pay the transaction fees on behalf of any account."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Create a ",(0,o.jsx)(n.code,{children:"election-gas-station.repl"})," file in the ",(0,o.jsx)(n.code,{children:"pact"})," folder and add the following lines of code:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(load "setup.repl")\n\n(begin-tx "Load election gas station module")\n  (load "root/gas-payer-v1.pact")\n  (load "election-gas-station.pact")\n(commit-tx)\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Execute the code in the ",(0,o.jsx)(n.code,{children:"election-gas-station.repl"})," file using the Pact command-line interpreter and the ",(0,o.jsx)(n.code,{children:"--trace"})," command-line option."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"pact election-gas-station.repl --trace\n"})}),"\n",(0,o.jsx)(n.p,{children:"You should see that the transaction succeeds with output similar to the following:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'...\nelection-gas-station.repl:3:2-3:33:Trace: "Loading root/gas-payer-v1.pact..."\nroot/gas-payer-v1.pact:0:0-31:1:Trace: Loaded interface gas-payer-v1, hash iIWAP1oen_kpXjFbnQM87AJRZIgtsfZcAwYrEy21RWQ\nelection-gas-station.repl:4:2-4:36:Trace: "Loading election-gas-station.pact..."\nelection-gas-station.pact:1:0-1:56:Trace: "Namespace set to n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80"\nelection-gas-station.pact:3:0-22:1:Trace: Loaded module n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election-gas-station, hash vYfspyHz004xJXyR224XLZsktOtPI5qEN5VcW7pZsdM\nelection-gas-station.repl:5:0-5:11:Trace: "Commit Tx 3 Load election gas station module"\nLoad successful\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Now that you have a working implementation of the ",(0,o.jsx)(n.code,{children:"gas-payer-v1"})," interface, you can deploy the new module on the development network to test whether it can pay the transaction fee for votes cast using the election application."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"deploy-the-module-on-the-development-network",children:"Deploy the module on the development network"}),"\n",(0,o.jsx)(n.p,{children:"To deploy the new Pact module on the development network:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Verify the development network is currently running on your local computer."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Copy the ",(0,o.jsx)(n.code,{children:"election-module-devnet.ktpl"})," transaction template that you created previously and rename the file as ",(0,o.jsx)(n.code,{children:"election-gas-module-devnet.ktpl"})," to add create new transaction template."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Remove the ",(0,o.jsx)(n.code,{children:'"init-candidates": true'})," and ",(0,o.jsx)(n.code,{children:'"upgrade": true'})," properties, then save the file."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Create a transaction that uses the ",(0,o.jsx)(n.code,{children:"election-gas-module-devnet.ktpl"})," template by running the ",(0,o.jsx)(n.code,{children:"kadena tx add"})," command and following the prompts displayed."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Sign the transaction by running the ",(0,o.jsx)(n.code,{children:"kadena tx sign"})," command and following the prompts displayed."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Send the signed transaction to the blockchain by running the ",(0,o.jsx)(n.code,{children:"kadena tx send"})," command and following the prompts displayed."]}),"\n",(0,o.jsx)(n.p,{children:"You can verify the transaction results using the request key for the transaction."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Election module deployed on the development chain",src:t(60771).A+"",width:"1728",height:"118"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"create-the-gas-station-account",children:"Create the gas station account"}),"\n",(0,o.jsxs)(n.p,{children:["Because the GAS_PAYER account is guarded by the ALLOW_GAS capability, you can use the ",(0,o.jsx)(n.code,{children:"create-principal"})," built-in function to automatically create its account name with a ",(0,o.jsx)(n.code,{children:"c:"})," prefix.\nYou can then define the gas station account name as a constant in the ",(0,o.jsx)(n.code,{children:"election-gas-station.pact"})," file."]}),"\n",(0,o.jsx)(n.p,{children:"To create a capability-guarded account:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"election-workshop/pact"})," folder in the code editor on your computer."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"election-gas-station.pact"})," file and add the following line of code to the end of the module declaration:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:"(defconst GAS_STATION_ACCOUNT (create-principal (create-gas-payer-guard)))\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"./pact/election-gas-station.repl"})," file and update the transaction to display the capability-guarded gas station account name when you run the file."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(load "setup.repl")\n\n(begin-tx "Load election gas station module")\n  (load "root/gas-payer-v1.pact")\n  (load "election-gas-station.pact")\n  [GAS_STATION_ACCOUNT]\n(commit-tx)\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Execute the code in the ",(0,o.jsx)(n.code,{children:"election-gas-station.repl"})," file using the Pact command-line interpreter and the ",(0,o.jsx)(n.code,{children:"--trace"})," command-line option."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"pact election-gas-station.repl --trace\n"})}),"\n",(0,o.jsx)(n.p,{children:"You should see that the transaction succeeds with output similar to the following:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'...\nelection-gas-station.repl:4:2-4:36:Trace: "Loading election-gas-station.pact..."\nelection-gas-station.pact:1:0-1:56:Trace: "Namespace set to n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80"\nelection-gas-station.pact:3:0-24:1:Trace: Loaded module n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election-gas-station, hash QZMPB9N5frFc_gcJ3o7YtqTqCvMKhLA4OUxVT9X8sPU\nelection-gas-station.repl:5:2-5:23:Trace: ["c:1PaIauckhwRAVXP8YyoxSIczy60Nh9s9-_K59ugzW8A"]\nelection-gas-station.repl:6:0-6:11:Trace: "Commit Tx 3 Load election gas station module"\nLoad successful\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"election-gas-station.pact"})," file in the code editor on your computer."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Add an ",(0,o.jsx)(n.code,{children:"init"})," function that uses the ",(0,o.jsx)(n.code,{children:"create-account"})," function from the ",(0,o.jsx)(n.code,{children:"coin"})," module to create the gas station account in the ",(0,o.jsx)(n.code,{children:"election-gas-station"})," module:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:"(defun init ()\n  (coin.create-account GAS_STATION_ACCOUNT (create-gas-payer-guard))\n)\n"})}),"\n",(0,o.jsx)(n.p,{children:"In this code:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The first argument of the function is the account name you just defined."}),"\n",(0,o.jsx)(n.li,{children:"The second argument is the guard for the account."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Add an if-statement after the module declaration that calls the ",(0,o.jsx)(n.code,{children:"init"})," function if the module is deployed with ",(0,o.jsx)(n.code,{children:'{ "init": true }'})," in the transaction data:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(if (read-msg \'init)\n  [(init)]\n  ["not creating the gas station account"]\n)\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Update the ",(0,o.jsx)(n.code,{children:"election-gas-station.repl"})," file to set ",(0,o.jsx)(n.code,{children:"init"})," to true for the next transaction by adding the following lines of code after loading the ",(0,o.jsx)(n.code,{children:"setup.repl"})," module:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(env-data\n  { "init": true }\n)\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Execute the code in the ",(0,o.jsx)(n.code,{children:"election-gas-station.repl"})," file using the Pact command-line interpreter and the ",(0,o.jsx)(n.code,{children:"--trace"})," command-line option."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:"pact election-gas-station.repl --trace\n"})}),"\n",(0,o.jsx)(n.p,{children:"You should see that the transaction succeeds with output similar to the following:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'...\nelection-gas-station.pact:29:0-32:1:Trace: ["Write succeeded"]\nelection-gas-station.repl:9:2-9:23:Trace: ["c:1PaIauckhwRAVXP8YyoxSIczy60Nh9s9-_K59ugzW8A"]\nelection-gas-station.repl:10:0-10:11:Trace: "Commit Tx 3 Load election gas station module"\nLoad successful\n'})}),"\n",(0,o.jsxs)(n.p,{children:["If you're successful loading the ",(0,o.jsx)(n.code,{children:"election-gas-station module"})," in the Pact REPL, you can update the module deployed on the development network."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"update-the-gas-station-module",children:"Update the gas station module"}),"\n",(0,o.jsx)(n.p,{children:"To deploy the new Pact module on the development network:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Verify the development network is currently running on your local computer."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"election-gas-module-devnet.ktpl"})," file, add the ",(0,o.jsx)(n.code,{children:'"init": true'})," property to the transaction data, and save the file."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'data:\n  election-admin:\n    keys: ["{{public-key}}"]\n    pred: "keys-all"\n  "init": true\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Create a transaction that uses the ",(0,o.jsx)(n.code,{children:"election-gas-module-devnet.ktpl"})," template by running the ",(0,o.jsx)(n.code,{children:"kadena tx add"})," command and following the prompts displayed."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Sign the transaction by running the ",(0,o.jsx)(n.code,{children:"kadena tx sign"})," command and following the prompts displayed."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Send the signed transaction to the blockchain by running the ",(0,o.jsx)(n.code,{children:"kadena tx send"})," command and following the prompts displayed."]}),"\n",(0,o.jsx)(n.p,{children:"You can verify the transaction results using the request key for the transaction."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"fund-the-gas-station-account",children:"Fund the gas station account"}),"\n",(0,o.jsx)(n.p,{children:"Now that you have created and deployed a secure gas station account, you're ready to fund the account to pay transaction fees."}),"\n",(0,o.jsx)(n.p,{children:"To fund the gas station account:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Verify the development network is currently running on your local computer."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Create a transaction that uses the ",(0,o.jsx)(n.code,{children:"transfer.ktpl"})," template by running the ",(0,o.jsx)(n.code,{children:"kadena tx add"})," command and following the prompts displayed."]}),"\n",(0,o.jsx)(n.p,{children:"For this transaction:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Use the election administrator account for the ",(0,o.jsx)(n.code,{children:"account:from"})," variable."]}),"\n",(0,o.jsxs)(n.li,{children:["Use the capability-guarded account (c:) for the ",(0,o.jsx)(n.code,{children:"account:to"})," variable."]}),"\n",(0,o.jsxs)(n.li,{children:["Use 1.0 for the ",(0,o.jsx)(n.code,{children:"decimal:amount"})," variable."]}),"\n",(0,o.jsxs)(n.li,{children:["Use the chain identifier where you deployed the election module for the ",(0,o.jsx)(n.code,{children:"chain-id"})," variable."]}),"\n",(0,o.jsxs)(n.li,{children:["Use the public key for election administrator for the ",(0,o.jsx)(n.code,{children:"key:fromt"})," variable."]}),"\n",(0,o.jsxs)(n.li,{children:["Use development for the ",(0,o.jsx)(n.code,{children:"network-id"})," variable."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Sign the transaction by running the ",(0,o.jsx)(n.code,{children:"kadena tx sign"})," command and following the prompts displayed."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Send the signed transaction to the blockchain by running the ",(0,o.jsx)(n.code,{children:"kadena tx send"})," command and following the prompts displayed."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"update-the-vote-function",children:"Update the vote function"}),"\n",(0,o.jsxs)(n.p,{children:["The next step is to ensure that the signature of the voter account is within the scope of the ",(0,o.jsx)(n.code,{children:"GAS_PAYER"})," capability.\nTo do this, you'll update the ",(0,o.jsx)(n.code,{children:"vote"})," function to accept the following arguments:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The voter account name."}),"\n",(0,o.jsx)(n.li,{children:"Zero as the gas limit to allow unlimited gas."}),"\n",(0,o.jsx)(n.li,{children:"Zero as the gas price."}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["You'll also change the ",(0,o.jsx)(n.code,{children:"senderAccount"})," in the transaction metadata to use the ",(0,o.jsx)(n.code,{children:"election-gas-station"})," module so that the election gas station account pays the transaction fee for voting transactions instead of the voter account."]}),"\n",(0,o.jsxs)(n.p,{children:["To update the ",(0,o.jsx)(n.code,{children:"vote"})," function:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"frontend/src/repositories/vote/DevnetVoteRepository.ts"})," file in the code editor."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Update the ",(0,o.jsx)(n.code,{children:"vote"})," function to change the ",(0,o.jsx)(n.code,{children:".addSigner(accountKey(account))"})," code as follows:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:".addSigner(accountKey(account), (withCapability) => [\n  withCapability(`${NAMESPACE}.election-gas-station.GAS_PAYER`, account, { int: 0 }, { decimal: '0.0' }),\n])\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Update the ",(0,o.jsx)(n.code,{children:"senderAccount"})," in the transaction metadata to use the capability-guarded gas station account."]}),"\n",(0,o.jsx)(n.p,{children:"For example as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:".setMeta({\n   chainId: CHAIN_ID,\n   ttl: 28000,\n   gasLimit: 100000,\n   gasPrice: 0.000001,\n   senderAccount: 'c:6mPDcWM1oMKDI3mdEio-Yczjul4IYZYcjlhZ--Rkhe8',\n})\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"set-the-scope-for-signatures",children:"Set the scope for signatures"}),"\n",(0,o.jsxs)(n.p,{children:["At this point, most of the work required to use a gas station to pay transaction fees is done.\nHowever, when you added the ",(0,o.jsx)(n.code,{children:"ACCOUNT-OWNER"})," capability to the ",(0,o.jsx)(n.code,{children:"election-workshop/pact/election.pact"})," file in the previous tutorial, you didn't set the scope for the capability."]}),"\n",(0,o.jsxs)(n.p,{children:["In a test from the previous tutorial, the ",(0,o.jsx)(n.code,{children:"caps"})," field passed to ",(0,o.jsx)(n.code,{children:"env-sigs"})," is an empty array:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:"(env-sigs\n  [{ 'key  : \"voter\"\n   , 'caps : []\n  }]\n)\n"})}),"\n",(0,o.jsx)(n.p,{children:"Because the signature isn't scoped to any capability, the unrestricted signing key automatically approves all capabilities required for the function to execute."}),"\n",(0,o.jsxs)(n.p,{children:["However, in this tutorial, you modified the ",(0,o.jsx)(n.code,{children:"vote"})," function in the ",(0,o.jsx)(n.code,{children:"frontend/src/repositories/vote/DevnetVoteRepository.ts"})," file to scope the signature of the ",(0,o.jsx)(n.code,{children:"vote"})," transaction to grant the ",(0,o.jsx)(n.code,{children:"GAS_PAYER"})," capability, but not the ",(0,o.jsx)(n.code,{children:"ACCOUNT-OWNER"})," capability."]}),"\n",(0,o.jsxs)(n.p,{children:["If you sign for some capabilities but not for all capabilities that are required for a transaction, the transaction will fail at the point where a capability is required that you didn't sign for.\nTherefore, you need to add a second capability to the array passed to ",(0,o.jsx)(n.code,{children:"addSigners"})," in the ",(0,o.jsx)(n.code,{children:"vote"})," function."]}),"\n",(0,o.jsxs)(n.p,{children:["To set the scope for the ",(0,o.jsx)(n.code,{children:"ACCOUNT-OWNER"})," capability:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"frontend/src/repositories/vote/DevnetVoteRepository.ts"})," file in the code editor."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Add the ",(0,o.jsx)(n.code,{children:"ACCOUNT-OWNER"})," capability to the ",(0,o.jsx)(n.code,{children:".addSigner"})," with the following line of code:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"withCapability(`${NAMESPACE}.election.ACCOUNT-OWNER`, account),\n"})}),"\n",(0,o.jsx)(n.p,{children:"After making this change, the voter signature is scoped to two capabilities:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:".addSigner(accountKey(account), (withCapability) => [\n   withCapability(`${NAMESPACE}.election-gas-station.GAS_PAYER`, account, { int: 0 }, { decimal: '0.0' }),\n   withCapability(`${NAMESPACE}.election.ACCOUNT-OWNER`, account),\n ])\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"cast-a-vote",children:"Cast a vote"}),"\n",(0,o.jsx)(n.p,{children:"To cast a vote with the voter account:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Verify the development network is currently running on your local computer."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open ",(0,o.jsx)(n.code,{children:"http://localhost:5173"})," in your browser and verify that there's at least one candidate listed."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Click ",(0,o.jsx)(n.strong,{children:"Set Account"}),", copy and paste the voter account name from Chainweaver to vote using that account, then click ",(0,o.jsx)(n.strong,{children:"Save"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Click ",(0,o.jsx)(n.strong,{children:"Vote Now"})," for a candidate, sign the transaction, and wait for it to complete."]}),"\n",(0,o.jsx)(n.p,{children:"You should see the vote count for the candidate you voted for incremented by one vote."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"View the result after voting",src:t(79825).A+"",width:"1542",height:"804"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"enforce-a-limit-on-transaction-fees",children:"Enforce a limit on transaction fees"}),"\n",(0,o.jsx)(n.p,{children:"You now have a functioning gas station for the election application. However, you might want to make some additional changes to make the module more secure. For example, you should enforce an upper limit for transaction fees to help ensure that funds in the gas station account aren't drained too quickly."}),"\n",(0,o.jsx)(n.p,{children:"To set an upper limit for transaction fees:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"election-gas-station.pact"})," file in the code editor on your computer."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Add the following function to retrieve the gas price from the metadata of the transaction using the built-in ",(0,o.jsx)(n.code,{children:"chain-data"})," function:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:"(defun chain-gas-price ()\n  (at 'gas-price (chain-data))\n)\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Add the following function to force the gas price to be below a specified limit."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(defun enforce-below-or-at-gas-price:bool (gasPrice:decimal)\n  (enforce (<= (chain-gas-price) gasPrice)\n    (format "Gas Price must be lower than or equal to {}" [gasPrice]))\n)\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Update the ",(0,o.jsx)(n.code,{children:"GAS_PAYER"})," capability by adding ",(0,o.jsx)(n.code,{children:"(enforce-below-or-at-gas-price 0.000001)"})," right before ",(0,o.jsx)(n.code,{children:"(compose-capability (ALLOW_GAS))"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"For example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:"(enforce-below-or-at-gas-price 0.000001)\n(compose-capability (ALLOW_GAS))\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"set-limits-on-the-transactions-allowed",children:"Set limits on the transactions allowed"}),"\n",(0,o.jsx)(n.p,{children:'In its current state, any module can use your gas station to pay for any type of transaction, including transactions that involve multiple steps and could be quite costly. For example, a cross-chain transfer is a transaction that requires a continuation with part of the transaction taking place on the source chain and completed on the destination chain. This type of "continued" transaction requires more computational resources\u2014that is, more gas\u2014than a simple transaction that completes in a single step.'}),"\n",(0,o.jsxs)(n.p,{children:["To prevent the gas station account from being depleted by transactions that require multiple steps, you can configure the gas station module to only allow simple transactions, identified by the ",(0,o.jsx)(n.code,{children:"exec"})," transaction type. Transactions identified with the ",(0,o.jsx)(n.code,{children:"exec"})," transaction type can contain multiple functions but complete in a single step."]}),"\n",(0,o.jsx)(n.p,{children:"To set limits on the transactions allowed to access the gas station account:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"election-gas-station.pact"})," file in the code editor on your computer."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Restrict the transaction type to only allow ",(0,o.jsx)(n.code,{children:"exec"})," transactions by adding the following line to the start of the ",(0,o.jsx)(n.code,{children:"GAS_PAYER"})," capability definition:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(enforce (= "exec" (at "tx-type" (read-msg))) "Can only be used inside an exec")\n'})}),"\n",(0,o.jsxs)(n.p,{children:["An ",(0,o.jsx)(n.code,{children:"exec"})," transaction can contain multiple function calls. You can further restrict access to the funds in the gas station account by only allowing specific function calls."]}),"\n",(0,o.jsxs)(n.p,{children:["An ",(0,o.jsx)(n.code,{children:"exec"})," transaction can contain multiple function calls. You can also restrict access to the gas station account by only allowing specific function calls."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Restrict access to only allow one function call by adding the following line to the ",(0,o.jsx)(n.code,{children:"GAS_PAYER"})," capability definition:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(enforce (= 1 (length (at "exec-code" (read-msg)))) "Can only be used to call one pact function")\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Restrict access to only pay transaction fees for functions defined in the ",(0,o.jsx)(n.code,{children:"election"})," module by adding the following line to the ",(0,o.jsx)(n.code,{children:"GAS_PAYER"})," capability definition:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(enforce\n  (= "(n_14912521e87a6d387157d526b281bde8422371d1.election." (take 52 (at 0 (at "exec-code" (read-msg)))))\n  "Only election module calls are allowed"\n)\n'})}),"\n",(0,o.jsx)(n.p,{children:"Remember to replace the namespace with your own principal namespace."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"update-the-smart-contract-on-the-development-network",children:"Update the smart contract on the development network"}),"\n",(0,o.jsx)(n.p,{children:"After you've completed the changes to secure the gas station account, you are ready to update the smart contract you have deployed on the development network and complete the workshop."}),"\n",(0,o.jsx)(n.p,{children:"To update the smart contract and complete the workshop:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"election-workshop/pact"})," folder in a terminal shell on your computer and verify all of the tests you created in the workshop pass using the Pact REPL."]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"pact/candidates.repl"}),"\n",(0,o.jsx)(n.li,{children:"pact/election-gas-station.repl"}),"\n",(0,o.jsx)(n.li,{children:"pact/keyset.repl"}),"\n",(0,o.jsx)(n.li,{children:"pact/module.repl"}),"\n",(0,o.jsx)(n.li,{children:"pact/namespace.repl"}),"\n",(0,o.jsx)(n.li,{children:"pact/principal-namespace.repl"}),"\n",(0,o.jsx)(n.li,{children:"pact/setup.repl"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Verify the development network is currently running on your local computer."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Open and unlock the Chainweaver desktop or web application and verify that:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["You're connected to ",(0,o.jsx)(n.strong,{children:"development network (devnet)"})," from the network list."]}),"\n",(0,o.jsxs)(n.li,{children:["Your administrative account name with the ",(0,o.jsx)(n.strong,{children:"k:"})," prefix exists on chain 1."]}),"\n",(0,o.jsx)(n.li,{children:"Your administrative account name is funded with KDA on chain 1."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"election-workshop/snippets"})," folder in a terminal shell on your computer."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Update your ",(0,o.jsx)(n.code,{children:"election-gas-station"})," module on the development network by running a command similar to the following with your administrative account name:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"npm run deploy-gas-station:devnet -- k:<your-public-key> upgrade\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Remember that ",(0,o.jsx)(n.code,{children:"k:<your-public-key>"})," is the default ",(0,o.jsx)(n.strong,{children:"account name"})," for the administrative account that you funded in ",(0,o.jsx)(n.a,{href:"/resources/election-workshop/workshop-admin",children:"Add an administrator account"}),". You can copy this account name from Chainweaver when viewing the account watch list. When you run the script, you should see Chainweaver display a QuickSign Request."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Click ",(0,o.jsx)(n.strong,{children:"Sign All"})," to sign the request."]}),"\n",(0,o.jsx)(n.p,{children:"After you click Sign All, the transaction is executed and the results are displayed in your terminal shell."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Verify your contract changes in the Chainweaver Module Explorer by refreshing the list of ",(0,o.jsx)(n.strong,{children:"Deployed Contracts"}),", then clicking ",(0,o.jsx)(n.strong,{children:"View"})," for the ",(0,o.jsx)(n.code,{children:"election-gas-station"})," module."]}),"\n",(0,o.jsxs)(n.p,{children:["After you click View, you should see the updated list of functions and capabilities. If you click ",(0,o.jsx)(n.strong,{children:"Open"}),", you can view the module code in the editor pane and verify that the ",(0,o.jsx)(n.code,{children:"election-gas-station"})," module deployed on the local development network is what you expect."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,o.jsx)(n.p,{children:"In this tutorial, you learned how to:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Add a second module to your smart contract."}),"\n",(0,o.jsx)(n.li,{children:"Define a gas station account that pays transaction fees on behalf of other accounts."}),"\n",(0,o.jsx)(n.li,{children:"Restrict access to the gas station account based on conditions you specify in the Pact module."}),"\n",(0,o.jsx)(n.li,{children:"Deploy the gas station module on the development network."}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["In this workshop, you configured an election application to use the Kadena client to interact with a smart contract deployed on the Kadena blockchain as its backend. The workshop demonstrates the basic functionality for conducting an election online that uses a blockchain to provide more efficient, transparent, and tamper-proof results. However, as you saw in ",(0,o.jsx)(n.a,{href:"/resources/election-workshop/workshop-vote",children:"Add vote management"}),", it's possible for individuals to vote more than once by simply creating additional Kadena accounts. That might be a challenge you want to explore."]}),"\n",(0,o.jsx)(n.p,{children:"As an alternative, you might want to deploy the election application and smart contract on the Kadena test network, making it available to community members."}),"\n",(0,o.jsx)(n.p,{children:"We can't wait to see what you build next."}),"\n",(0,o.jsxs)(n.p,{children:["To see the code for the activity you completed in this tutorial, check out the ",(0,o.jsx)(n.code,{children:"00-complete"})," branch from the ",(0,o.jsx)(n.code,{children:"voting-dapp"})," repository by running the following command in your terminal shell:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"git checkout 00-complete\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},79825:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/election-two-votes-19cb60bc6ad6174684e68fce07066b2b.png"},60771:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/gas-module-loaded-29382f36478f60f937f79676c0adea82.jpg"},28453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>s});var a=t(96540);const o={},i=a.createContext(o);function c(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);