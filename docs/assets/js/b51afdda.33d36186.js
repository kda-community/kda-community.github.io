"use strict";(self.webpackChunkkadena_docs=self.webpackChunkkadena_docs||[]).push([[2625],{65093:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"reference/marmalade/marmalade","title":"What is Marmalade?","description":"Use the Kadena Marmalade token standard and policy contracts to build non-fungible or poly-fungible token marketplaces.","source":"@site/docs/reference/marmalade/what-is-marmalade.md","sourceDirName":"reference/marmalade","slug":"/reference/marmalade/marmalade","permalink":"/docs/reference/marmalade/marmalade","draft":false,"unlisted":false,"editUrl":"https://github.com/kda-community/kadena-docs-new/blob/master/docs/reference/marmalade/what-is-marmalade.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"What is Marmalade?","description":"Use the Kadena Marmalade token standard and policy contracts to build non-fungible or poly-fungible token marketplaces.","id":"marmalade","sidebar_position":1}}');var s=n(74848),o=n(28453);const i={title:"What is Marmalade?",description:"Use the Kadena Marmalade token standard and policy contracts to build non-fungible or poly-fungible token marketplaces.",id:"marmalade",sidebar_position:1},r="What is Marmalade?",l={},c=[{value:"Traditional marketplaces for non-fungible tokens",id:"traditional-marketplaces-for-non-fungible-tokens",level:2},{value:"Sales contracts",id:"sales-contracts",level:2},{value:"Token policies",id:"token-policies",level:2},{value:"Preparing to mint a token",id:"preparing-to-mint-a-token",level:2},{value:"Token sales and trustless escrow",id:"token-sales-and-trustless-escrow",level:2},{value:"Offer",id:"offer",level:3},{value:"Buy",id:"buy",level:3},{value:"Withdraw",id:"withdraw",level:3},{value:"Completing a logical sequence",id:"completing-a-logical-sequence",level:3},{value:"Using built-in policies",id:"using-built-in-policies",level:2},{value:"Creating custom policies",id:"creating-custom-policies",level:2}];function d(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"what-is-marmalade",children:"What is Marmalade?"})}),"\n",(0,s.jsxs)(t.p,{children:["Marmalade is the name of the Kadena ",(0,s.jsx)(t.strong,{children:"token standard"}),".\nThis token standard defines the interfaces for minting digital items with Kadena ",(0,s.jsx)(t.strong,{children:"smart contracts"})," and protecting those digital items with Kadena ",(0,s.jsx)(t.strong,{children:"token policies"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Digital items that are unique, one-of-a-kind assets are most commonly referred to as non-fungible tokens (NFTs).\nHowever, the Kadena token standard is implemented as a multi-token or ",(0,s.jsx)(t.strong,{children:"poly-fungible"})," standard that enables you to define, mint, and secure tokens that are fully fungible as interchangeable coins, partially fungible as a limited edition with a fixed supply, or completely non-fungible as unique items.\nTokens can also be restricted to a single owner with rules for transferring ownership or support shared ownership with multiple potential stakeholders."]}),"\n",(0,s.jsx)(t.p,{children:"As a creator, you have complete control over your token properties and the rules for minting, owning, and transferring tokens."}),"\n",(0,s.jsx)(t.h2,{id:"traditional-marketplaces-for-non-fungible-tokens",children:"Traditional marketplaces for non-fungible tokens"}),"\n",(0,s.jsx)(t.p,{children:"Non-fungible tokens defined using other token standards have two main drawbacks:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Most token standards assume that a change of ownership is always a transfer operation.\nHowever, a transfer-based model doesn't take into account the non-transferable nature of a unique asset.\nMarmalade supports both transfers and sales, with the additional flexibility to use token policies for either operation."}),"\n",(0,s.jsx)(t.li,{children:"Most token standards don't provide any guarantees that creators will be paid royalties for their work or  what they'll be paid from the exchanges that host their work."}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["With Marmalade, Kadena eliminates these issues by making ",(0,s.jsx)(t.strong,{children:"sales contracts"})," and ",(0,s.jsx)(t.strong,{children:"token policies"})," core components of the token standard."]}),"\n",(0,s.jsx)(t.h2,{id:"sales-contracts",children:"Sales contracts"}),"\n",(0,s.jsx)(t.p,{children:"In the simplest sense, a sale is typically a three-step process:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"A seller lists an item for sale with a price."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"A buyer agrees to pay the seller for the item at a mutually agreed-upon price."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"The seller receives payment and transfers the item to the buyer."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["On the Kadena network, Pact smart contracts use ",(0,s.jsx)(t.code,{children:"pact"})," functions to define multi-step operations like cross-chain transfers and automatic gas payments.\nThe Marmalade token standard also uses ",(0,s.jsx)(t.code,{children:"pact"})," functions to handle the multi-step nature of a sale."]}),"\n",(0,s.jsxs)(t.p,{children:["By using ",(0,s.jsx)(t.code,{children:"pact"})," functions, contracts can define explicit steps that must be executed in a fixed order.\nThe ",(0,s.jsx)(t.code,{children:"pact"})," definition forms an enforceable sequence of actions that are executed on-chain.\nThe sequence can't be altered and no steps can be skipped.\nFor a transaction to be successful, all parties must complete the actions they are responsible for.\nAll of the sequencing and cryptography required to enforce a sales contract is handled automatically by the Pact language itself."]}),"\n",(0,s.jsxs)(t.p,{children:["To complete a sale, the ",(0,s.jsx)(t.code,{children:"pact"})," function defines the following steps:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Offer: A seller who wants to list a digital asset for sale creates an ",(0,s.jsx)(t.strong,{children:"offer"}),".\nThis operation puts the asset into a ",(0,s.jsx)(t.em,{children:"trustless escrow"})," account that can only be released by later steps in the ",(0,s.jsx)(t.code,{children:"pact"})," definition."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Buy: A buyer initiates a ",(0,s.jsx)(t.strong,{children:"buy"})," operation with a promised payment and the escrowed asset waits for the step to be completed successfully by the buyer."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Withdraw: If the buyer doesn't complete the transaction within a certain period of time, the ",(0,s.jsx)(t.code,{children:"pact"})," function can roll back the first step of the transaction and the seller can ",(0,s.jsx)(t.strong,{children:"withdraw"})," the sale.\nIf the seller withdraws, the ",(0,s.jsx)(t.code,{children:"pact"})," transfers the asset back to the seller's account from the escrow account."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"token-policies",children:"Token policies"}),"\n",(0,s.jsxs)(t.p,{children:["The Marmalade token standard enables creators to specify ",(0,s.jsx)(t.strong,{children:"token policies"})," to control how their assets can be minted, sold, and transferred and how royalties are paid.\nFor example, a token policy might specify that an asset can't be transferred directly to a buyer until a purchase is complete and the royalty distributed to the creator."]}),"\n",(0,s.jsxs)(t.p,{children:["Token policies are implemented as smart contracts based on the interfaces defined in the ",(0,s.jsx)(t.a,{href:"https://github.com/kadena-io/marmalade/blob/main/pact/kip/token-policy-v2.pact",children:(0,s.jsx)(t.code,{children:"kip.token-policy-v2"})})," standard.\nThere are several built-in policies\u2014called ",(0,s.jsx)(t.strong,{children:"concrete policies"}),"\u2014that are configured to handle the most common marketplace use cases.\nFor example, if you apply the ",(0,s.jsx)(t.code,{children:"non-fungible-policy"})," to a token, the token is automatically configured to be minted only once."]}),"\n",(0,s.jsxs)(t.p,{children:["You can apply built-in policies to any token or write custom policies based on the ",(0,s.jsx)(t.code,{children:"kip.token-policy-v2"})," standard.\nYou can also create ",(0,s.jsx)(t.strong,{children:"collections"})," of tokens using the ",(0,s.jsx)(t.code,{children:"collection-policy"})," to establish ",(0,s.jsx)(t.strong,{children:"marketplace communities"})," that share a common approach to token ownership or token sales.\nAfter you create the group of tokens that make up the collection, the entire collection can be discovered from Chainweb events."]}),"\n",(0,s.jsx)(t.p,{children:"For example, you can use token policies to define the following types of rules:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["You can create tokens with a ",(0,s.jsx)(t.strong,{children:"royalty"})," policy to specify a royalty rate and the account that should receive royalties."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"You can use policies to control mint operations such as whether a token is unique, part of a limited series, or a fully fungible coin."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"You can use policies to prevent certain tokens from being burned or to be burned only when specific conditions are met."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"You can use policies to restrict how tokens are owned and transferred."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"preparing-to-mint-a-token",children:"Preparing to mint a token"}),"\n",(0,s.jsx)(t.p,{children:"Before you can mint a token on the blockchain, you must create the digital item and upload it to at least one accessible location such as InterPlanetary File System (IPFS), Arweave, or another content delivery or hosting service."}),"\n",(0,s.jsxs)(t.p,{children:["After you have a uniform resource identifier (URI) for locating the digital item, you must also create a metadata file using the JSON schema to record the name, location, and other properties about the item to be minted.\nYou can then create and mint the token for the digital item, generating an on-chain token identifier with a ",(0,s.jsx)(t.code,{children:"t:"})," prefix.\nThe token identifier includes the hash for the metadata that describes the token to ensure that a digital item can be cryptographically verified to be the original NFT.\nHowever, if you update the properties used to create a token\u2014for example, to change a token that represents a character in a game each time the character completes a quest\u2014the hash for the metadata will be different from the original hash and you are, in essence, creating a new token.\nOptionally, you can use a policy to prevent a token from being updated."]}),"\n",(0,s.jsx)(t.p,{children:"Depending on how you apply or configure token policies, you might be the sole owner of the token you mint or share ownership with others.\nIf you're the owner of a token, you have the option to offer the token for sale or transfer the token to another owner."}),"\n",(0,s.jsx)(t.h2,{id:"token-sales-and-trustless-escrow",children:"Token sales and trustless escrow"}),"\n",(0,s.jsxs)(t.p,{children:["If you're the owner of a token, you can start the sales process to find a buyer by selecting and configuring a ",(0,s.jsx)(t.code,{children:"sale"})," smart contract.\nYou've already seen that a sale is essentially a ",(0,s.jsx)(t.code,{children:"pact"})," with two steps: the ",(0,s.jsx)(t.strong,{children:"offer"})," step and the ",(0,s.jsx)(t.strong,{children:"buy"})," step."]}),"\n",(0,s.jsxs)(t.p,{children:["Smart contracts with the ",(0,s.jsx)(t.code,{children:"sale"})," pact also use a special feature of pacts\u2014",(0,s.jsx)(t.strong,{children:"pact guards"}),"\u2014to govern the ",(0,s.jsx)(t.strong,{children:"trustless escrow account"})," for the token sale.\nAfter you offer an asset for sale, the asset is transferred to an account governed by a pact guard.\nFrom that point, only that pact guard\u2014identified by its pact ID\u2014can manage the asset in subsequent steps."]}),"\n",(0,s.jsx)(t.p,{children:"Let's take a closer look at how a sale takes place, starting with an offer."}),"\n",(0,s.jsx)(t.h3,{id:"offer",children:"Offer"}),"\n",(0,s.jsxs)(t.p,{children:["A seller creates an ",(0,s.jsx)(t.strong,{children:"offer"})," for the asset to be sold.\nFor this example, the offer is a simple sale with a ",(0,s.jsx)(t.strong,{children:"quoted"})," asking price.\nThere are other ways you can sell assets\u2014including conventional auctions and dutch auctions\u2014that implement different sale mechanics, but the general use of the trusted escrow account applies to all types of sales."]}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.strong,{children:"offer"})," step transfers the asset from the seller's account in the token ledger to the escrow account. The ",(0,s.jsx)(t.code,{children:"sale"})," pact assigns an identifier to the SALE event that results from the transfer operation."]}),"\n",(0,s.jsx)(t.p,{children:"For example, Bob submits a transaction to offer NFT1 for sale with a price quote of 50 KDA.\nThis transaction:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Removes NFT1 from Bob's account in the token ledger."}),"\n",(0,s.jsxs)(t.li,{children:["Transfers NFT1 to an escrow account associated with a specific sale identifier\u2014",(0,s.jsx)(t.code,{children:"sale:1"}),"\u2014in the token ledger."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Bob starts a sale by offering NFT1",src:n(31640).A+"",width:"746",height:"519"})}),"\n",(0,s.jsxs)(t.p,{children:["By initiating the sale, Bob loses custody of the asset for a period of time.\nThe ",(0,s.jsx)(t.code,{children:"sale:1"})," pact guard takes ownership of the asset."]}),"\n",(0,s.jsx)(t.h3,{id:"buy",children:"Buy"}),"\n",(0,s.jsxs)(t.p,{children:["The buyer who wants to acquire the asset that's been offered for sale sends a ",(0,s.jsx)(t.strong,{children:"continuation"})," transaction for the identifier assigned to the SALE event."]}),"\n",(0,s.jsxs)(t.p,{children:["For example, Alice sends a continuation transaction for the ",(0,s.jsx)(t.code,{children:"sale:1"})," pact identifier to transfer NFT1 out of the escrow account in the token ledger and into her account.\nThe ledger then debits the sale price of 50.0 from Alice\u2019s KDA account to credit Bob and executes any other offsetting transaction needed to release the escrowed NFT.\nFor example, the token policy pays any royalty fees or returns any funds as specified in the policy."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Alice continues the execution of the sale pact",src:n(67182).A+"",width:"672",height:"519"})}),"\n",(0,s.jsxs)(t.p,{children:["With this separation of duties, the ",(0,s.jsx)(t.code,{children:"sale"})," pact is responsible for transferring the NFT out of escrow and enforcing the timeout.\nAny other transaction requirements are handled by token policies."]}),"\n",(0,s.jsx)(t.h3,{id:"withdraw",children:"Withdraw"}),"\n",(0,s.jsxs)(t.p,{children:["Sellers can specify a ",(0,s.jsx)(t.strong,{children:"timeout"})," as part of the ",(0,s.jsx)(t.strong,{children:"offer"})," step.\nIf they set the timeout to zero (0) for a sale contract, they can withdraw from the sale at any time if there are no interested buyers for a token.\nIf they set a specific timeout value\u2014for example, to have an offer expire at midnight on 30 June 2024 with a timeout value of 1719705600\u2014they can't pull out of the sale until after the specified timestamp."]}),"\n",(0,s.jsxs)(t.p,{children:["After the timeout, the seller can send a ",(0,s.jsx)(t.strong,{children:"rollback"})," continuation transaction for the identifier assigned to the SALE event.\nThe ",(0,s.jsx)(t.strong,{children:"withdraw"})," operation then transfers the token out of the escrow account and returns it to the seller."]}),"\n",(0,s.jsx)(t.h3,{id:"completing-a-logical-sequence",children:"Completing a logical sequence"}),"\n",(0,s.jsx)(t.p,{children:"All of the logic required to step through the sales process is automatically handled by the Pact language.\nThe pact definition ensures that step two can only happen after step one and only under the following conditions:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"If step one hasn't been rolled back."}),"\n",(0,s.jsx)(t.li,{children:"If step two hasn't already happened."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Similarly, a rollback can\u2019t occur if step one hasn\u2019t happened, or if step two has already happened.\nWith Pact, this logic isn't left to contract programmers.\nInstead, Pact prevents the contract developer from introducing faulty logic in sequencing the transaction."}),"\n",(0,s.jsx)(t.h2,{id:"using-built-in-policies",children:"Using built-in policies"}),"\n",(0,s.jsxs)(t.p,{children:["The Marmalade token standard defines interfaces for policy-based token management.\nTo simplify token creation using the standard, Kadena provides several built-in token policies for the most common features.\nYou can use the built-in policies\u2014called ",(0,s.jsx)(t.strong,{children:"concrete policies"}),"\u2014independently or in combination to provide the specific features you want to implement.\nFor example:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Use the ",(0,s.jsx)(t.strong,{children:"guard policy"})," to prevent unauthorized token activity like minting or burning."]}),"\n",(0,s.jsxs)(t.li,{children:["Use the ",(0,s.jsx)(t.strong,{children:"non-fungible policy"})," to ensure that a token can only be minted once and never burned."]}),"\n",(0,s.jsxs)(t.li,{children:["Use the ",(0,s.jsx)(t.strong,{children:"royalty policy"})," to specify the account for depositing royalty payments from sales."]}),"\n",(0,s.jsxs)(t.li,{children:["Use the ",(0,s.jsx)(t.strong,{children:"collection policy"})," to create token collections for a marketplace."]}),"\n",(0,s.jsxs)(t.li,{children:["Use the ",(0,s.jsx)(t.strong,{children:"non-updatable policy"})," to prevent a token URI from being updated."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"To illustrate how you can use these policies, assume that you want to offer a non-fungible token.\nYou want to ensure that you are the only person authorized to mint the token and that only one token can be minted and owned.\nYou also want to require that the token can only be transferred to a new owner through a sale contract and you'll be paid a royalty any time the token ownership changes."}),"\n",(0,s.jsxs)(t.p,{children:["To accomplish this, you can create the token using the ",(0,s.jsx)(t.code,{children:"marmalade-v2.guard-policy-v1"}),",",(0,s.jsx)(t.code,{children:"marmalade-v2.non-fungible-policy-v1"}),", and ",(0,s.jsx)(t.code,{children:"marmalade-v2.royalty-policy-v1"})," policies."]}),"\n",(0,s.jsx)(t.p,{children:"These policies help to ensure that you are the only person authorized to mint the token, only one token can be minted, and any time the token is transferred to a new owner, you're paid the royalty you specify.\nAfter you mint the token, all future sales respect the policies you've put in place.\nAny new NFT owner can only resell the NFT using the offer, trustless escrow, and royalty enforcement process with a new buyer."}),"\n",(0,s.jsx)(t.h2,{id:"creating-custom-policies",children:"Creating custom policies"}),"\n",(0,s.jsxs)(t.p,{children:["If you find that some combination of concrete policies doesn't meet your needs, you can also use the built-in policies as models for creating your own custom token policies.\nYou can find several examples of custom policies in ",(0,s.jsx)(t.a,{href:"https://github.com/kadena-io/marmalade/tree/main/examples/policies",children:"Marmalade examples"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Like concrete policies, custom policies must adhere to the ",(0,s.jsx)(t.a,{href:"https://github.com/kadena-io/marmalade/blob/v2/pact/kip/token-policy-v2.pact",children:(0,s.jsx)(t.code,{children:"kip.token-policy-v2"})})," interface to be valid."]})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},67182:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/buy-db617844cc61de33036797e4506528c1.png"},31640:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/offer-a925c269cbd6030857e033993b170444.png"},28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>r});var a=n(96540);const s={},o=a.createContext(s);function i(e){const t=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),a.createElement(o.Provider,{value:t},e.children)}}}]);