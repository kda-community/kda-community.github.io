"use strict";(self.webpackChunkkadena_docs=self.webpackChunkkadena_docs||[]).push([[734],{22225:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"guides/nodes/monitor","title":"Monitor node status","description":"This guide explains how to set up basic monitoring to check the status of a Chainweb node using a script, how to add notifications to the script, and how to run the script regularly.","source":"@site/docs/guides/nodes/monitoring.mdx","sourceDirName":"guides/nodes","slug":"/guides/nodes/monitor","permalink":"/docs/guides/nodes/monitor","draft":false,"unlisted":false,"editUrl":"https://github.com/kda-community/kadena-docs-new/blob/master/docs/guides/nodes/monitoring.mdx","tags":[],"version":"current","frontMatter":{"title":"Monitor node status","id":"monitor"},"sidebar":"default","previous":{"title":"Configure node settings","permalink":"/docs/guides/nodes/configure"},"next":{"title":"Manage node databases","permalink":"/docs/guides/nodes/manage-databases"}}');var i=s(74848),o=s(28453);const r={title:"Monitor node status",id:"monitor"},a="Monitor node status",c={},d=[{value:"Basic health check",id:"basic-health-check",level:2},{value:"Adding notifications",id:"adding-notifications",level:2},{value:"Additional checks",id:"additional-checks",level:2},{value:"Running the script regularly",id:"running-the-script-regularly",level:2},{value:"Using cron",id:"using-cron",level:3},{value:"Using systemd",id:"using-systemd",level:3}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"monitor-node-status",children:"Monitor node status"})}),"\n",(0,i.jsx)(n.p,{children:"This guide explains how to set up basic monitoring to check the status of a Chainweb node using a script, how to add notifications to the script, and how to run the script regularly."}),"\n",(0,i.jsx)(n.h2,{id:"basic-health-check",children:"Basic health check"}),"\n",(0,i.jsxs)(n.p,{children:["The following sample script illustrates how you can create a ",(0,i.jsx)(n.code,{children:"bash"})," script that checks the status of a Chainweb node and restarts it, if necessary:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'#!/usr/bin/env bash\n\n# Define environment variables with default values if not already set\nexport CHAINWEB_NETWORK=${CHAINWEB_NETWORK:-mainnet01}\nexport CHAINWEB_PORT=${CHAINWEB_P2P_PORT:-2022}\nSERVICE_NAME="kadena-node.service" # Replace with your service\nLOG_FILE="/var/log/chainweb/service.log"\n\n# Function to log messages with timestamps\nlog_message() {\n    echo "$(date \'+%Y-%m-%d %H:%M:%S\') - $1" >> "$LOG_FILE"\n}\n\n# Function to check the service status\ncheck_service_status() {\n    curl -fsLk --connect-timeout 10 "https://localhost:$CHAINWEB_PORT/chainweb/0.0/$CHAINWEB_NETWORK/cut"\n}\n\n# Function to restart the service and log the outcome\nrestart_service() {\n    if systemctl restart "$SERVICE_NAME"; then\n        log_message "Successfully restarted the Chainweb service."\n    else\n        log_message "Failed to restart the Chainweb service."\n        exit 1  # Exit with an error status if the restart fails\n    fi\n}\n\n# Main logic to check service status and potentially restart the service\nif check_service_status; then\n    log_message "Chainweb service is running."\nelse\n    log_message "Chainweb service might be down. Attempting to restart..."\n    restart_service\nfi\n'})}),"\n",(0,i.jsx)(n.p,{children:"This script does the following:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Sets up environment variables for the Chainweb network and port."}),"\n",(0,i.jsx)(n.li,{children:"Defines functions for logging, checking service status, and restarting the service."}),"\n",(0,i.jsx)(n.li,{children:"Checks if the Chainweb service is running by querying its API."}),"\n",(0,i.jsx)(n.li,{children:"If the service is down, it attempts to restart it."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"adding-notifications",children:"Adding notifications"}),"\n",(0,i.jsxs)(n.p,{children:["To add notifications, you can modify the ",(0,i.jsx)(n.code,{children:"log_message"})," function to send emails or messages to services like Telegram.\nHere's an example of how you might modify the function to send a Telegram message:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'TELEGRAM_BOT_TOKEN="your_bot_token"\nTELEGRAM_CHAT_ID="your_chat_id"\n\nlog_message() {\n    message="$(date \'+%Y-%m-%d %H:%M:%S\') - $1"\n    echo "$message" >> "$LOG_FILE"\n    curl -s -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \\\n         -d chat_id="$TELEGRAM_CHAT_ID" \\\n         -d text="$message"\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Replace ",(0,i.jsx)(n.code,{children:"your_bot_token"})," and ",(0,i.jsx)(n.code,{children:"your_chat_id"})," with your actual Telegram bot token and chat ID."]}),"\n",(0,i.jsx)(n.h2,{id:"additional-checks",children:"Additional checks"}),"\n",(0,i.jsx)(n.p,{children:"You can add more robust checks to ensure your node is functioning correctly.\nFor example, you could add a function to perform a local call to validate functionality."}),"\n",(0,i.jsx)(n.h2,{id:"running-the-script-regularly",children:"Running the script regularly"}),"\n",(0,i.jsxs)(n.p,{children:["In most cases, you should establish a schedule for monitoring nodes at a regular interval.\nFor example, to run the sample script every 30 seconds, you can set up a ",(0,i.jsx)(n.code,{children:"cron"})," job or a ",(0,i.jsx)(n.code,{children:"systemd"})," timer."]}),"\n",(0,i.jsx)(n.h3,{id:"using-cron",children:"Using cron"}),"\n",(0,i.jsxs)(n.p,{children:["To set up a ",(0,i.jsx)(n.code,{children:"cron"})," job for monitoring a node:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Open your crontab file for editing by running the following command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"crontab -e\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Add an instruction for running the monitoring script similar to the following line:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"* * * * * /path/to/your/monitor-node-script.sh; sleep 30; /path/to/your/monitor-node-script.sh\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This instructiopn runs the ",(0,i.jsx)(n.code,{children:"monitor-node-script.sh"})," script every minute and then again 30 seconds later."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"using-systemd",children:"Using systemd"}),"\n",(0,i.jsxs)(n.p,{children:["To set up a ",(0,i.jsx)(n.code,{children:"systemd"})," timer for monitoring a node:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Create a ",(0,i.jsx)(n.code,{children:"/etc/systemd/system/chainweb-monitor.service"})," service file similar to the following:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"[Unit]\nDescription=Chainweb Node Monitor\n\n[Service]\nExecStart=/path/to/your/script.sh\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Create a ",(0,i.jsx)(n.code,{children:"/etc/systemd/system/chainweb-monitor.timer"})," timer file similar to the following:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"[Unit]\nDescription=Run Chainweb Node Monitor every 30 seconds\n\n[Timer]\nOnBootSec=30\nOnUnitActiveSec=30s\n\n[Install]\nWantedBy=timers.target\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Enable the timer by running the following command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl enable chainweb-monitor.timer\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Start the timer by running the following command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl start chainweb-monitor.timer\n"})}),"\n",(0,i.jsx)(n.p,{children:"This timer runs the monitoring script every 30 seconds, providing real-time information about the status of the Chainweb node.\nThe script also automatically attempts to restart the node, if issues are detected."}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>a});var t=s(96540);const i={},o=t.createContext(i);function r(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);