"use strict";(self.webpackChunkkadena_docs=self.webpackChunkkadena_docs||[]).push([[5482],{47300:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>c,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"smart-contracts/install/migrating-to-pact5","title":"Migrating to Pact 5","description":"Update your development environment and smart contracts to use the Pact 5 smart contract language and command-line interpreter.","source":"@site/docs/smart-contracts/install/migrate-pact5.md","sourceDirName":"smart-contracts/install","slug":"/smart-contracts/install/migrating-to-pact5","permalink":"/docs/smart-contracts/install/migrating-to-pact5","draft":false,"unlisted":false,"editUrl":"https://github.com/kda-community/kadena-docs-new/blob/master/docs/smart-contracts/install/migrate-pact5.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Migrating to Pact 5","id":"migrating-to-pact5","sidebar_position":4,"description":"Update your development environment and smart contracts to use the Pact 5 smart contract language and command-line interpreter."},"sidebar":"default","previous":{"title":"Local development network","permalink":"/docs/smart-contracts/install/local-dev-node"},"next":{"title":"Basic concepts","permalink":"/docs/smart-contracts/basic-concepts"}}');var i=t(74848),s=t(28453);const c={title:"Migrating to Pact 5",id:"migrating-to-pact5",sidebar_position:4,description:"Update your development environment and smart contracts to use the Pact 5 smart contract language and command-line interpreter."},r="Migrating to Pact 5",o={},l=[{value:"Preparing to migrate",id:"preparing-to-migrate",level:2},{value:"After upgrading to Pact 5",id:"after-upgrading-to-pact-5",level:2},{value:"Semantic changes",id:"semantic-changes",level:2},{value:"Duplicate capabilities cannot be installed",id:"duplicate-capabilities-cannot-be-installed",level:3},{value:"Using install-capability is only supported for managed capabilities",id:"using-install-capability-is-only-supported-for-managed-capabilities",level:3},{value:"Acquiring module administrator privileges for operations",id:"acquiring-module-administrator-privileges-for-operations",level:3},{value:"Module hashing",id:"module-hashing",level:3},{value:"Function names and variable identifiers",id:"function-names-and-variable-identifiers",level:3},{value:"Integers returned as objects",id:"integers-returned-as-objects",level:3},{value:"Changed or removed built-in functions",id:"changed-or-removed-built-in-functions",level:2},{value:"New built-in functions",id:"new-built-in-functions",level:2},{value:"Request and result interface",id:"request-and-result-interface",level:2},{value:"Gas changes",id:"gas-changes",level:2},{value:"Formal verification",id:"formal-verification",level:2},{value:"Parser fixes",id:"parser-fixes",level:2},{value:"Let-expressions binding multiple expressions to the same variable",id:"let-expressions-binding-multiple-expressions-to-the-same-variable",level:3},{value:"Invalid object types",id:"invalid-object-types",level:3},{value:"Binding lists missing commas",id:"binding-lists-missing-commas",level:3},{value:"Schemas are no longer allowed in terms",id:"schemas-are-no-longer-allowed-in-terms",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"migrating-to-pact-5",children:"Migrating to Pact 5"})}),"\n",(0,i.jsx)(n.p,{children:"The Pact programming language was designed to optimize the transactional logic in smart contracts executed in a resource-constrained blockchain environment.\nPact 5 represents a comprehensive refactoring of the Pact language and command-line interpreter that offers improvements in efficiency, performance, and ergonomics.\nThe improvements in Pact 5 ensure lower transaction costs, faster module loading, and enhanced testing and debugging capabilities.\nTo take advantage of these improvements, you need to update your development environment and smart contracts to use Pact 5.\nThis article covers the basics of upgrading to Pact 5 and details some of the breaking changes that might require you to update and redeploy existing contracts or fix potential coding errors."}),"\n",(0,i.jsx)(n.p,{children:"The timeline for migrating to Pact 5 looks like this:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Chainweb nodes will be upgraded to Pact 5 with the ",(0,i.jsx)(n.code,{children:"chainweb-node"})," 2.27 release on 29 January 2025."]}),"\n",(0,i.jsxs)(n.li,{children:["The Kadena main production network (",(0,i.jsx)(n.code,{children:"mainnet01"}),") will be upgraded to use Pact 5 on 10 February 2025."]}),"\n",(0,i.jsxs)(n.li,{children:["The Kadena test network (",(0,i.jsx)(n.code,{children:"testnet04"}),") will be upgraded to use Pact 5 on 6 February 2025."]}),"\n",(0,i.jsxs)(n.li,{children:["An interim test network (",(0,i.jsx)(n.code,{children:"testnet05"}),") is currently available for testing with Pact 5.\nThe ",(0,i.jsx)(n.code,{children:"testnet05"})," network will be decommissioned and removed from service on 7 February 2025 after the ",(0,i.jsx)(n.code,{children:"testnet04"})," network is upgraded to use Pact 5."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"preparing-to-migrate",children:"Preparing to migrate"}),"\n",(0,i.jsxs)(n.p,{children:["Ideally, you should test any smart contracts you've written by installing Pact 5 locally before Pact 5 is released on the Kadena main production network.\nIf you install Pact 5 locally in your development environment, you can run all of your existing contract tests that you've defined in REPL files using the Pact 5 binary to verify that they work as expected.\nFor information about installing the Pact 5 binary locally, see ",(0,i.jsx)(n.a,{href:"/smart-contracts/install",children:"Installation and setup"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["You can also test that existing smart contracts work with Pact 5 by deploying them on the Kadena ",(0,i.jsx)(n.code,{children:"testnet05"})," network.\nYou can connect to the ",(0,i.jsx)(n.code,{children:"testnet05"})," network by using the API node available at ",(0,i.jsx)(n.code,{children:"api.testnet05.chainweb.com"}),".\nFor examples of how to deploy contracts, see the ",(0,i.jsx)(n.a,{href:"/guides/contracts/howto-deploy-contracts",children:"Deploy smart contracts"})," guide."]}),"\n",(0,i.jsxs)(n.p,{children:["Pact 5 will also be deployed by default on the ",(0,i.jsx)(n.code,{children:"development"})," network that you can run locally beginning with the ",(0,i.jsx)(n.code,{children:"chainweb-node"})," 2.27 release.\nAfter ",(0,i.jsx)(n.code,{children:"chainweb-node"})," 2.27 is released, you can start a local development node to build and test contracts using Pact 5 by default."]}),"\n",(0,i.jsx)(n.h2,{id:"after-upgrading-to-pact-5",children:"After upgrading to Pact 5"}),"\n",(0,i.jsx)(n.p,{children:"Most smart contracts written in Pact 4, or earlier, should be compatible with Pact 5 and continue to operate as expected without any issues.\nHowever, some of the bugs that were found in earlier versions of Pact and corrected in the Pact 5 implementation might cause unexpected behavior in your contracts or require some type of modification to the contract code."}),"\n",(0,i.jsx)(n.p,{children:"You can find details about new features and the types of issues you might encounter in the remainder of this document."}),"\n",(0,i.jsx)(n.p,{children:"You don't need to redeploy any existing contracts to use Pact 5.\nHowever, redeploying will reduce the gas required to execute contract functions, because the newly-deployed version will use the Pact 5 on-disk format.\nPact 5 includes a new built-in function for redeploying contracts, so you can take advantage of reduced transaction costs without modifying any contract code or module hashes."}),"\n",(0,i.jsx)(n.h2,{id:"semantic-changes",children:"Semantic changes"}),"\n",(0,i.jsx)(n.p,{children:"Pact 5 includes some changes to correct previously allowed but unintended behavior.\nThese changes might require you to modify your smart contract to conform to Pact 5 that enforces expected behavior.\nCode examples illustrate the old behavior and how to modify your contract, if necessary."}),"\n",(0,i.jsx)(n.h3,{id:"duplicate-capabilities-cannot-be-installed",children:"Duplicate capabilities cannot be installed"}),"\n",(0,i.jsxs)(n.p,{children:["In Pact 4, you could install a managed capability with identical parameters multiple times and specify a different value for the managed parameter in each ",(0,i.jsx)(n.code,{children:"install-capability"})," expression.\nThis behavior was not the way the ",(0,i.jsx)(n.code,{children:"install-capability"})," was intended to be used.\nUsing the ",(0,i.jsx)(n.code,{children:"install-capability"})," function in this way didn't introduce any security issues because you can't install a capability to override a managed parameter specified in a signature.\nHowever, the code did result in unexpected behavior as illustrated in the following code sample:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'(module m g\n  (defcap g () true)\n\n  (defun cap-mgr (a:integer b:integer)\n    (let*\n     ((remaining (- a b)))\n     (enforce (>= remaining 0) "Remaining must be non-negative")\n     b\n     )\n  )\n  (defcap MANAGED (user:string amount:integer)\n    @managed amount cap-mgr\n    true\n    )\n\n  (defun managed-example (user:string amount:integer)\n    (with-capability\n      (MANAGED user amount)\n      "The capability was acquired successfully!"\n      )\n  )\n  )\n\n(install-capability (MANAGED "stuart" 1))\n(install-capability (MANAGED "stuart" 0))\n(managed-example "stuart" 1)\n'})}),"\n",(0,i.jsxs)(n.p,{children:["As illustrated in this example, Pact 4 allows you to install the ",(0,i.jsx)(n.code,{children:"MANAGED"})," capability twice, but it selects the lexicographically smallest managed parameter.\nIn this case, because ",(0,i.jsx)(n.code,{children:"0"})," comes before ",(0,i.jsx)(n.code,{children:"1"}),", so the ",(0,i.jsx)(n.code,{children:'(MANAGED "stuart" 0)'})," capability is selected instead of the ",(0,i.jsx)(n.code,{children:'(MANAGED "stuart" 1)'})," capability, leading to the following output:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'pact> (load "scratch/discreps/install-cap.repl" true)\n"Loading scratch/discreps/install-cap.repl..."\n"Loaded module m, hash oT9RPcfHZVhmCzHX3n51FKI0DC_Uwst06fqGQZu3hKI"\n"Installed capability"\n"Installed capability"\nscratch/discreps/install-cap.repl:8:5:Error: Remaining must be non-negative\n at scratch/discreps/install-cap.repl:8:5: (enforce (native `>=`  True if X >= Y.  Type: x:<a[integer,... "Remaining must be non-negative")\n at scratch/discreps/install-cap.repl:5:2: (cap-mgr 0 1)\n at scratch/discreps/install-cap.repl:18:4: (with-capability (m.MANAGED "stuart" 1) ["The capability was acquired successfully!"])\n at scratch/discreps/install-cap.repl:27:0: (managed-example "stuart" 1)\n'})}),"\n",(0,i.jsx)(n.p,{children:"Pact 5 does not allow installing duplicate capabilities, as shown below:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'pact> (load "scratch/discreps/install-cap.repl" true)\n"Loading scratch/discreps/install-cap.repl..."\nLoaded module m, hash gY4DlgJg2XkK6LPH1H81M5EhPohOSz9yd_sucAcRF9w\n"Installed capability"\nscratch/discreps/install-cap.repl:26:0: Capability already installed: (m.MANAGED "stuart" 0)\n 26 | (install-capability (MANAGED "stuart" 0))\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n'})}),"\n",(0,i.jsxs)(n.p,{children:["In most cases, you can correct this issue by simply deleting the invocation of ",(0,i.jsx)(n.code,{children:"install-capability"})," in your smart contracts because most managed capabilities are signed for, and thus implicitly installed."]}),"\n",(0,i.jsx)(n.h3,{id:"using-install-capability-is-only-supported-for-managed-capabilities",children:"Using install-capability is only supported for managed capabilities"}),"\n",(0,i.jsxs)(n.p,{children:["In Pact 4, you can use the ",(0,i.jsx)(n.code,{children:"install-capability"})," function with any capability, regardless of whether it is a managed capability.\nHowever, the sole purpose of this function is to track the value of a managed parameter.\nUsing this function with a capability that isn't a managed capability has no effect.\nThe following code is a minimal reproduction:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:"(module m g\n  (defcap g () true)\n  (defcap UNMANAGED () 1)\n  )\n\n(install-capability (UNMANAGED))\n"})}),"\n",(0,i.jsx)(n.p,{children:"If you execute this code in Pact 4, the output doesn't report this behavior as an error:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'pact> (load "scratch/discreps/unmanaged-install.repl" true)\n"Loading scratch/discreps/unmanaged-install.repl..."\n"Loaded module m, hash hha21FQe4BjRLJ4L5mfHLTBE18QhKFyf-hXlEF21g_Y"\n"Installed capability"\n'})}),"\n",(0,i.jsx)(n.p,{children:"To prevent mistakes, Pact 5 is more strict, disallowing this behavior:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'pact> (load "scratch/discreps/unmanaged-install.repl" true)\n"Loading scratch/discreps/unmanaged-install.repl..."\nLoaded module m, hash E4C8JfW1e6rIThBWNDw3GON0COvPQVqm3ZXOWT80iCI\nscratch/discreps/unmanaged-install.repl:7:0: Install capability error: capability is not managed and cannot be installed: m.UNMANAGED\n 7 | (install-capability (UNMANAGED))\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n'})}),"\n",(0,i.jsx)(n.h3,{id:"acquiring-module-administrator-privileges-for-operations",children:"Acquiring module administrator privileges for operations"}),"\n",(0,i.jsx)(n.p,{children:"Pact requires module administrator privileges to be acquired before performing the following operations:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Upgrading a module."}),"\n",(0,i.jsx)(n.li,{children:"Accessing or modifying a table."}),"\n",(0,i.jsxs)(n.li,{children:["Acquiring capabilities using the ",(0,i.jsx)(n.code,{children:"with-capability"})," function."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Pact 4 automatically attempts to acquire the module administrator privileges when executing these operations.\nTo prevent contracts from accidentally executing privileged actions, Pact 5 no longer automatically acquires the module administrator privileges except in the case of upgrading a module.\nTo acquire module administrator privileges explicitly, you can use the new ",(0,i.jsx)(n.code,{children:"acquire-module-admin"})," built-in function,\nThis change makes security boundaries between modules much clearer."]}),"\n",(0,i.jsxs)(n.p,{children:["For example, in the following contract code, the user Bob acquires module administrator privileges by writing directly to the table ",(0,i.jsx)(n.code,{children:"foo"})," and gives himself a balance of ",(0,i.jsx)(n.code,{children:"10000000000000"})," using Pact 4:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'; Uncomment the line when running with Pact 4\n; (env-exec-config ["DisablePact44"])\n(begin-tx)\n(env-data {"admin":{"keys":["some-key"], "pred":"keys-all"}})\n(define-keyset "admin" (read-keyset "admin"))\n\n(module m g\n  (defcap g () (enforce-guard (keyset-ref-guard "admin")))\n\n  (defschema fooschema user:string balance:integer)\n  (deftable foo:{fooschema})\n  )\n\n(create-table foo)\n(commit-tx)\n\n(begin-tx)\n(env-sigs [{"key":"some-key", "caps":[]}])\n; Admin is being acquired here automatically\n(write m.foo "bob" {"user":"bob", "balance":10000000000000})\n(commit-tx)\n'})}),"\n",(0,i.jsxs)(n.p,{children:["In this example, the administrator privileges are granted implicitly for the transaction that contains the ",(0,i.jsx)(n.code,{children:"write"})," function, and the result that gives Bob a balance of 10000000000000 coins might be difficult to spot.\nIn Pact 5, Bob must explicitly acquire the administrative rights for the module.\nFor example:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'(acquire-module-admin m)\n(write m.foo "bob" {"user":"bob", "balance":10000000000000})\n'})}),"\n",(0,i.jsxs)(n.p,{children:["By acquiring the administrative rights before sending the ",(0,i.jsx)(n.code,{children:'(write m.foo "bob" {"user":"bob", "balance":10000000000000})'})," transaction, it's clearer that the code is performing an administrative operation.\nNote that this change doesn't affect module deployment or upgrade transactions.\nModule administrator privileges are requested automatically to redeploy a module."]}),"\n",(0,i.jsx)(n.h3,{id:"module-hashing",children:"Module hashing"}),"\n",(0,i.jsx)(n.p,{children:"In Pact 4, the same contract code would always yield the same module hash.\nIn Pact 5, a module\u2019s hash is computed from both the module itself and the modules it depends on, increasing reliability and integrity.\nThe following REPL script illustrates this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:"(begin-tx)\n\n(module dependency g\n  (defcap g () true)\n  (defun f () 1)\n)\n\n(module m g \n  (defcap g () true)\n  (defun use-dependency ()\n    (f)\n  )\n)\n\n(commit-tx)\n\n(begin-tx)\n\n(module dependency g\n  (defcap g () true)\n  (defun f () 2)\n)\n\n(module m g \n  (defcap g () true)\n  (defun use-dependency ()\n    (f)\n  )\n)\n\n(commit-tx)\n"})}),"\n",(0,i.jsx)(n.p,{children:"The output for this code in Pact 4 looks like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'pact> (load "module-hashing.repl" true)\n"Loading scratch/discreps/module-hashing.repl..."\n"Begin Tx 0"\n"Loaded module dependency, hash QVQ9B6vNg3TNBrLeDH2jR7geVvFGPPHd6OOXthb6k_k"\n"Loaded module m, hash tyMLK_Kg71M2QSEHEJOZn8Q3x9KV_Wj0ldpkyTTwOEE"\n"Commit Tx 0"\n"Begin Tx 1"\n"Loaded module dependency, hash zp3ZGRtmIeLSZnFsDuhqhsqJ3zcbnQ--R5wSjWCJJXA"\n"Loaded module m, hash tyMLK_Kg71M2QSEHEJOZn8Q3x9KV_Wj0ldpkyTTwOEE"\n"Commit Tx 1"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Notice that despite the change in the hash of ",(0,i.jsx)(n.code,{children:"dependency"}),", the hash for the ",(0,i.jsx)(n.code,{children:"m"}),"  module doesn't change.\nThis is no longer the case in Pact 5.\nIn Pact 5, the output for this code looks like this:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'pact> (load "module-hashing.repl" true)\n"Loading scratch/discreps/module-hashing.repl..."\n"Begin Tx 0"\nLoaded module dependency, hash YTZXSZChVLwUJkpm3_dSzidkfVB14Y8smFf7x1CfukY\nLoaded module m, hash 5BpfxcjVb4usVyuLg25bk821RL_u9raD8e76U2zfS3M\n"Commit Tx 0"\n"Begin Tx 1"\nLoaded module dependency, hash L9gxBgNRNESJIqS0wZN3xDAcuRa1IC3-yNN03mtFttQ\nLoaded module m, hash D45G9PizSn59QTRyUObLesCM9IEf_xrIM5OlpgQXxQg\n"Commit Tx 1"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["In the Pact 5 output, the hash for the ",(0,i.jsx)(n.code,{children:"m"})," module reflects the change in the dependencies.\nThis change is required for integrity, because otherwise, modules with the same hash can behave differently."]}),"\n",(0,i.jsx)(n.h3,{id:"function-names-and-variable-identifiers",children:"Function names and variable identifiers"}),"\n",(0,i.jsxs)(n.p,{children:["In Pact 4, it was possible to use variable identifiers with the same name as built-in functions.\nFor example, in Pact 4, you can write a function like the following that uses ",(0,i.jsx)(n.code,{children:"identity"})," as a variable identifier:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:"(defun register-identity:bool (user-address:string user-guard:guard identity:string country:integer)\n   ...\n)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["However, ",(0,i.jsx)(n.code,{children:"identity"})," is a reserved keyword for a built-in function.\nIn Pact 4, you are allowed to override or shadow the function name.\nPact 5 doesn't allow this behavior, and variables that use the same name as a built-in function resolve as the built-in function.\nIf you use any variable identifiers with the same name as a built-in function name, you should modify the variable identifier to use a different name if you want to redeploy the contract as a Pact 5 contract."]}),"\n",(0,i.jsxs)(n.p,{children:["For a list of the reserved built-in function names, see ",(0,i.jsx)(n.a,{href:"/pact-5/func-quick-ref",children:"Function quick reference"}),".\nFor a list of reserved keywords, see ",(0,i.jsx)(n.a,{href:"/reference/syntax",children:"Syntax and keywords"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"integers-returned-as-objects",children:"Integers returned as objects"}),"\n",(0,i.jsxs)(n.p,{children:["In Pact 5, functions that return integer values return an object with ",(0,i.jsx)(n.code,{children:"int"})," as the key field and a number as a string or a JSON number.\nFor example, you might see a return value similar to the following:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'result: {status: "success", data: {int: 1}}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["According to the Pact specification for encoding and decoding values, if you return a raw JSON number without the ",(0,i.jsx)(n.code,{children:"int"})," field, the value is a double.\nIf a function returns an object with the ",(0,i.jsx)(n.code,{children:"int"})," field and a number, the value is an integer."]}),"\n",(0,i.jsx)(n.p,{children:"In Pact 4, integer values that were returned as objects were silently converted to doubles in results.\nThe silent conversion of integers to doubles caused tests that were written to expect integer values to fail."}),"\n",(0,i.jsxs)(n.p,{children:["In Pact 5, values are returned as described by the Pact codec.\nInteger values are always returned as objects ",(0,i.jsx)(n.code,{children:"{int: X}"})," and raw JSON numbers are always interpreted as doubles."]}),"\n",(0,i.jsx)(n.h2,{id:"changed-or-removed-built-in-functions",children:"Changed or removed built-in functions"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pact-version"})," was usable in the REPL and with the ",(0,i.jsx)(n.code,{children:"/local"})," endpoint to determine the current Pact version. It was removed in Pact 5 due to time constraints."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"enforce-pact-version"})," was usable in the REPL and with the ",(0,i.jsx)(n.code,{children:"/local"})," endpoint to assert on the current Pact version. It was removed in Pact 5 due to time constraints."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"list"})," was removed in Pact 5 after it was deprecated with a warning and increased gas costs in Pact 4. ",(0,i.jsx)(n.code,{children:"(list 1 2 3)"})," is equivalent to ",(0,i.jsx)(n.code,{children:"[1 2 3]"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"decrypt-cc20p1305"})," and ",(0,i.jsx)(n.code,{children:"validate-keypair"})," have been removed in Pact 5 due to time constraints and lack of users."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"constantly"})," has changed in Pact 5. It now accepts exactly two arguments, and behaves as if it were ",(0,i.jsx)(n.code,{children:"(lambda (x y) x)"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"txlog"})," was removed in Pact 5 due to time constraints and lack of users."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"new-built-in-functions",children:"New built-in functions"}),"\n",(0,i.jsx)(n.p,{children:"The following functions are new in Pact 5."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"do"})," is a new special form that you can use to sequence statements. For example:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'(do\n  (enforce (= 1 2) "")\n  (enforce (= 3 4) ""))\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"acquire-module-admin"})," is a new function that you can use to explicitly acquire module administrator privileges as described in ",(0,i.jsx)(n.a,{href:"#acquiring-module-administrator-privileges-for-operations",children:"Acquiring module administrator privileges for operations"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"static-redeploy"})," is a new function that you can use to redeploy existing modules into their Pact 5 format, making them cheaper and faster to load, without changing the contract code or updating the contract dependencies.\nNote that the use of this function is not a privileged operation.\nAnyone can do it to any module, and the module hash remains the same."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"request-and-result-interface",children:"Request and result interface"}),"\n",(0,i.jsx)(n.p,{children:"In general, Pact 4 and Pact 5 command requests and command results can be parsed successfully by the Pact 5 parser as follows:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Existing Pact 4 command requests can be parsed as Pact 5 commands, and Pact 5 command requests can be parsed as Pact 4 commands."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Pact 4 command results can be parsed as Pact 5 command results."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Successful Pact 5 command results can be parsed as Pact 4 command results."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Pact 5 command results with errors are not valid Pact 4 command results because the error format has changed.\nErrors in Pact 5 include both a textual description of the error, and a hexadecimal error code to distinguish the exact error case.\nThe ",(0,i.jsx)(n.code,{children:"pact"})," executable in Pact 5 can explain these error codes using the ",(0,i.jsx)(n.code,{children:"--explain-error-code"})," option, but they can lack some more specific information from the textual error message.\nFor example:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"> pact --explain-error-code 0x0000000000000000\nEncountered failure in: PELexerError, caused by: LexicalError\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"gas-changes",children:"Gas changes"}),"\n",(0,i.jsx)(n.p,{children:"Because the Pact interpreter has been structurally changed, Pact 5 has different gas costs than Pact 4.\nPact 5 also uses more precise methods to determine the gas costs for certain built-in functions."}),"\n",(0,i.jsxs)(n.p,{children:["In practice, most functions require less gas when executed with Pact 5.\nHowever, the only way to be sure your transactions don't exceed gas limits is to test them using Pact 5, either by running smart contracts on ",(0,i.jsx)(n.code,{children:"testnet05"}),", or by executing functions locally in a Pact 5 REPL."]}),"\n",(0,i.jsxs)(n.p,{children:["In addition to lower gas costs, Pact 5 is stricter in checking the signature used to buy gas.\nIn Pact 4, you could successfully sign for the ",(0,i.jsx)(n.code,{children:"coin.GAS"})," capability even if you included extra arguments, such as ",(0,i.jsx)(n.code,{children:'(coin.GAS "")'})," or ",(0,i.jsx)(n.code,{children:"(coin.GAS 1)"}),".\nIn Pact 5, you can only sign for the ",(0,i.jsx)(n.code,{children:"coin.GAS"})," capability with ",(0,i.jsx)(n.code,{children:"(coin.GAS)"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"formal-verification",children:"Formal verification"}),"\n",(0,i.jsx)(n.p,{children:"The Pact 4 formal verification system is tightly coupled to the internal implementation of Pact 4.\nBecause Pact 5 is a complete re-implementation of the Pact language and command-line interpreter, Pact 5 doesn't support the Pact 4 formal verification system.\nA new formal verification system compatible with Pact 5 isn't available at this time.\nHowever, plans for improving or simplifying formal verification for Pact 5 contracts have been discussed and remain under consideration."}),"\n",(0,i.jsx)(n.h2,{id:"parser-fixes",children:"Parser fixes"}),"\n",(0,i.jsx)(n.p,{children:"In Pact 4, parser bugs allowed some syntactically invalid code to be parsed.\nExecuting this invalid code often caused unexpected behavior.\nThis section describes the most common syntactic errors that were found on-chain that are now disallowed by Pact 5, and how to fix them."}),"\n",(0,i.jsx)(n.h3,{id:"let-expressions-binding-multiple-expressions-to-the-same-variable",children:"Let-expressions binding multiple expressions to the same variable"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:'(let ((x 1 (enforce false "boom"))) x)'})}),"\n",(0,i.jsxs)(n.p,{children:["This is syntactically incorrect, as each let-bound variable can only bind one expression.\nIn Pact 4, this code is parsed successfully, with the result that ",(0,i.jsx)(n.code,{children:'(enforce false "boom")'})," is never evaluated."]}),"\n",(0,i.jsx)(n.h3,{id:"invalid-object-types",children:"Invalid object types"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"(defun f (a:object:{some-schema}) ...)"})}),"\n",(0,i.jsxs)(n.p,{children:["The correct syntax for object types is ",(0,i.jsx)(n.code,{children:"object{schema}"})," where ",(0,i.jsx)(n.code,{children:"schema"})," is a user-defined schema, not ",(0,i.jsx)(n.code,{children:"object:{schema}"}),".\nIn Pact 4, this will lead to errors at runtime when invoking ",(0,i.jsx)(n.code,{children:"f"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"binding-lists-missing-commas",children:"Binding lists missing commas"}),"\n",(0,i.jsxs)(n.p,{children:["In the following module, the expression ",(0,i.jsx)(n.code,{children:'(with-read my-table "k" { "a" := a b := b} 1)'})," is missing a comma between the bindings of the ",(0,i.jsx)(n.code,{children:"a"})," and ",(0,i.jsx)(n.code,{children:"b"})," variables:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'(module m g \n  (defcap g () true) \n  (defschema s a:integer) \n  (deftable my-table:{s}) \n  (defun f () (with-read my-table "k" { "a" := a b := b} a))\n  )\n'})}),"\n",(0,i.jsx)(n.p,{children:"To fix this issue, add the comma to the expression.\nFor example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'{ "a" := a, "b\' := b }\n'})}),"\n",(0,i.jsx)(n.h3,{id:"schemas-are-no-longer-allowed-in-terms",children:"Schemas are no longer allowed in terms"}),"\n",(0,i.jsx)(n.p,{children:"In Pact, a schema is essentially a type definition for an object type.\nThe schema type itself is not a value.\nThe following example is thus invalid:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-markdown",children:'(module m g\n  (defcap g () true)\n\n  (defschema location city:string)\n\n  (deftable locations:{location})\n\n  (defun get-city(entry:string)\n    (at "city" (read location entry))\n    )\n  )\n'})}),"\n",(0,i.jsxs)(n.p,{children:["In this example, the user intended to read the location at ",(0,i.jsx)(n.code,{children:"entry"})," from the table ",(0,i.jsx)(n.code,{children:"locations"}),", but instead wrote ",(0,i.jsx)(n.code,{children:"location"}),", which is the schema.\nIt\u2019s not uncommon for a user to name a schema in a similar fashion as the table that holds object of that schema.\nIn Pact 4, this code can be deployed, and leads to a hard-to-debug issue with a strange error message.\nIn Pact 5, this code cannot be deployed at all."]}),"\n",(0,i.jsx)(n.p,{children:"Running the above code with Pact 4 results in the following output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'pact> (load "scratch/discreps/schemas-in-term.repl" true)\n"Loading scratch/discreps/schemas-in-term.repl..."\n"Loaded module m, hash 2SkSSD_LJqjZUSVxaqyXP7BYhP7Zl-D93awJPQeDHOM"\n'})}),"\n",(0,i.jsx)(n.p,{children:"In Pact 5, the code output looks like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pact",children:'pact>(load "scratch/discreps/schemas-in-term.repl" true)\n"Loading scratch/discreps/schemas-in-term.repl..."\nscratch/discreps/schemas-in-term.repl:9:21: Invalid definition in term variable position: location\n 9 |     (at "city" (read location entry))\n   |                      ^^^^^^^^\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>r});var a=t(96540);const i={},s=a.createContext(i);function c(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);