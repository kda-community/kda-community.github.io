"use strict";(self.webpackChunkkadena_docs=self.webpackChunkkadena_docs||[]).push([[2941],{71053:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"guides/contracts/howto-call-functions","title":"Call contract functions","description":"A guide to crafting blockchain calls using Traditional API, Kadena CLI, and Kadena.js","source":"@site/docs/guides/contracts/call-contract-functions.mdx","sourceDirName":"guides/contracts","slug":"/guides/contracts/howto-call-functions","permalink":"/docs/guides/contracts/howto-call-functions","draft":false,"unlisted":false,"editUrl":"https://github.com/kda-community/kadena-docs-new/blob/master/docs/guides/contracts/call-contract-functions.mdx","tags":[],"version":"current","frontMatter":{"title":"Call contract functions","description":"A guide to crafting blockchain calls using Traditional API, Kadena CLI, and Kadena.js","id":"howto-call-functions"},"sidebar":"default","previous":{"title":"Deploy smart contracts","permalink":"/docs/guides/contracts/howto-deploy-contracts"},"next":{"title":"Construct transactions","permalink":"/docs/guides/transactions/howto-construct-tx"}}');var c=t(74848),s=t(28453);const i={title:"Call contract functions",description:"A guide to crafting blockchain calls using Traditional API, Kadena CLI, and Kadena.js",id:"howto-call-functions"},o="Call contract functions",r={},l=[{value:"Using a YAML request and curl",id:"using-a-yaml-request-and-curl",level:2},{value:"Using kadena-cli commands",id:"using-kadena-cli-commands",level:2},{value:"Using the Kadena client library",id:"using-the-kadena-client-library",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"call-contract-functions",children:"Call contract functions"})}),"\n",(0,c.jsx)(n.p,{children:"Every interaction with the blockchain involves the same basic steps:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Connecting to an appropriate network endpoint for the development, test, or main network that you want to interact with."}),"\n",(0,c.jsx)(n.li,{children:"Providing a payload with your request that's properly formatted and contains all of the information required to complete any particular task."}),"\n",(0,c.jsx)(n.li,{children:"Signing the transaction with a valid key that has whatever permissions a specific task might require."}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"There's little difference between interacting with the blockchain directly through the API or through an abstraction layer such as the Kadena CLI or Kadena.js libraries.\nThe difference is primarily a matter of preference about how you want to deliver the request.\nHowever, when you are calling functions, you might want to consider whether you want to make a local request or send the request to the blockchain."}),"\n",(0,c.jsxs)(n.p,{children:["In many cases, sending the request to the ",(0,c.jsx)(n.code,{children:"/local"})," endpoint has advantages over sending the request to the network using the ",(0,c.jsx)(n.code,{children:"/send"})," endpoint.\nThis guide provides examples for calling functions using both endpoints and using curl, the Kadena CLI, and the Kadena.js client libraries."]}),"\n",(0,c.jsx)(n.h2,{id:"using-a-yaml-request-and-curl",children:"Using a YAML request and curl"}),"\n",(0,c.jsxs)(n.p,{children:["If you want to call a function that modifies informatipon stored in the blockchain, you should make the transaction request using the ",(0,c.jsx)(n.code,{children:"/send"})," endpoint.\nIf you want to call a function that reads information from the blockchain, you should make the transaction request using the ",(0,c.jsx)(n.code,{children:"/local"})," endpoint.\nFor example, the free.vote-topics contract has three functions: ",(0,c.jsx)(n.code,{children:"init"}),", ",(0,c.jsx)(n.code,{children:"vote"}),", and ",(0,c.jsx)(n.code,{children:"getVotes"}),".\nThe ",(0,c.jsx)(n.code,{children:"init"})," and ",(0,c.jsx)(n.code,{children:"vote"})," functions modify the ",(0,c.jsx)(n.code,{children:"votes"})," table, so they should be called using the ",(0,c.jsx)(n.code,{children:"/send"})," endpoint.\nThe ",(0,c.jsx)(n.code,{children:"getVotes"})," function reads information from the table, so it can be called using the ",(0,c.jsx)(n.code,{children:"/local"})," endpoint."]}),"\n",(0,c.jsxs)(n.p,{children:["To call the ",(0,c.jsx)(n.code,{children:"init"})," function using a ",(0,c.jsx)(n.code,{children:"curl"})," command and ",(0,c.jsx)(n.code,{children:"/send"})," endpoint:"]}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"Generate a random public and secret key pair and save them to a file."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"pact --genkey > pistolas.yaml\n"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"Construct the transaction using the YAML transaction request format for an unsigned transaction."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'code: |-\n  (free.simple-vote.init)\ndata:\n  ks: {\n   keys: ["3bdb1d3c48a1bb5f072b067e265ce5d9a5eabf5e290128be4d2623dd559ca698"],\n   pred: "keys-all"\n  }\npublicMeta:\n  chainId: "3"\n  sender: "pact-generated-key"\n  gasLimit: 63000\n  gasPrice: 0.00000001\n  ttl: 900\nsigners:\n  - public: 3bdb1d3c48a1bb5f072b067e265ce5d9a5eabf5e290128be4d2623dd559ca698\n    caps: []\nnetworkId: "development"\ntype: exec\n'})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"Prepare the YAML transaction request to be signed."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"pact --unsigned call-init-signers.yaml > tx-init.yaml\n"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"Add a signature from your randomly-generated key pair and convert the request to a valid JSON object."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cat tx-init.yaml | pact add-sig pistolas.yaml > tx-signed-init.json\n"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Use ",(0,c.jsx)(n.code,{children:"curl"})," to connect to the ",(0,c.jsx)(n.code,{children:"/send"})," endpoint on the ",(0,c.jsx)(n.code,{children:"development"}),", ",(0,c.jsx)(n.code,{children:"testnet04"})," or ",(0,c.jsx)(n.code,{children:"mainnet01"})," network."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'curl -X POST -H "Content-Type: application/json" -d "@tx-signed-init.json" http://localhost:8080/chainweb/0.0/development/chain/3/pact/api/v1/send\n'})}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["To call the ",(0,c.jsx)(n.code,{children:"getVotes"})," function using a ",(0,c.jsx)(n.code,{children:"curl"})," command and ",(0,c.jsx)(n.code,{children:"/local"})," endpoint:"]}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"Construct the transaction using the YAML transaction request format for an unsigned transaction."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'code: |-\n  (free.simple-vote.getVotes "A")\ndata:\npublicMeta:\n  chainId: "3"\n  sender: "pact-generated-key"\n  gasLimit: 63000\n  gasPrice: 0.00000001\n  ttl: 900\nnetworkId: "development"\ntype: exec\n'})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Format the request and use ",(0,c.jsx)(n.code,{children:"curl"})," to connect to the ",(0,c.jsx)(n.code,{children:"/local"})," endpoint on the ",(0,c.jsx)(n.code,{children:"development"}),", ",(0,c.jsx)(n.code,{children:"testnet04"})," or ",(0,c.jsx)(n.code,{children:"mainnet01"})," network."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'pact --apireq simple-call.yaml --local | curl -X POST -H "Content-Type: application/json" \\\n     --json @- http://localhost:8080/chainweb/0.0/development/chain/3/pact/api/v1/local\n'})}),"\n",(0,c.jsxs)(n.p,{children:["The command returns the result from the ",(0,c.jsx)(n.code,{children:"/local"}),' endpoint.\nIn this example, five votes have been recorded for topic "A".']}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'{"gas":18,"result":{"status":"success","data":5},"reqKey":"tg201pWYbHUdh3umkbKEeKyvRjWycBQlZSDcrCwasts",...}\n'})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"using-kadena-cli-commands",children:"Using kadena-cli commands"}),"\n",(0,c.jsxs)(n.p,{children:["With the ",(0,c.jsx)(n.code,{children:"kadena-cli"}),", you can construct a transaction template to call functions in smart contracts.\nYou can then customize the transactions to call the same function on different chains or different networks.\nDepending on how you create your template, you can also use it to call different types of functions with interactive prompting for values or by setting command-line options."]}),"\n",(0,c.jsxs)(n.p,{children:["To call a smart contract function using ",(0,c.jsx)(n.code,{children:"kadena-cli"}),":"]}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Create a ",(0,c.jsx)(n.code,{children:"call-function.ktpl"})," template file with the template variables for calling a function."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'call-function.yaml - YAML configuration for executing a smart contract function\ncode: |-\n    {{namespace.module.function args}}\ndata:\npublicMeta:\n  chainId: "{{chain-id}}"\n  sender: "{{{account-name}}}"\n  gasLimit: 80300\n  gasPrice: 0.000001\n  ttl: 600\nnetworkId: "{{network-id}}"\nsigners:\n - public: "{{public-key}}"\n   caps: []\ntype: exec\n'})}),"\n",(0,c.jsxs)(n.p,{children:["For convenience, you can move the ",(0,c.jsx)(n.code,{children:"deploy-contract.ktpl"})," template to the ",(0,c.jsx)(n.code,{children:".kadena/transaction-templates"})," directory, so that the template is listed when you add transactions with interactive prompting."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Create a new unsigned transaction using the ",(0,c.jsx)(n.code,{children:"kadena tx add"})," command and the ",(0,c.jsx)(n.code,{children:"call-function.ktpl"})," template and follow the prompts displayed to set the appropriate information."]}),"\n",(0,c.jsxs)(n.p,{children:["For example, the prompts and output for calling the ",(0,c.jsx)(n.code,{children:"vote"})," function look similar to the following:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'? Which template do you want to use: call-function.ktpl\n? File path of data to use for template .json or .yaml (optional):\n? Template value namespace.module.function args:  (free.vote-topics.vote "B")\n? Template value chain-id: 3\n? Template value account-name: k:58705e8699678bd15bbda2cf40fa236694895db614aafc82cf1c06c014ca963c\n? Template value network-id: development\n? Template value public-key: 58705e8699678bd15bbda2cf40fa236694895db614aafc82cf1c06c014ca963c\n? Where do you want to save the output: test-vote-2\n'})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Sign the unsigned transaction using the ",(0,c.jsx)(n.code,{children:"kadena tx sign"})," command and the transaction file name generated by the ",(0,c.jsx)(n.code,{children:"kadena tx add"})," command."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Send the signed transaction using the ",(0,c.jsx)(n.code,{children:"kadena tx send"})," command and the signed transaction file name generated by the ",(0,c.jsx)(n.code,{children:"kadena tx sign"})," command."]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["You can use the same template to call the ",(0,c.jsx)(n.code,{children:"getVotes"})," function and use ",(0,c.jsx)(n.code,{children:"kadena tx test"})," to test the function call results."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"kadena tx add\nkadena tx sign\nkadena tx test\n"})}),"\n",(0,c.jsx)(n.h2,{id:"using-the-kadena-client-library",children:"Using the Kadena client library"}),"\n",(0,c.jsxs)(n.p,{children:["If you're familiar with JavaScript or TypeScript, you can use the ",(0,c.jsx)(n.code,{children:"@kadena/client"})," library to write scripts for common tasks.\nThe ",(0,c.jsx)(n.code,{children:"@kadena/client"})," library implements a TypeScript-based API for interacting with smart contracts and Chainweb nodes.\nThe library provides functions that simplify building transactions with Pact commands and connecting to blockchain nodes."]}),"\n",(0,c.jsxs)(n.p,{children:["You should note that creating the client connection is separate from using the ",(0,c.jsx)(n.code,{children:"Pact.builder"})," function to construct transactions.\nThis example calls the ",(0,c.jsx)(n.code,{children:"greet"})," function defined in the ",(0,c.jsx)(n.code,{children:"simplemodule"})," that's been deployed in the ",(0,c.jsx)(n.code,{children:"free"})," namespace on the ",(0,c.jsx)(n.code,{children:"testnet04"})," network."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"import { Pact, createClient } from '@kadena/client';\n\nconst client = createClient();\n\nconst command = async (functionName: string) => {\n  const unsignedTransaction = Pact.builder\n    .execution(functionName)\n    .setMeta({\n      chainId: '1',\n      gasLimit: 2500,\n    })\n    .setNetworkId('testnet04')\n    .createTransaction();\n\n  try {\n    const res = await client.dirtyRead(unsignedTransaction);\n    if (res.result.status === 'success') {\n      console.log(res.result.data);\n      return res.result.data;\n    } else {\n      console.log('No data returned:', res);\n    }\n  } catch (error) {\n    console.error('Error with dirtyRead or data processing:', error);\n  }\n\n  try {\n    const res = await client.dirtyRead(unsignedTransaction);\n    if (res.result.status === 'success') {\n      console.log(res.result.data);\n      return res.result.data;\n    } else {\n      console.log('No data returned:', res);\n    }\n  } catch (error) {\n    console.error('Error with dirtyRead or data processing:', error);\n  }\n};\n\ncommand('(free.simplemodule.greet)').catch(console.error);\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var a=t(96540);const c={},s=a.createContext(c);function i(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);