"use strict";(self.webpackChunkkadena_docs=self.webpackChunkkadena_docs||[]).push([[7874],{96019:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"coding-projects/conditions-control","title":"Conditions and control flow","description":"This coding project demonstrates how to write conditional statements and control the order in which statements and instructions are evaluated and executed in Pact smart contracts.","source":"@site/docs/coding-projects/conditions-control.md","sourceDirName":"coding-projects","slug":"/coding-projects/conditions-control","permalink":"/docs/coding-projects/conditions-control","draft":false,"unlisted":false,"editUrl":"https://github.com/kda-community/kadena-docs-new/blob/master/docs/coding-projects/conditions-control.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"title":"Conditions and control flow","description":"This coding project demonstrates how to write conditional statements and control the order in which statements and instructions are evaluated and executed in Pact smart contracts.","id":"conditions-control","sidebar_position":9},"sidebar":"default","previous":{"title":"Pact built-in server","permalink":"/docs/coding-projects/pact-server-api"},"next":{"title":"Resources","permalink":"/docs/resources/"}}');var s=t(74848),i=t(28453);const c={title:"Conditions and control flow",description:"This coding project demonstrates how to write conditional statements and control the order in which statements and instructions are evaluated and executed in Pact smart contracts.",id:"conditions-control",sidebar_position:9},a="Conditions and control flow",r={},d=[{value:"Before you begin",id:"before-you-begin",level:2},{value:"Get the starter code",id:"get-the-starter-code",level:2},{value:"Using if expressions",id:"using-if-expressions",level:2},{value:"Using enforce expressions",id:"using-enforce-expressions",level:2},{value:"Using cond expressions",id:"using-cond-expressions",level:2},{value:"Comparing if and enforce expressions",id:"comparing-if-and-enforce-expressions",level:2},{value:"Testing contract functions",id:"testing-contract-functions",level:2}];function l(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"conditions-and-control-flow",children:"Conditions and control flow"})}),"\n",(0,s.jsxs)(n.p,{children:["Most programming languages provide several ways you can control how operations are executed in a program.\nFor example, you can use ",(0,s.jsx)(n.strong,{children:"conditional expressions"})," to execute a specific set of instructions only if a specific condition is met or to iterate through a set of instructions a given number of times, until some condition is met.\nThe most common control structures include the following:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Conditional statements that use ",(0,s.jsx)(n.code,{children:"if"})," to evaluate a condition and execute one set of instructions if the condition is true, and, optionally, a different set of instructions if the condition is false."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Conditional statements that use ",(0,s.jsx)(n.code,{children:"switch"})," to execute different sets of instructions based on the value of a variable or expression."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Loops that use ",(0,s.jsx)(n.code,{children:"for"})," to execute a block of code a fixed number of times."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Loops that use ",(0,s.jsx)(n.code,{children:"while"})," to execute a block of code as long as a specified condition remains true."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Many programming languages also support control flow keywords\u2014such as the ",(0,s.jsx)(n.code,{children:"break"}),", ",(0,s.jsx)(n.code,{children:"continue"}),", and ",(0,s.jsx)(n.code,{children:"return"})," keywords\u2014that enable you to stop execution, skip program statements, or return a value to a calling function.\nHowever, conditional statements, loops, and other patterns that you can use to control the execution of a program's logic also often increase the complexity of the program and the additional complexity can result in unexpected consequences or programming errors."]}),"\n",(0,s.jsx)(n.p,{children:"To make smart contracts simpler and safer to write, Pact only supports bounded loops and a limited set of conditional control structures.\nIn Pact, you can write conditional logic to control program execution using the following language features:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"if"})," expressions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"enforce"})," expressions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"cond"})," expressions"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This coding project illustrates how to write simpler and safer smart contracts using these conditional expressions."}),"\n",(0,s.jsx)(n.h2,{id:"before-you-begin",children:"Before you begin"}),"\n",(0,s.jsx)(n.p,{children:"Before starting this project, verify your environment meets the following basic requirements:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["You have a GitHub account and can run ",(0,s.jsx)(n.code,{children:"git"})," commands."]}),"\n",(0,s.jsxs)(n.li,{children:["You have installed the ",(0,s.jsx)(n.a,{href:"/smart-contracts/install",children:"Pact"})," programming language and command-line interpreter."]}),"\n",(0,s.jsxs)(n.li,{children:["You have installed the ",(0,s.jsx)(n.a,{href:"/smart-contracts/install/tooling#kadena-command-line-interface",children:(0,s.jsx)(n.code,{children:"kadena-cli"})})," package and have a working directory with initial configuration settings."]}),"\n",(0,s.jsxs)(n.li,{children:["You have a ",(0,s.jsx)(n.a,{href:"/smart-contracts/install/local-dev-node",children:"local development"})," node that you can connect to that runs the ",(0,s.jsx)(n.code,{children:"chainweb-node"})," program, either in a Docker container or on a physical or virtual computer."]}),"\n",(0,s.jsxs)(n.li,{children:["You should be familiar with defining ",(0,s.jsx)(n.a,{href:"/smart-contracts/modules",children:"modules"})," and using keysets."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"get-the-starter-code",children:"Get the starter code"}),"\n",(0,s.jsx)(n.p,{children:"To get started:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Open a terminal shell on your computer."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Clone the ",(0,s.jsx)(n.code,{children:"pact-coding-projects"})," repository by running the following command:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/kadena-docs/pact-coding-projects.git\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Change to the ",(0,s.jsx)(n.code,{children:"08-control-flow"})," directory by running the following command:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cd pact-coding-projects/08-control-flow\n"})}),"\n",(0,s.jsx)(n.p,{children:"If you list the contents of this directory, you'll see the following files:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"starter-control-flow.pact"})," provides a starting point with the framework for the project code and comments for every challenge."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"final-control-flow.pact"})," contains the final solution code with examples of using ",(0,s.jsx)(n.code,{children:"if"}),", ",(0,s.jsx)(n.code,{children:"enforce"}),", and c",(0,s.jsx)(n.code,{children:"ond"})," expressions."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"final-control-flow.repl"})," provides test cases for testing the functions defined in the my-coin module and for comparing the results from testing ",(0,s.jsx)(n.code,{children:"if"})," expressions and ",(0,s.jsx)(n.code,{children:"enforce"})," expressions."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Open and review the ",(0,s.jsx)(n.code,{children:"starter-control-flow"})," file."]}),"\n",(0,s.jsxs)(n.p,{children:["This file describes all of the tasks that you need to complete for the ",(0,s.jsx)(n.em,{children:"Conditions and control flow"})," coding project.\nYou can follow the instructions embedded in the file to try to tackle this coding project on your own without looking at the solutions to each step, or follow the instructions in the next sections if you need additional guidance."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"using-if-expressions",children:"Using if expressions"}),"\n",(0,s.jsxs)(n.p,{children:["In general, you should only use ",(0,s.jsx)(n.code,{children:"if"})," expressions when you want to invoke conditional branches depending on whether a certain condition is true or false.\nFor example, you might have an application that allows users to collect points and unlock a VIP access code when they've collect a required number of points, that is, the required number of points evaluates to true.\nFor users who don't have the required number of points, you might want to display a message indicating the number of points still needed to unlock the VIP access code.\nIn this example, there are two possible code paths:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["If ",(0,s.jsx)(n.code,{children:"points => required_points"})," is ",(0,s.jsx)(n.code,{children:"true"}),', display a "Congratulations!" message if a user has unlocked the VIP access code.']}),"\n",(0,s.jsxs)(n.li,{children:["If ",(0,s.jsx)(n.code,{children:"points => required_points"})," is ",(0,s.jsx)(n.code,{children:"false"}),', display a "Sorry, you need more points" message and the number of points still needed for VIP access.']}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["For this application, you don't want to stop execution because a condition is false.\nInstead, you want provide different messages and, potentially, different behaviors based on whether the ",(0,s.jsx)(n.code,{children:"if"})," condition evaluates to true or false.\nThe following code snippet illustrates how you might write a function that uses an ",(0,s.jsx)(n.code,{children:"if"})," statement to provide similar behavior in Pact:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-pact",children:'(defconst VIP_UNLOCK 10)\n  \n(defun unlock-access:string (user:string contribution:integer)\n  (with-read my-points-table user\n    { "balance" := access-points }\n    (update my-points-table user\n    { "balance" : (+ access-points contribution)})\n      (if (>= access-points VIP_UNLOCK)\n        (format "Congratulations! You have {} points and unlocked VIP access." [access-points])\n        (format "Sorry, you need {} more points to unlock!" [(- VIP_UNLOCK access-points)])\n      )\n  )\n)\n'})}),"\n",(0,s.jsx)(n.h2,{id:"using-enforce-expressions",children:"Using enforce expressions"}),"\n",(0,s.jsxs)(n.p,{children:["You should use ",(0,s.jsx)(n.code,{children:"enforce"})," statements when you want to ensure a specific condition is met and ",(0,s.jsx)(n.strong,{children:"stop any further execution"})," if the condition is false.\nBecause ",(0,s.jsx)(n.code,{children:"enforce"})," statements prevent transactions from continuing instead of providing a conditional branch, they can provide a safer alternative to ",(0,s.jsx)(n.code,{children:"if"})," statements in smart contracts that execute business transactions.\nFor example, if you're writing a ",(0,s.jsx)(n.code,{children:"debit"})," function to subtract a specified ",(0,s.jsx)(n.code,{children:"amount"})," from the ",(0,s.jsx)(n.code,{children:"balance"})," for a specified ",(0,s.jsx)(n.code,{children:"account"}),", you could use an ",(0,s.jsx)(n.code,{children:"if"})," statement to check whether the ",(0,s.jsx)(n.code,{children:"balance"})," is sufficient for the operation to continue."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-pact",children:'   ;; Debit using if\n  (defun debit:string (account:string amount:decimal)\n    @doc "Debit amount from account balance"\n\n    ;; Read the "balance" for the account and bind the value to a variable\n      (with-read my-coin-table account\n        { "balance" := balance }\n\n        ;; Check if "balance" is sufficient for the amount to debit\n        (if (> balance amount)\n\n          ;; If condition is true, update my-coin-table\n          (update my-coin-table account\n            { "balance" : (- balance amount) })\n\n          ;; If condition is false, print message\n          "Balance is not sufficient for transfer" )))\n'})}),"\n",(0,s.jsxs)(n.p,{children:["You can simplify this code by refactoring with an ",(0,s.jsx)(n.code,{children:"enforce"})," statement.\nBy using ",(0,s.jsx)(n.code,{children:"enforce"}),", you no longer need to create branching logic dependent on the outcome of the ",(0,s.jsx)(n.code,{children:"if"})," statement.\nFor example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-pact",children:'  ;; Refactor with enforce\n  (defun debit:string (account:string amount:decimal)\n    @doc "Debit amount from account balance"\n      (with-read my-coin-table account\n        { "balance" := balance }\n\n        ;; Use enforce to exit the transaction if the condition isn\'t met.\n        (enforce (> balance amount) "Balance is not sufficient for transfer")\n\n        ;; Update the balance if the condition is met.\n        (update my-coin-table account\n          { "balance" : (- balance amount) })))\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The advantage to using ",(0,s.jsx)(n.code,{children:"enforce"})," is that the transaction execution ends immediately if the required condition isn't met.\nThe code doesn't require a conditional branch to handle the enforcement failure."]}),"\n",(0,s.jsx)(n.h2,{id:"using-cond-expressions",children:"Using cond expressions"}),"\n",(0,s.jsxs)(n.p,{children:["You can use ",(0,s.jsx)(n.code,{children:"cond"})," expressions to evaluate a series of expressions one after another.\nWith ",(0,s.jsx)(n.code,{children:"cond"})," expressions, you specify a series of conditions to evaluate and operations to perform in the order you want them executed."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-pact",children:'  (defun check-condition:string (user:string)\n     (with-read my-points-table user\n       { "balance" := points }\n         (cond ((= 0 points) "New user") ((< points 10) "Play again") (do (+ 1 points) "Bonus points"))\n     )\n  )\n'})}),"\n",(0,s.jsxs)(n.p,{children:["If the first condition evaluated is true, then first code branch is executed.\nIn this simplified example, if the ",(0,s.jsx)(n.code,{children:"(= 0 points)"})," condition is true, then the ",(0,s.jsx)(n.code,{children:'"New user"'})," string is returned.\nIf the first condition isn't met, the second condition is evaluated and, if that condition is true, then the second code branch is executed."]}),"\n",(0,s.jsxs)(n.p,{children:["The final ",(0,s.jsx)(n.code,{children:"else-branch"})," is only evaluated if all other conditions fail.\nFor example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-pact",children:'pact> (cond ((= "a" "b") "strings test") ((= 1 2) "numbers test") ((= true false) "boolean test") "no conditions are met")\n"no conditions are met"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"comparing-if-and-enforce-expressions",children:"Comparing if and enforce expressions"}),"\n",(0,s.jsxs)(n.p,{children:["There are often subtle differences between using ",(0,s.jsx)(n.code,{children:"if"})," and ",(0,s.jsx)(n.code,{children:"enforce"})," expressions that can make smart contract code unsafe.\nIn the following example, the code uses ",(0,s.jsx)(n.code,{children:"if"})," statements to do the following:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Check whether a specified account exists."}),"\n",(0,s.jsx)(n.li,{children:"Update the account balance if the row exists and the keyset matches the account keyset."}),"\n",(0,s.jsx)(n.li,{children:"Insert a new row if the account doesn't exist."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-pact",children:'  ;; TEMPTING USE of "IF"\n  (defun credit-if:string (account:string keyset:keyset amount:decimal)\n \n  ;; STEP 1: Fetch all keys in "my-coin-table" and see if "account" exists.\n     (if (contains account (keys my-coin-table))\n  \n  ;; STEP 2: if the row exists, check the keyset\n     (with-read my-coin-table account \n       { "balance":= balance,\n         "keyset":= retk }\n       \n  ;; STEP 3: If the keysets match, update the balance.\n  ;; Otherwise, print an error message.\n        (if (= retk keyset)\n          (update my-coin-table account {\n            "balance": (+ amount balance)})\n          "The keysets do not match" ))\n \n  ;; STEP 4: if the row doesn\'t exist, insert a row into the table.\n     (insert my-coin-table account{\n        "balance": amount,\n        "keyset": keyset}\n     )\n   )\n )\n'})}),"\n",(0,s.jsxs)(n.p,{children:["As you can see, the nested ",(0,s.jsx)(n.code,{children:"if"})," statements make this code more difficult to follow and more complicated than necessary."]}),"\n",(0,s.jsxs)(n.p,{children:["You can simplify this code by refactoring to use ",(0,s.jsx)(n.code,{children:"with-default-read"}),", ",(0,s.jsx)(n.code,{children:"write"}),", and ",(0,s.jsx)(n.code,{children:"enforce"})," expressions instead of the ",(0,s.jsx)(n.code,{children:"if"})," statements.\nTo simplify the code, you can start by setting the default row balance to 0.0 and taking the keyset as an input value.\nIf the row exists, you can then bind the ",(0,s.jsx)(n.code,{children:"balance"})," and ",(0,s.jsx)(n.code,{children:"keyset"})," value from the table."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-pact",children:'  (defun credit:string (account:string keyset:guard amount:decimal)\n \n    ;; STEP 1: Set the default balance to 0.0 and get the keyset as an input value.\n    ;; If row exists, then bind "balance" and "keyset" values from the table.\n    (with-default-read my-coin-table account\n      { "balance": 0.0, "keyset": keyset }\n      { "balance":= balance, "keyset":= retg }\n \n \n      ;; STEP 2: Check that the input keyset is the same as the row\'s keyset\n      (enforce (= retg keyset)\n        "account guards do not match")\n \n      ;; STEP 3: Write the row to the table.\n      (write my-coin-table account\n        { "balance" : (+ balance amount)\n        , "keyset"   : retg\n        }\n      )\n    )\n  )\n'})}),"\n",(0,s.jsxs)(n.p,{children:["As you can see from this example, the code now combines steps to look up the account and check its keyset.\nBy simplifying the logic to remove ",(0,s.jsx)(n.code,{children:"if"})," statements, you can write functions that are more straightforward to read and safer to execute."]}),"\n",(0,s.jsx)(n.h2,{id:"testing-contract-functions",children:"Testing contract functions"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"final-control-flow.repl"})," file provides test cases for executing the functions defined in the ",(0,s.jsx)(n.code,{children:"my-coin"})," Pact module.\nThe ",(0,s.jsx)(n.code,{children:"final-control-flow.repl"})," file includes both successful and failing test cases for the ",(0,s.jsx)(n.code,{children:"debit-if"})," and ",(0,s.jsx)(n.code,{children:"credit-if"})," functions and for the ",(0,s.jsx)(n.code,{children:"debit"})," and ",(0,s.jsx)(n.code,{children:"credit"})," functions that use ",(0,s.jsx)(n.code,{children:"enforce"}),".\nYou should note that the ",(0,s.jsx)(n.code,{children:"final-control-flow.repl"})," file uses the ",(0,s.jsx)(n.code,{children:"expect-failure"})," function to check the expected failure messages for the ",(0,s.jsx)(n.code,{children:"debit"})," and ",(0,s.jsx)(n.code,{children:"credit"})," functions."]}),"\n",(0,s.jsxs)(n.p,{children:["Because the ",(0,s.jsx)(n.code,{children:"debit"})," and ",(0,s.jsx)(n.code,{children:"credit"})," functions use the ",(0,s.jsx)(n.code,{children:"enforce"})," function, those functions fail transactions if the enforced condition isn't met.\nFor example, the ",(0,s.jsx)(n.code,{children:"expect-failure"})," tests return results for the refactored ",(0,s.jsx)(n.code,{children:"debit"})," and ",(0,s.jsx)(n.code,{children:"credit"})," functions that look like this:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-pact",children:'"Expect failure: Success: Balance is not sufficient for transfer"\n"Expect failure: Success: Keysets do not match"\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"if"})," statements in the ",(0,s.jsx)(n.code,{children:"debit-if"})," and ",(0,s.jsx)(n.code,{children:"credit-if"})," functions don't fail the transaction when the condition evaluated is false.\nBecause those function return an error message without causing the transaction to fail, the ",(0,s.jsx)(n.code,{children:"expect-failure"})," test is less predictable when the condition is evaluated."]}),"\n",(0,s.jsxs)(n.p,{children:["If you test",(0,s.jsx)(n.code,{children:"debit-if"})," and ",(0,s.jsx)(n.code,{children:"credit-if"})," functions, you'll see the expected error messages.\nHowever, if you use the ",(0,s.jsx)(n.code,{children:"expect-failure"})," function with the ",(0,s.jsx)(n.code,{children:"debit-if"})," and ",(0,s.jsx)(n.code,{children:"credit-if"})," functions, you'll see that the test itself fails:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-pact",children:'"Balance is not sufficient for transfer"\n"FAILURE: Balance is not sufficient for transfer: expected failure, got result"\n"Keysets do not match"\n"FAILURE: Keysets do not match: expected failure, got result"\n'})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>a});var o=t(96540);const s={},i=o.createContext(s);function c(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);