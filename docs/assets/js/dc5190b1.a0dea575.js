"use strict";(self.webpackChunkkadena_docs=self.webpackChunkkadena_docs||[]).push([[8122],{97613:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"resources/election-workshop/workshop-write","title":"Write a smart contract","description":"Use the Pact smart contract language to build the scaffolding for the election application smart contract backend.","source":"@site/docs/resources/election-workshop/6-write-a-smart-contract.md","sourceDirName":"resources/election-workshop","slug":"/resources/election-workshop/workshop-write","permalink":"/docs/resources/election-workshop/workshop-write","draft":false,"unlisted":false,"editUrl":"https://github.com/kda-community/kadena-docs-new/blob/master/docs/resources/election-workshop/6-write-a-smart-contract.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"title":"Write a smart contract","description":"Use the Pact smart contract language to build the scaffolding for the election application smart contract backend.","id":"workshop-write","sidebar_position":7}}');var o=t(74848),a=t(28453);const l={title:"Write a smart contract",description:"Use the Pact smart contract language to build the scaffolding for the election application smart contract backend.",id:"workshop-write",sidebar_position:7},c="Write a smart contract",s={},d=[{value:"Before you begin",id:"before-you-begin",level:2},{value:"Define a minimal Pact module",id:"define-a-minimal-pact-module",level:2},{value:"Test the election module",id:"test-the-election-module",level:2},{value:"Update the election module",id:"update-the-election-module",level:2},{value:"Update the module with the correct keyset",id:"update-the-module-with-the-correct-keyset",level:3},{value:"Test updating the module with an incorrect keyset",id:"test-updating-the-module-with-an-incorrect-keyset",level:3},{value:"Enforce the keyset guard",id:"enforce-the-keyset-guard",level:2},{value:"Deploy the Pact module",id:"deploy-the-pact-module",level:2},{value:"Next steps",id:"next-steps",level:2}];function r(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"write-a-smart-contract",children:"Write a smart contract"})}),"\n",(0,o.jsxs)(n.p,{children:["Now that you have a unique principal namespace controlled by your administrative keyset, you're ready to start building the backend for the election application.\nIn this tutorial, you'll learn the basics of how to write a ",(0,o.jsx)(n.strong,{children:"smart contract"})," that can be deployed on the blockchain as the backend code for the election application."]}),"\n",(0,o.jsx)(n.p,{children:"A smart contract is a special type of application runs automatically when the conditions specified in the contract logic are met.\nBy deploying a smart contract on a blockchain, the terms of an agreement can be executed programmatically in a decentralized way, without any intermediary involvement or process delays."}),"\n",(0,o.jsxs)(n.p,{children:["On the Kadena blockchain, a smart contract consists of one or more ",(0,o.jsx)(n.strong,{children:"modules"})," written in the Pact programming language.\nFor this workshop, the election smart contract consists of two modules: the main ",(0,o.jsx)(n.strong,{children:"election"})," module and an auxiliary\n",(0,o.jsx)(n.strong,{children:"gas station"})," module."]}),"\n",(0,o.jsxs)(n.p,{children:["The exercises in this tutorial illustrate the basics of building and deploying a Pact module as you develop the main ",(0,o.jsx)(n.strong,{children:"election"})," module.\nAt the completion of this tutorial, you'll deploy the core logic of the election module on your local development network."]}),"\n",(0,o.jsx)(n.h2,{id:"before-you-begin",children:"Before you begin"}),"\n",(0,o.jsx)(n.p,{children:"Before you start this tutorial, verify the following basic requirements:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"You have an internet connection and a web browser installed on your local computer."}),"\n",(0,o.jsxs)(n.li,{children:["You have a code editor, such as ",(0,o.jsx)(n.a,{href:"https://code.visualstudio.com/download",children:"Visual Studio Code"}),", access to an interactive terminal shell, and are generally familiar with using command-line programs."]}),"\n",(0,o.jsxs)(n.li,{children:["You have cloned the ",(0,o.jsx)(n.a,{href:"https://github.com/kadena-community/voting-dapp.gitp",children:"voting-dapp"})," repository to create your project directory as described in ",(0,o.jsx)(n.a,{href:"/resources/election-workshop/workshop-prepare",children:"Prepare your workspace"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["You have the development network running in a Docker container as described in ",(0,o.jsx)(n.a,{href:"/resources/election-workshop/workshop-start",children:"Start a local blockchain"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["You are ",(0,o.jsx)(n.a,{href:"/resources/election-workshop/workshop-start#connect-to-the-development-network",children:"connected to the development network"})," using your local host IP address and port number 8080."]}),"\n",(0,o.jsxs)(n.li,{children:["You have created and funded an administrative account as described in ",(0,o.jsx)(n.a,{href:"/resources/election-workshop/workshop-admin",children:"Add an administrator account"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["You have created a principal namespace on the development network as described in ",(0,o.jsx)(n.a,{href:"/resources/election-workshop/workshop-namespace",children:"Define a namespace"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["You have defined the keyset in your principal namespace using the administrative account as described in ",(0,o.jsx)(n.a,{href:"/resources/election-workshop/workshop-keysets",children:"Define keysets"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"define-a-minimal-pact-module",children:"Define a minimal Pact module"}),"\n",(0,o.jsxs)(n.p,{children:["To get started writing Pact modules, you must have a file that contains the bare minimum of code required to deploy.\nYou can create and test this starter code for a Pact module using the Pact command-line interpreter REPL and ",(0,o.jsx)(n.code,{children:".repl"})," files.\nAfter you have a minimal working deployment, you can add and refactor the code to add functionality to the Pact\nmodule."]}),"\n",(0,o.jsx)(n.p,{children:"To create the starter code for a Pact module:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"election-workshop/pact"})," folder in the code editor on your computer."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Create a new file named ",(0,o.jsx)(n.code,{children:"module.repl"})," in the ",(0,o.jsx)(n.code,{children:"pact"})," folder."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Add a transaction that uses the ",(0,o.jsx)(n.code,{children:"module"})," keyword to define a new module named ",(0,o.jsx)(n.code,{children:"election"})," and a module owner to protect access to the functions you'll define for the module."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["All modules require either a keyset, like the ",(0,o.jsx)(n.code,{children:"admin-keyset"})," you've seen previously, or a ",(0,o.jsx)(n.a,{href:"/resources/glossary#capability",children:"capability"})," to control who can deploy or update the module, and, potentially, who can execute protected operations."]}),"\n",(0,o.jsxs)(n.p,{children:["You must specify the governance keyset or capability immediately after the module name.\nAlthough keysets\u2014like the ",(0,o.jsx)(n.code,{children:"admin-keyset"})," you've used in previous tutorials\u2014are valid module owners, most modules define a governance capability as a more flexible solution.\nFor example, you can define a GOVERNANCE capability that is always true by adding the following lines in the ",(0,o.jsx)(n.code,{children:"module.repl"})," file:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(begin-tx "Deploy the election module")\n  (module election GOVERNANCE)\n     (defcap GOVERNANCE () true)\n(commit-tx)\n'})}),"\n",(0,o.jsx)(n.p,{children:"You'll learn more about capabilities a little later in this tutorial and in other tutorials.\nFor now, there are only two points to keep in mind about this capability:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The name you use for the capability isn't significant\u2014you can use any name\u2014however, the placement of the capability at the start of the module declaration is significant."}),"\n",(0,o.jsx)(n.li,{children:"The definition of a capability as always true represents the simplest form a definition can take for demonstration purposes."}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["You could also write this definition using an ",(0,o.jsx)(n.code,{children:"enforce"})," statement similar to the following with exactly the same results:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(begin-tx "Deploy the election module")\n  (module election GOVERNANCE\n     (defcap GOVERNANCE () \n       (enforce (= 1 1)))\n  )\n(commit-tx)\n'})}),"\n",(0,o.jsxs)(n.p,{children:["At this point, you have a module name and a module owner in the form of a capability.\nFor this module to be useful, you must define at least one function.\nThe first function you'll define in this module is the ",(0,o.jsx)(n.code,{children:"list-candidates"})," function."]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Add a ",(0,o.jsx)(n.code,{children:"list-candidates"})," function as the first function in the  ",(0,o.jsx)(n.code,{children:"election"})," module declaration transaction."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(begin-tx "Deploy the election module")\n  (module election GOVERNANCE       ; Start the module declaration\n     (defcap GOVERNANCE () true)    ; Define the module owner capability\n\n     (defun list-candidates () [])  ; Add a new function to the transaction   \n  )                                 ; End the module declaration\n(commit-tx)\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Later, you'll update this function to list the candidates stored in a database table.\nFor now, this function just returns an empty list (",(0,o.jsx)(n.code,{children:"[]"}),")."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Execute the code in the ",(0,o.jsx)(n.code,{children:"module.repl"})," file using the Pact command-line interpreter and the ",(0,o.jsx)(n.code,{children:"--trace"})," command-line option."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"pact module.repl --trace\n"})}),"\n",(0,o.jsx)(n.p,{children:"You'll see that the transaction succeeds with output similar to the following:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'module.repl:0:0-0:39:Trace: "Begin Tx 0 Deploy the election module"\nmodule.repl:1:2-6:3:Trace: Loaded module election, hash iKhGsvHzyhKh947693r9mF5leHM4Iw0rDjeoj6WQyL8\nmodule.repl:7:0-7:11:Trace: "Commit Tx 0 Deploy the election module"\nLoad successful\n'})}),"\n",(0,o.jsxs)(n.p,{children:["If you open the Pact command-line interpreter REPL, you can load this file and test that the ",(0,o.jsx)(n.code,{children:"list-candidates"})," function returns an empty list.\nFor example, type ",(0,o.jsx)(n.code,{children:"pact"})," in the terminal shell to open the Pact command-line interpreter, then load the ",(0,o.jsx)(n.code,{children:"module.repl"})," file and call the ",(0,o.jsx)(n.code,{children:"list-candidates"})," function to see output similar to the following:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'pact> (load "module.repl")\n"Loading module.repl..."\n"Begin Tx 0 Deploy the election module"\nLoaded module election, hash iKhGsvHzyhKh947693r9mF5leHM4Iw0rDjeoj6WQyL8\n"Commit Tx 0 Deploy the election module"\npact> (election.list-candidates)\n[]\n'})}),"\n",(0,o.jsx)(n.p,{children:"Type Control-d to exit the Pact command-line interpreter REPL."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Add the environment data keyset and signature and the transactions to define a namespace for the ",(0,o.jsx)(n.code,{children:"election"})," module to the ",(0,o.jsx)(n.code,{children:"module.repl"})," file before the start of the module declaration."]}),"\n",(0,o.jsx)(n.p,{children:"For example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(env-data\n   { "admin-keyset" :\n      { "keys" : [ "admin-public-key" ]\n      , "pred" : "keys-all"\n      }\n   }\n)\n(env-sigs\n   [{ "key"  : "admin-public-key"\n    , "caps" : []\n   }]\n)\n\n(begin-tx "Define a namespace for the module")\n   (define-namespace \'election (read-keyset \'admin-keyset) (read-keyset \'admin-keyset))\n(commit-tx)\n(begin-tx "Define a keyset to govern the module")\n   (namespace \'election)\n   (define-keyset "election.admin-keyset" (read-keyset \'admin-keyset))\n(commit-tx)\n\n(begin-tx "Deploy the election module")\n   (module election GOVERNANCE       ; Start the module declaration\n      (defcap GOVERNANCE () true)    ; Define the module owner capability\n \n      (defun list-candidates () [])  ; Add a new function to the transaction   \n   )                                 ; End the module declaration\n(commit-tx)\n'})}),"\n",(0,o.jsx)(n.p,{children:"As you might remember from previous tutorials, this code:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Loads the ",(0,o.jsx)(n.code,{children:"admin-keyset"})," context and signatures into the REPL environment."]}),"\n",(0,o.jsxs)(n.li,{children:["Defines the ",(0,o.jsx)(n.code,{children:"election"})," namespace."]}),"\n",(0,o.jsxs)(n.li,{children:["Enters the ",(0,o.jsx)(n.code,{children:"election"})," namespace to define the ",(0,o.jsx)(n.code,{children:"election.admin-keyset"})," as the namespace owner."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Execute the code in the ",(0,o.jsx)(n.code,{children:"module.repl"})," file using the Pact command-line interpreter and the ",(0,o.jsx)(n.code,{children:"--trace"})," command-line option."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:"pact module.repl --trace\n"})}),"\n",(0,o.jsx)(n.p,{children:"You'll now see that the transaction succeeds with output similar to the following:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'module.repl:0:0-6:1:Trace: "Setting transaction data"\nmodule.repl:7:0-11:1:Trace: "Setting transaction signatures/caps"\nmodule.repl:13:0-13:46:Trace: "Begin Tx 0 Define a namespace for the module"\nmodule.repl:14:4-14:88:Trace: "Namespace defined: election"\nmodule.repl:15:0-15:11:Trace: "Commit Tx 0 Define a namespace for the module"\nmodule.repl:16:0-16:49:Trace: "Begin Tx 1 Define a keyset to govern the module"\nmodule.repl:17:4-17:25:Trace: "Namespace set to election"\nmodule.repl:18:4-18:71:Trace: "Keyset write success"\nmodule.repl:19:0-19:11:Trace: "Commit Tx 1 Define a keyset to govern the module"\nmodule.repl:21:0-21:39:Trace: "Begin Tx 2 Deploy the election module"\nmodule.repl:22:2-26:3:Trace: Loaded module election, hash iKhGsvHzyhKh947693r9mF5leHM4Iw0rDjeoj6WQyL8\nmodule.repl:27:0-27:11:Trace: "Commit Tx 2 Deploy the election module"\nLoad successful\n'})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"test-the-election-module",children:"Test the election module"}),"\n",(0,o.jsxs)(n.p,{children:["At this point, the ",(0,o.jsx)(n.code,{children:"module.repl"})," file includes the minimal code required to define a Pact module named ",(0,o.jsx)(n.code,{children:"election"})," in the ",(0,o.jsx)(n.code,{children:"election"})," namespace.\nThe module is owned by a minimal GOVERNANCE capability and only includes one function\u2014the ",(0,o.jsx)(n.code,{children:"list-candidates"})," function\u2014that is publicly available because access to the function isn't guarded by any keyset or capability.\nYou can use the ",(0,o.jsx)(n.code,{children:"list-modules"})," built-in function in the Pact REPL to test access to the ",(0,o.jsx)(n.code,{children:"election"})," module and then add a transaction to call the ",(0,o.jsx)(n.code,{children:"list-candidates"})," function."]}),"\n",(0,o.jsxs)(n.p,{children:["To test access to the ",(0,o.jsx)(n.code,{children:"election"})," module:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"election-workshop/pact/module.repl"})," file in the code editor."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Add the following transaction to assert that the ",(0,o.jsx)(n.code,{children:"election"})," module is available:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(begin-tx "Look up the election module")\n  (expect "The election module should exist"\n   ["election"]\n   (list-modules)\n  )\n(commit-tx)\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Execute the code in the ",(0,o.jsx)(n.code,{children:"module.repl"})," file using the Pact command-line interpreter and the ",(0,o.jsx)(n.code,{children:"--trace"})," command-line option."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:"pact module.repl --trace\n"})}),"\n",(0,o.jsxs)(n.p,{children:["You should see output similar to the following that indicates the ",(0,o.jsx)(n.code,{children:"election"})," module is defined in the Pact REPL:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'...\nmodule.repl:29:0-29:40:Trace: "Begin Tx 3 Look up the election module"\nmodule.repl:30:3-33:4:Trace: "Expect: success The election module should exist"\nmodule.repl:34:0-34:11:Trace: "Commit Tx 3 Look up the election module"\nLoad successful\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Clear the environment data and signature information and add a transaction to call the ",(0,o.jsx)(n.code,{children:"list-candidates"})," function on the ",(0,o.jsx)(n.code,{children:"election"})," module, and assert that the function returns an empty array:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(env-data {})\n(env-sigs [])\n(begin-tx "Call list-candidates")\n  (expect "list-candidates returns an empty list"\n    []\n    (election.list-candidates)\n  )\n(commit-tx)\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Execute the code in the ",(0,o.jsx)(n.code,{children:"module.repl"})," file using the Pact command-line interpreter and the ",(0,o.jsx)(n.code,{children:"--trace"})," command-line option."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:"pact module.repl --trace\n"})}),"\n",(0,o.jsxs)(n.p,{children:["You should see output similar to the following that indicates you were able to call the ",(0,o.jsx)(n.code,{children:"list-candidates"})," function without signing the transaction and that the function returned an empty list:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'...\nmodule.repl:36:0-36:13:Trace: "Setting transaction data"\nmodule.repl:37:0-37:13:Trace: "Setting transaction signatures/caps"\nmodule.repl:38:0-38:33:Trace: "Begin Tx 4 Call list-candidates"\nmodule.repl:39:3-42:4:Trace: "Expect: success list-candidates returns an empty list"\nmodule.repl:43:0-43:11:Trace: "Commit Tx 4 Call list-candidates"\nLoad successful\n'})}),"\n",(0,o.jsxs)(n.p,{children:["For the ",(0,o.jsx)(n.code,{children:"election"})," module, some functions\u2014like the ",(0,o.jsx)(n.code,{children:"list-candidates"})," function\u2014should be publicly accessible.\nOther operations\u2014as demonstrated in the next section\u2014should be more carefully guarded."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"update-the-election-module",children:"Update the election module"}),"\n",(0,o.jsxs)(n.p,{children:["When you defined the ",(0,o.jsx)(n.code,{children:"election"})," namespace for the ",(0,o.jsx)(n.code,{children:"election"})," module, you also specified the keysets with access rights and with administrative rights.\nChanges that update the module must be signed with a keyset that has the necessary rights.\nThe examples in this section demonstrate how to test that updates work as expected, with transactions that update the Pact module with the correct keyset and fail to update the module with an incorrect keyset."]}),"\n",(0,o.jsx)(n.h3,{id:"update-the-module-with-the-correct-keyset",children:"Update the module with the correct keyset"}),"\n",(0,o.jsx)(n.p,{children:"To test updating a module by calling the correct administrative keyset:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"election-workshop/pact/module.repl"})," file in the code editor."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Reload the election ",(0,o.jsx)(n.code,{children:"admin-keyset"})," and signature into the Pact REPL with the following lines of code after the last transaction:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(env-data\n  { \'admin-keyset :\n    { "keys" : [ "admin-public-key" ]\n    , "pred" : "keys-all"\n    }\n  }\n)\n(env-sigs\n  [{ "key"  : "admin-public-key"\n   , "caps" : []\n  }]\n)\n\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Update the ",(0,o.jsx)(n.code,{children:"election"})," module to change the ",(0,o.jsx)(n.code,{children:"list-candidates"})," function to return a list containing 1, 2, 3 and test that ",(0,o.jsx)(n.code,{children:"list-candidates"})," returns the new list."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(begin-tx "Update the module")\n  (module election "election.admin-keyset"\n    (defun list-candidates () [1, 2, 3])\n  )\n(commit-tx)\n(begin-tx "Call updated list-candidates function")\n  (expect "list-candidates returns a list with numbers"\n    [1, 2, 3]\n    (election.list-candidates)\n  )\n(commit-tx)\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Execute the code in the ",(0,o.jsx)(n.code,{children:"module.repl"})," file using the Pact command-line interpreter and the ",(0,o.jsx)(n.code,{children:"--trace"})," command-line option."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"pact module.repl --trace\n"})}),"\n",(0,o.jsxs)(n.p,{children:["You should see output similar to the following that indicates you were able to call the updated ",(0,o.jsx)(n.code,{children:"list-candidates"})," function and that the function returned a list with numbers:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'...\nmodule.repl:45:0-51:2:Trace: "Setting transaction data"\nmodule.repl:52:1-56:2:Trace: "Setting transaction signatures/caps"\nmodule.repl:58:0-58:30:Trace: "Begin Tx 5 Update the module"\nmodule.repl:59:3-61:4:Trace: Loaded module election, hash aqTzmLOHdx5cNTPnhHMu6XXE69KBqDbzWvK70dGTkyo\nmodule.repl:62:0-62:11:Trace: "Commit Tx 5 Update the module"\nmodule.repl:63:0-63:50:Trace: "Begin Tx 6 Call updated list-candidates function"\nmodule.repl:64:3-67:4:Trace: "Expect: success list-candidates returns a list with numbers"\nmodule.repl:68:0-68:11:Trace: "Commit Tx 6 Call updated list-candidates function"\nLoad successful   \n'})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"test-updating-the-module-with-an-incorrect-keyset",children:"Test updating the module with an incorrect keyset"}),"\n",(0,o.jsx)(n.p,{children:"To test that updating a module with an incorrect keyset fails:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"election-workshop/pact/module.repl"})," file in the code editor."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Set the environment data and signature to use a different key by adding the following lines of code after the last transaction:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(env-data\n  { "admin-keyset" :\n    { "keys" : [ "other-key" ]\n    , "pred" : "keys-all"\n    }\n  }\n)\n(env-sigs\n  [{ "key"  : "other-key"\n   , "caps" : []\n  }]\n)\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Add a transaction to attempt to update the module with an incorrect key by adding the following lines of code:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(begin-tx "Upgrade the module without permission")\n    (module election "election.admin-keyset"\n      (defun list-candidates () [])\n    )\n(commit-tx)\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Execute the code in the ",(0,o.jsx)(n.code,{children:"module.repl"})," file using the Pact command-line interpreter and the ",(0,o.jsx)(n.code,{children:"--trace"})," command-line option."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:"pact module.repl --trace\n"})}),"\n",(0,o.jsxs)(n.p,{children:["You should see the ",(0,o.jsx)(n.code,{children:"Load failed"})," message and that the failure was caused by a ",(0,o.jsx)(n.code,{children:"Keyset failure"})," error.\nWith these two tests, you know that you can update the Pact module by signing a transaction with the ",(0,o.jsx)(n.code,{children:"election.admin-keyset"})," and that no other keyset can update the ",(0,o.jsx)(n.code,{children:"election"})," module."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'...\nmodule.repl:70:0-76:1:Trace: "Setting transaction data"\nmodule.repl:77:0-81:1:Trace: "Setting transaction signatures/caps"\nmodule.repl:83:0-83:50:Trace: "Begin Tx 7 Upgrade the module without permission"\nmodule.repl:85:6: Keyset failure (keys-all): [admin-ke...]\n85 |       (module election "election.admin-keyset"\n...\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Remove the code you added for testing an incorrect keyset."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Execute the code in the ",(0,o.jsx)(n.code,{children:"module.repl"})," file to verify that the file loads successfully before you continue:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:"pact module.repl --trace\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"enforce-the-keyset-guard",children:"Enforce the keyset guard"}),"\n",(0,o.jsx)(n.p,{children:"With the GOVERNANCE capability set to always pass, there are no restrictions for executing functions in the module code.\nThis behavior is acceptable for preliminary local testing, but not desirable in any other context.\nAs an alternative to calling a keyset directly, you can update the module to define a restriction for the GOVERNANCE capability that enforces the use of the administrative keyset."}),"\n",(0,o.jsx)(n.p,{children:"To test updating the module with a guarded capability:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"election-workshop/pact/module.repl"})," file in the code editor."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Update the ",(0,o.jsx)(n.code,{children:"election"})," module to define a GOVERNANCE capability that enforces the use of the ",(0,o.jsx)(n.code,{children:"election.admin-keyset"})," keyset."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(begin-tx "Update the module with enforce-guard")\n   (module election GOVERNANCE \n     (defcap GOVERNANCE () \n     (enforce-guard (keyset-ref-guard "election.admin-keyset")))\n     \n     (defun list-candidates () ["Chris", "Harry", "Tai"])\n   )\n(commit-tx)\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Add a transaction that imports the ",(0,o.jsx)(n.code,{children:"election"})," module and tests that the ",(0,o.jsx)(n.code,{children:"list-candidates"})," function returns the expected list."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(begin-tx "Return the list of candidates")\n   (use election)  \n   (election.list-candidates)\n(commit-tx)\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Execute the code in the ",(0,o.jsx)(n.code,{children:"module.repl"})," file using the Pact command-line interpreter and the ",(0,o.jsx)(n.code,{children:"--trace"})," command-line option."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"pact module.repl --trace\n"})}),"\n",(0,o.jsxs)(n.p,{children:["You should see output similar to the following that indicates you were able to call the updated ",(0,o.jsx)(n.code,{children:"list-candidates"})," function and that the function returned a list with strings:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'...\nmodule.repl:70:0-70:49:Trace: "Begin Tx 7 Update the module with enforce-guard"\nmodule.repl:71:3-76:4:Trace: Loaded module election, hash Z-nnwjtYoQ1RT993qOSGZkoE5b-_iKH_KL1_yMUH8xU\nmodule.repl:77:0-77:11:Trace: "Commit Tx 7 Update the module with enforce-guard"\nmodule.repl:79:0-79:42:Trace: "Begin Tx 8 Return the list of candidates"\nmodule.repl:80:3-80:17:Trace: Loaded imports from election\nmodule.repl:81:3-81:29:Trace: ["Chris" "Harry" "Tai"]\nmodule.repl:82:0-82:11:Trace: "Commit Tx 8 Return the list of candidates"\nLoad successful\n'})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"deploy-the-pact-module",children:"Deploy the Pact module"}),"\n",(0,o.jsx)(n.p,{children:"Now that you've seen how to define and update a Pact module, you're ready to deploy the module on the local development network with the administrative account you created previously."}),"\n",(0,o.jsx)(n.p,{children:"To deploy the Pact module on the development network:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Verify the development network is currently running on your local computer."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"election-workshop/pact"})," folder in the code editor."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Create a new file named ",(0,o.jsx)(n.code,{children:"election.pact"})," in the ",(0,o.jsx)(n.code,{children:"pact"})," folder."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Add the minimal Pact code required to define a module to the ",(0,o.jsx)(n.code,{children:"election.pact"})," file."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'(define-namespace (ns.create-principal-namespace (read-keyset "election-admin")) (read-keyset "election-admin") (read-keyset "election-admin"))\n\n(let ((ns-name (ns.create-principal-namespace (read-keyset "election-admin"))))\n  (namespace ns-name)\n  (define-keyset (format "{}.{}" [ns-name "election-admin"]) (read-keyset "election-admin" ))\n)\n\n(module election GOVERNANCE \n   (defcap GOVERNANCE () \n     (enforce-guard (keyset-ref-guard "n_d5ff15d933b83c1ef691dce3dabacfdfeaeade80.election-admin")))\n    \n   (defun list-candidates () [1, 2, 3])\n)\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Create a new transaction template named ",(0,o.jsx)(n.code,{children:"election-module-devnet.ktpl"})," in the ",(0,o.jsx)(n.code,{children:"~/.kadena/transaction-templates"})," folder."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"election-module-devnet.ktpl"})," file and create a reusable transaction request similar to the following using the path to the ",(0,o.jsx)(n.code,{children:"election.pact"})," file that contains your Pact module code."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pact",children:'codeFile: "../../election.pact"\ndata:\n  election-admin:\n    keys: ["{{public-key}}"]\n    pred: "keys-all"\nmeta:\n  chainId: "{{chain-id}}"\n  sender: "{{{sender-account}}}"\n  gasLimit: 80300\n  gasPrice: 0.000001\n  ttl: 600\nsigners:\n  - public: "{{public-key}}"\n    caps: []\nnetworkId: "{{network-id}}"\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Create a transaction that uses the template by running the ",(0,o.jsx)(n.code,{children:"kadena tx add"})," command and following the prompts displayed."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Sign the transaction by running the ",(0,o.jsx)(n.code,{children:"kadena tx sign"})," command and following the prompts displayed."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Send the signed transaction to the blockchain by running the ",(0,o.jsx)(n.code,{children:"kadena tx send"})," command and following the prompts displayed."]}),"\n",(0,o.jsx)(n.p,{children:"You can verify the transaction results using the request key for the transaction."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,o.jsxs)(n.p,{children:["Congratulations!\nYou now have a smart contract with one ",(0,o.jsx)(n.code,{children:"election"})," module governed by the ",(0,o.jsx)(n.code,{children:"election-admin"})," deployed in your principal namespace on the local development network.\nIn this tutorial, you learned how to:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Define a minimal Pact module."}),"\n",(0,o.jsx)(n.li,{children:"Test a Pact module using the Pact REPL."}),"\n",(0,o.jsx)(n.li,{children:"Implement governance for a module by using a capability."}),"\n",(0,o.jsx)(n.li,{children:"Deploy a Pact module on the local development network."}),"\n",(0,o.jsx)(n.li,{children:"Update a deployed module governed by your keyset."}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["So far, your ",(0,o.jsx)(n.code,{children:"election"})," module only contains one simple function.\nThe next tutorial demonstrates how to add a schema and a database table to the ",(0,o.jsx)(n.code,{children:"election"})," module and how to use that table to store the names of election candidates and the number of votes each candidate receives."]}),"\n",(0,o.jsxs)(n.p,{children:["You'll also update the ",(0,o.jsx)(n.code,{children:"list-candidates"})," function to return data from the database table and add a new function to nominate candidates."]}),"\n",(0,o.jsxs)(n.p,{children:["To see the code for the activity you completed in this tutorial and get the\nstarter code for the next tutorial, check out the ",(0,o.jsx)(n.code,{children:"07-nominate-candidates"})," branch from the ",(0,o.jsx)(n.code,{children:"election-workshop"})," repository by running the following command in your terminal shell:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"git checkout 07-nominate-candidates\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(r,{...e})}):r(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>c});var i=t(96540);const o={},a=i.createContext(o);function l(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);